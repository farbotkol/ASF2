<apex:page showHeader="true" sidebar="true" controller="INC_IncentiveSearch_Controller">
<style>
/*#values th{
	font-size: 10px;
} 
#values td{
	font-size: 10px;
}
.fixed { table-layout:fixed; }
.fixed td { overflow: hidden; }
*/
.hiddencolumn{
	display:none;
}
.radiocolumn td{
	border:none;
}
.searchresults{
	font-size: 8px;
	table-layout: fixed;
	width: 100%;
}
.selectcol{
	width: 25px;
}

#newuser {
    width: 20%;
    padding-left: 10px;
}
#values{
	border:none;
	border-collapse: collapse;
}

#values td {
border-left: 1px solid #000;
border-right: 1px solid #000;
}

#values td:first-child {
border-left: none;
}

#values td:last-child {
border-right: none;
}

#values tr {
    border: 1px solid black;
}
#values th {
    border: 1px solid black;
}

#projectnumber{
	width:auto;
} 
.radiocolumn {
    margin-top: -4px;
    padding-top: 0;
    width: 100%;
}
.largecolumn {
    width: -moz-fit-content;
}
.mediumcolumn{
	width:100px;
}
  .projmessage{
    border: 1px solid red;
    background-color: #FFFFCC;
  }
</style>
<apex:form >
	<apex:pageMessages />
	<apex:sectionHeader title="" subtitle="Incentive Project Search" />

<p class="projmessage">All projects meeting eligibility requirements will be flagged to the Deliver to Win administrator for review and release into workflow.  This search function can be used to view the latest status of an enrollment in workflow.  No subsequent actions can be taken unless you have active rights to the record.
<br/><br/>
Projects that do not meet eligibility requirements can be queried as well.  If you are the Project Manager (PM) or the DTW Administrator, you may take ownership of the record and, if desired, begin the enrollment application process.  If you are a user other than the PM or DTW Administrator, you may change the owner to the PM or DTW Administrator.  Note that any ineligible projects proposed for enrollment will be subject to additional approvals. 
<br/><br/>
Note that project eligibility is assessed weekly on Sunday evenings (Pacific time).  The project data source is AECOM Insight.  Any changes to project budgets in the underlying financial system (e.g. Oracle, ACCPAC) will be reflected after a weekend refresh.</p>

	<apex:pageBlock title="Search Criteria">
		<apex:pageBlockSection title="" showheader="false" columns="1">
			<apex:pageBlockTable value="{!searchCriteria}" var="row" id="theSearchTable">
			   <apex:column headerValue="Row">
			   		<apex:outputText value="{!row.Row}"/>
			   </apex:column>
			   <apex:column headerValue="Criteria">
			       <apex:selectList value="{!row.criteria}" multiselect="false" size="1">
			          <apex:selectOptions value="{!row.criteriaRowlist}"/>
			          <apex:actionSupport event="onchange" reRender="theSearchTable"/>
			       </apex:selectList>
			   </apex:column>
			   <apex:column headerValue="Value">
			   		<apex:inputText value="{!blankValue}" html-readonly="true" rendered="{!row.Criteria = ''}"/>
			   		<apex:inputText value="{!row.value}" rendered="{!AND(row.Criteria != '',row.Criteria != 'PM')}"/>
			   		<apex:inputField value="{!row.IncProj.ProjectManager__c}" rendered="{!Row.Criteria = 'PM'}" />
			   </apex:column>
			   <apex:column >
			        <apex:commandButton value="Add Row" action="{!addrow}" reRender="theSearchTable"/>
			        <apex:commandButton value="Remove Row" action="{!removerow}" reRender="theSearchTable">
			          <apex:param name="removerow" value="{!row.row}" assignTo="{!removerow}"/>
        			</apex:commandButton>
			   </apex:column>
			</apex:pageBlockTable>
		</apex:pageBlockSection>
	</apex:pageBlock>
	<apex:pageBlock >
		<apex:pageBlockButtons location="top">
		   <apex:commandButton value="Search" action="{!search}"/>
		   <apex:commandButton value="Change Owner" action="{!changeowner}" rendered="{!lresults.size > 0}" />
		</apex:pageBlockButtons>
		<apex:pageBlockSection showHeader="false" columns="1">
		  <div>
		  <apex:outputpanel rendered="{!lResults.size > 0}">
			<table id="values" class="searchresults">
				<tr>
					<th class="selectcol">Select</th>
					<th id="projectnumber">Project Number</th>
					<th class="largecolumn">Project Name</th>
					<th class="largecolumn">Customer Name</th>
					<th class="mediumcolumn">Approved NSR Budget</th>
					<th class="mediumcolumn">Current Owner</th>
					<th class="mediumcolumn">Enrollment Status</th>
					<th id="newuser">New Owner</th>
					<th id="largecolumn">Messages</th>
				</tr>
				<apex:outputPanel >
				<apex:repeat value="{!lResults}" var="result">
				  <tr>
				  		<td class="selectcol">
				  		  <apex:inputCheckbox label="" value="{!result.changeOwner}"/>
				  		</td>
				  		<apex:outputPanel rendered="{!NOT(result.HasAccess)}">
				  	 	<td>{!result.oIP.ProjectID__c}</td>
				  	 	</apex:outputPanel>
				  	 	<apex:outputPanel rendered="{!result.HasAccess}">
				  	 	<td><a href='/{!result.oIP.Id}'>{!result.oIP.ProjectID__c}</a></td>
				  	 	</apex:outputPanel>
				  	 	<td class="largecolumn">{!result.oIP.Name}</td>
				  	 	<td class="largecolumn">{!result.oIP.CustomerName__c}</td>
				  	 	<td class="mediumcolumn">
				  	 	   <apex:outputField value="{!result.oIP.ApprovedNSRBudget__c}"/>
				  	 	</td>
				  	 	<td class="largecolumn"><apex:outputField value="{!result.oIP.OwnerID}"/></td>
				  	 	<td>{!result.oIP.EnrollmentStatus__c}</td>
				  	 	<td class="radiocolumn">
				  	 		<apex:selectRadio styleClass="radiocolumn" layout="pageDirection" value="{!result.newOwner}">
	            				<apex:selectOptions value="{!result.possibleOwners}"/>
	            			</apex:selectRadio>
				  	 	</td>
				  	 	<td>{!result.message}</td>
				  </tr>
				</apex:repeat>
			  </apex:outputpanel>
			</table>
			</apex:outputPanel>
		</div>
			<!--
			<apex:pageBlockTable  rowClasses="radiocolumn" styleclass="searchresults" value="{!lResults}" var="result" rendered="{!lresults.size > 0}">
				<apex:column headerValue="Select">
				   <apex:inputCheckbox value="{!result.changeOwner}"/>
				</apex:column>
				<apex:column value="{!result.oIP.ProjectID__c}"/>
				<apex:column value="{!result.oIP.Name}"/>
				<apex:column value="{!result.oIP.CustomerName__c}"/>
				<apex:column value="{!result.oIP.ApprovedNSRBudget__c}"/>
				<apex:column value="{!result.oIP.OwnerID}"/>
				<apex:column value="{!result.oIP.EnrollmentStatus__c}"/>
				<apex:column headerValue="New Owner">
					<apex:selectRadio styleClass="radiocolumn" layout="pageDirection" value="{!result.newOwner}">
	            		<apex:selectOptions value="{!result.possibleOwners}"/>
	            </apex:selectRadio>
				</apex:column>
				<apex:column>
				   <apex:outputtext value="{!result.message}"/>
				</apex:column>
			</apex:pageBlockTable> -->
		</apex:pageBlockSection>
	</apex:pageBlock>
</apex:form>
</apex:page>