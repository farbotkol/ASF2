<apex:page tabStyle="QuestionnaireSet__c" standardController="QuestionnaireSet__c" extensions="ECO_RMASummaryController" showHeader="true" sidebar="false" action="{!init}">

    <script>

        $( document ).ready(function() {

            function mouseDownGo() {
                document.style.color = "green";

            }
            function mouseDownNoGo() {
                document.style.color = "red";
            }

        });
        
    </script>
    
    <style>
        .meetingNotes td, .meetingNotes th{
            padding:10px;
        }

        .meetingNotes td{
            padding-top:2px;
        }

        .meetingNotes th{
            padding-bottom:2px;
        }

        .tableLabel{
            font-weight:bold;
            color: #4a4a56 !important;
            text-align: right;
            font-size: 91%;
            padding-right:10px;
        }

        .setPicker{
            position:absolute;
        //top:0;
            right:0;
        }
        body .bPageBlock .pbBody .labelCol{
            padding-top: 3px !important;
            padding-bottom: 5px;
            vertical-align: middle;
        }

        .riskNotifications{
            border:1px solid #EAEAEA;
            border-top:3px solid #3399CC;
            background-color:#F8F8F8;
            padding:10px 0;
        }

        .riskNotifications .pbSubsection .detailList tr td{
            color:red !important;
        }

        .riskNotifications h2{
            padding:20px;
        }

        .halfWidthWrapper {
            width:70%;
            display:inline-block;
            float:left;
        }

        #notifications{
            margin-left:70%;
            padding-left:20px;
        }
        .goNoGoBox{
            text-align:center;
            width:300px;
            margin:0 auto;
            font-weight:bold;
            font-size:14px;
            padding:15px 20px 15px 20px;
            border:2px solid #85B3CE;
            background-color:#E3F0F8;
            border-radius:5px;
        }
        .goNoGoBox fieldset{
            padding-left:17px;
        }
        .goNoGoBox h2{
            font-size:19px;
        }



        /* RADIO STYLE BUTTONS */
        label {
          width: 125px;
          border-radius: 4px;
          border: 1px solid #85B3CE;
        }

        input[type="radio"]{
            display:none;
        }

        /* hide input */
        input[type="radio"]:empty {
            margin-left: -999px;
        }

        /* style label */
        input[type="radio"]:empty ~ label {
            position: relative;
            float: left;
            line-height: 2.5em;
            text-indent: 3.25em;
            margin-top: 2em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        input[type="radio"]:empty ~ label:before {
            position: absolute;
            display: block;
            top: 0;
            bottom: 0;
            left: 0;
            content: '';
            width: 2.5em;
            background: #C3D4DE;
            border-radius: 3px 0 0 3px;
            padding-right:5px;
        }

        /* toggle hover */
        input[type="radio"]:hover:not(:checked) ~ label:before {
            content:'\2714';
            text-indent: .9em;
            color: #C2C2C2;
        }

        input[type="radio"]:hover:not(:checked) ~ label {
            color: #888;
        }

        /* toggle on */
        input[type="radio"]:checked ~ label:before {
            content:'\2714';
            text-indent: .9em;
            color: #9CE2AE;
            background-color: #38BB59;
        }

        input[type="radio"]:checked ~ label {
            color: #333;
        }
        input[type="radio"]:not(:checked) ~ label {
            color: #777;
        }

        /* radio focus */
        input[type="radio"]:focus ~ label:before {
            box-shadow: 0 0 0 3px #999;
        }

        /* CUSTOM HELP / GUIDANCE TEXT BOX 
        .customHelpText{
            padding:20px 25px;
            border:1px solid #85B3CE;
            min-height:30px;
            display:block;
            width:auto;
            margin:20px 0;
            background-color:#E3F0F8;
            background-image: url('../img/icon/forecasts24.png');
            background-position:3% 50%;
            background-repeat:no-repeat;
            border-radius:4px;
        }*/
        .customHelpText{
			padding:7px;
			border:1px solid #85B3CE;
			min-height:30px;
			display:block;
			width:auto;
			margin:0;
			background-repeat:no-repeat;
			border-radius:4px;
			background-color:#A2D3F1;
		}
        .customHelpBody{
            display:inline-block;
            color:#;
            max-width:95%;
        	//margin-left:28px;
        }
        .bPageBlock .message{
            padding: 7px;
            border: 1px solid #85B3CE;
            min-height: 30px;
            display: block;
            width: auto;
            margin: 0 0 5px 0;
            background-repeat: no-repeat;
            border-radius: 4px;
            background-color: #A2D3F1;

        }
    </style>
    <apex:includeScript value="{!$Resource.ECO_jQuery_1_11_2_min_js}"/>
    <script type="text/javascript">
    function collapseSection()
    {
        console.log('collapseSection');
        $("div[id$='ProjectSummary']").find("div.pbBody").find("img.hideListButton").click();
    }
    /*function enableSubmit()
    {
        enableSubmit();
    }*/
    sfdcPage.appendToOnloadQueue(collapseSection);
    </script>
    <apex:form id="mainForm">

        <apex:outputField value="{!QuestionnaireSet__c.ApprovalStatus__c}" rendered="false" />
		<apex:actionFunction id="enableSubmit" name="enableSubmit" action="{!enableSubmitApex}" reRender="SubmitApproval"/>
        <div style="position:relative">
            <apex:sectionHeader title="Risk and Market Assessment" subtitle="{!QuestionnaireSet__c.Project__r.ProjectNumber__c} {!QuestionnaireSet__c.Project__r.Name}" rendered="{!NOT(ISNULL(sSelectedQuestionnaireSet))}" />
            <apex:sectionHeader title="Risk and Market Assessment" subtitle="New Risk and Market Assessment" rendered="{!ISNULL(sSelectedQuestionnaireSet)}" />

            <!--<div class="setPicker">
                <span style="white-space:nowrap">
                    Change or New Assessment: 
                </span>

                <apex:selectList size="1" value="{!sSelectedQuestionnaireSet}">
                    <apex:selectOptions value="{!loQuestionnaireSets}" />
                    <apex:selectOption itemLabel="Start New Assessment" itemValue="" />
                    <apex:actionSupport event="onchange" action="{!SelectNewQuestionnaire}" />
                </apex:selectList>
            </div>-->
        </div>
        <div class="customHelpText">
            <div class="customHelpBody">
                The Risk &amp; Market Assessment informs the Go/No Go decision and must be completed in its entirety prior to submitting the go/no go recommendation for approval.  If you do not know the answer to a question, select ‘unknown’.
                <div style="width:100%; height:5px;"></div>
                <strong>Directions:</strong>
                <ul>
                    <li>Step 1:  Create a version name for the Risk &amp; Market Assessment (default will be saved as “Initial Assessment”)</li>
                    <li>Step 2:  Complete the Risk Assessment</li>
                    <li>Step 3:  Complete the Market Assessment</li>
                    <li>Step 4: Schedule and conduct a Go/No Go meeting (optional)</li>
                    <li>Step 5:  Select “go” or “no go” for approval</li>
                    <li>Step 6:  Submit the completed R&amp;M Assessment and go/no go recommendation for approval </li>
                </ul>
                <em>The system will automatically submit the request to the owning organization P&amp;L Manager or delegate.  The approver will review the results of the Risk &amp; Market Assessment and approve/reject the go/no go recommendation.</em>
            </div>
		</div>
        <br/>
        
        <apex:inputhidden value="{!QuestionnaireSet__c.UnansweredQuestionCount__c}"/>
        <apex:pageMessages id="pageMessages"/>
        <apex:outputPanel id="topPanel" rendered="{!NOT(ISNULL(QuestionnaireSet__c.Project__c))}">
            <div class="projectSummary">
                <apex:pageBlock title="Risk and Market Assessment" id="ProjectSummary">
                    <apex:pageBlockButtons location="top">
                        <apex:commandButton action="{!BeginRiskAssessment}" value="Begin/Edit Risk Asssessment"  />
                        <apex:commandLink action="{!generatePdf}" value="Print R&M Assessment" styleClass="btn" immediate="true" target="_blank" style="padding:4px 3px; text-decoration:none;" />  
                        <apex:commandButton action="{!Save}" value="Save" disabled="{!oQuestionnaireSet.ApprovalStatus__c == 'Approved'}" />
                        <apex:commandButton action="{!ReturnToProject}" value="Return to Project" />            
                    </apex:pageBlockButtons>
                    <apex:pageBlockSection columns="2" collapsible="false">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel for="QuestionnaireSetName" value="Assessment Name" />
                            <apex:inputField id="QuestionnaireSetName" value="{!oQuestionnaireSet.Name}" required="true" style="width:225px" />
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <!--<span style="white-space:nowrap">
                                    Change or New Assessment: 
                                </span>-->
                            <apex:outputPanel >
                                <span style="white-space:nowrap">
                                    Change or New Assessment: 
                                </span>
                                <apex:selectList size="1" value="{!sSelectedQuestionnaireSet}" title="Change or New Assessment:">
                                    <apex:selectOptions value="{!loQuestionnaireSets}" />
                                    <apex:selectOption itemLabel="Start New Assessment" itemValue="" />
                                    <apex:actionSupport event="onchange" action="{!SelectNewQuestionnaire}" />
                                </apex:selectList>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                    <div style="clear:both;"></div>
                    <div class="halfWidthWrapper">
                        <apex:pageBlockSection title="Project Information" collapsible="true" columns="2">
                            
                            <apex:repeat value="{!CustomProjSetupFields}" var="f">
                                <apex:outputField value="{!theProject[f.fieldPath]}" />
                            </apex:repeat>
                        
                            <!--<apex:outputField value="{!theProject.Name}" />
                            <apex:outputField value="{!theProject.OwnerId}" />
                            <apex:outputField value="{!theProject.pse__Opportunity__c}" />
                            <apex:outputField value="{!theProject.EstimatedContractValue__c}" />
                            <apex:outputField value="{!theProject.pse__Project_Manager__c}" />
                            <apex:outputField value="{!theProject.NetServicesRevenue__c}" />
                            <apex:outputField value="{!theProject.ProjectOwningOrg__c}" />
                            <apex:outputField value="{!theProject.TotalMargin__c}" />
                            <apex:outputField value="{!theProject.PrimaryEndClient__c}" />
                            <apex:outputField value="{!theProject.TotalBidBudget__c}" />
                            <apex:outputField value="{!theProject.PrimaryBillingClient__c}" />
                            <apex:outputField value="{!theProject.EstimatedStartDate__c}" />-->
                            <!-- Commented By Eric on 05-Aug-2015 -->
                            <!--<apex:outputField value="{!QuestionnaireSet__c.UnansweredQuestionCount__c}"/> -->
                        </apex:pageBlockSection>
                        <!--
                        <apex:pageBlockSection title="Project Sites" columns="1" collapsible="false">
                            <apex:pageBlockTable value="{!lProjectSites}" var="item" width="100%" rendered="{!if(lProjectSites.size > 0, true, false)}">
                                <apex:column value="{!item.Account_Name__c}"/>
                                <apex:column value="{!item.OracleCustomerNumber__c}"/>
                                <apex:column value="{!item.CreditRiskRating__c}"/>
                                <apex:column value="{!item.Address1__c}"/> 
                                <apex:column value="{!item.City__c}"/>
                                <apex:column value="{!item.State__c}"/>
                                <apex:column value="{!item.Country__c}"/>
                                <apex:column value="{!item.Postal_Code__c}"/>
                                <apex:column value="{!item.Is_Billing__c}"/>
                                <apex:column value="{!item.Is_Default_Top_Task__c}"/>
                                <apex:column value="{!item.Is_End__c}"/>
                                <apex:column value="{!item.Is_Primary_End__c}"/>
                            </apex:pageBlockTable>
                            <apex:outputText value="No Project Sites have been defined." rendered="{!if(lProjectSites.size = 0, true, false)}"/>
                        </apex:pageBlockSection>
                        -->

                        <apex:pageBlockSection columns="2" title="Risk Assessment" collapsible="false"></apex:pageBlockSection>

                        <apex:pageBlockTable value="{!lQuestionnaires}" var="item" rendered="{!NOT(ISNULL(sSelectedQuestionnaireSet))}">
                            <apex:column headerValue="Name">
                                <apex:commandLink action="{!goToSpecificQuestionnaire}" value="{!item.Name}" rendered="{!IF(item.Id == null, false, true)}">
                                    <apex:param name="questionnaireId" assignTo="{!navTargetQuestionnaireId}" value="{!item.Id}"/>
                                </apex:commandLink>
                                <apex:outputText value="{!item.Name}" rendered="{!IF(item.Id == null, true, false)}" />
                            </apex:column>
                            <apex:column value="{!item.ProjectRisk__c}"/> 
                            <apex:column value="{!item.DoATriggers__c}"/> 
                            <apex:column value="{!item.PercentComplete__c}"/> 
                        </apex:pageBlockTable>
                        
                        <apex:pageBlockSection collapsible="false" columns="2" title="Market Assessment" rendered="{!if(lMarketAssessments.size > 0, true, false)}" />
                        <apex:pageBlockTable value="{!lMarketAssessments}" var="ma" rendered="{!if(lMarketAssessments.size > 0, true, false)}">
                            <!--<apex:column >
                                <apex:facet name="header">Action</apex:facet>
                                <apex:outputLink value="/{!ma.Id}">View</apex:outputLink>
                            </apex:column>-->
                            <apex:column headerValue="Market Assessment Name" style="width:40%;">
                                <apex:commandLink action="/{!ma.Id}" value="{!ma.Name}"/>
                            </apex:column>
                            <apex:column value="{!countMA}/18" headerValue="Questions Completed" style="width:32.5%;"/>
                            <apex:column value="{!percentMA}%" headerValue="Percent Complete" style="width:27.5%;"/>
                        </apex:pageBlockTable>
                        
                        <apex:pageBlockSection collapsible="false" columns="2" title="Export Control(s)" rendered="{!if(lExportControls.size > 0, true, false)}" />
                        <apex:pageBlockTable value="{!lExportControls}" var="ec" rendered="{!if(lExportControls.size > 0, true, false)}">
                            <apex:column >
                                <apex:facet name="header">Action</apex:facet>
                                <a href="/{!ec.Id}">View</a>
                            </apex:column>
                            <apex:column value="{!ec.Name}"/>
                            <apex:column value="{!ec.SubmittedDate__c}"/>
                        </apex:pageBlockTable>
                    </div>
                    <div id="notifications">
                        <apex:pageBlockSection collapsible="false" title="Notifications and Alerts"></apex:pageBlockSection>
                        <apex:repeat value="{!lNotifications}" var="n" rendered="{!if(lNotifications.size > 0, true, false)}">
                            <apex:pageMessage severity="INFO" summary="{!n.sMessage}" />
                        </apex:repeat>
                        <apex:pageMessage severity="INFO" summary="There are no Notifications or Alerts associated to this project" rendered="{!if(lNotifications.size = 0, true, false)}" />
                        
                    </div>
                    <div style="clear:both;"></div><br/>
                </apex:pageBlock>
            </div>
            <apex:pageBlock id="meeting" title="Go / No Go" rendered="{!NOT(ISNULL(sSelectedQuestionnaireSet))}"><!--  rendered="{!NOT(showGoNoGoButton)}" -->
                <apex:pageBlockButtons location="top">
                    <apex:commandButton action="{!CreateGoNoGoReview}" value="Create Go/No Go Project Meeting" rendered="{!showGoNoGoButton}" rerender="GoNoGoPanel" disabled="{!oQuestionnaireSet.ApprovalStatus__c == 'Approved'}" />
                    <!-- <apex:commandButton action="{!AddParticipant}" value="Add Participant" rerender="participants" /> -->
                </apex:pageBlockButtons>

                <apex:outputPanel id="GoNoGoPanel" rendered="{!NOT(showGoNoGoButton)}">
                <!-- <apex:pageBlockSection collapsible="false" title="Go / No Go Project Meeting" columns="1"></apex:pageBlockSection> -->
                <div style="text-align:center; margin:10px;">
                    <!-- <apex:commandButton action="{!CreateGoNoGoReview}" value="Create Go/No Go Project Meeting" rendered="{!showGoNoGoButton}" rerender="GoNoGoPanel" /> -->
                    <apex:pageBlockSection collapsible="false" columns="2"><!--  rendered="{!NOT(showGoNoGoButton)}" -->
                        <apex:outputField value="{!QuestionnaireSet__c.GoNoGo_Review__c}"/>
                        <apex:outputField value="{!QuestionnaireSet__c.GoNoGo_Review__r.ScheduledDate__c}"/>
                        <apex:outputField value="{!QuestionnaireSet__c.GoNoGo_Review__r.Status__c}"/>
                    </apex:pageBlockSection>
                    
                </div>
                </apex:outputPanel>
                <!--
                <apex:outputPanel id="participants">
                    <apex:variable value="{!1}" var="iCount" />
                    <apex:pageBlockSection collapsible="false" title="Meeting Participants" columns="2">
                        <apex:repeat value="{!lParticipants}" var="participant">
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="Participant #{!iCount}" />
                                <apex:inputField value="{!participant.User__c}" />
                            </apex:pageBlockSectionItem>
                            <apex:variable value="{!iCount + 1}" var="iCount" />
                        </apex:repeat>
                    </apex:pageBlockSection>
                </apex:outputPanel>
                <br/><br/><br/>-->

                <!--<apex:pageBlockSection collapsible="false" title="Notes" columns="2"></apex:pageBlockSection>-->
                <apex:pageBlockSection collapsible="false" columns="1"></apex:pageBlockSection>
                <table class="meetingNotes" width="100%">
                    <tr>
                        <th width="50%">Go / No Go Meeting Notes</th>
                        <!--<th style="padding-left:20px" width="50%">Project Review Category</th>-->
                    </tr>
                    <tr>
                        <td rowspan="3">
                            <apex:inputField value="{!QuestionnaireSet__c.MeetingNotes__c}" />
                        </td>
                        <!--<td style="padding-left:20px">
                            <table width="100%">
                                <tr>
                                    <td class="tableLabel">
                                        Assigned
                                    </td>
                                    <td>
                                        <apex:outputText html-disabled="disabled" style="width:100%" value="{!QuestionnaireSet__c.Project__r.ProjectReviewCategory__c}" />
                                    </td>
                                    <td class="tableLabel">
                                        Requested
                                    </td>
                                    <td>
                                        <apex:inputField style="width:100%" value="{!QuestionnaireSet__c.RequestedProjectCategory__c}" />
                                    </td>
                                </tr>
                            </table>
                        </td>-->
                    </tr>
                    <!--<tr>
                        <th style="padding-left:20px">
                            Reason for Variance
                        </th>
                    </tr>
                    <tr>
                        <td valign="top" style="padding-left:20px">
                            <apex:inputField style="width:100%;height:217px" value="{!QuestionnaireSet__c.ReasonForVariance__c}" />
                        </td>
                    </tr>-->
                </table>
                
                <!-- <apex:pageBlockSection collapsible="false" title="Go / No Go Recommendation" columns="1"></apex:pageBlockSection> -->
                <div class="goNoGoBox">
                    <h2>Go / No Go Recommendation</h2>
                    <apex:selectRadio value="{!QuestionnaireSet__c.GoNoGoRecommendation__c}" disabled="{!IF(OR(percentMA != 100, oQuestionnaireSet.ApprovalStatus__c != 'Pending Approval', oQuestionnaireSet.UnansweredQuestionCount__c != 0 ), true, false)}" onchange="enableSubmit();">
                        <apex:selectOption itemValue="Go" itemLabel="Go"/>
                        <apex:selectOption id="selectNoGo" itemValue="No Go" itemLabel="No Go"/>
                    </apex:selectRadio>
                    <apex:commandButton id="SubmitApproval" value="Submit for Approval" action="{!submitForApproval}" disabled="{!IF(OR(oQuestionnaireSet.GoNoGoRecommendation__c == '',  oQuestionnaireSet.ApprovalStatus__c != 'Pending Approval' ), true, false)}" />
                </div>
            
            </apex:pageBlock>
        </apex:outputPanel>
    </apex:form>
    <apex:relatedList list="CombinedAttachments" />
    <apex:relatedList id="ApprovalHistory" list="ProcessSteps" />
    <script>
        var allTdTags = document.getElementsByTagName('td');
        for(var i=0;i<allTdTags.length;i++){
       
        if(allTdTags[i].className == 'pbButton'){
                     document.getElementsByName('piSubmit')[0].style.display = "none";          
            }
        }
    </script>
    
</apex:page>