<apex:page id="ParentPage" extensions="ECO_ClientFinderController" standardController="pse__Proj__c" showheader="true" sidebar="true"  docType="html-5.0">

	<apex:includeScript value="{!$Resource.ECO_jQuery_1_11_2_min_js}"/>
	<apex:includeScript value="{!URLFOR($Resource.ECO_jQueryUI_1_11_2, 'jquery-ui.min.js')}" />

	<style>

		.searchText{
			text-align:center;
			font-weight:bold;
			font-size:20px;
		}

		.pbSubExtra{
			visibility: hidden !important;
		}
		.customHelpText{
			padding:20px 25px;
			border:1px solid #85B3CE;
			min-height:30px;
			display:block;
			width:auto;
			margin:20px 25px;
			background-color:#E3F0F8;
		}
		.customHelpIcon{
			display:inline-block;
			margin:0 15px 0 0;
			width:24px;
			height:24px;
			vertical-align:top !important;
		}
		.customHelpBody{
			display:inline-block;
			color:#;
			max-width:95%;
		}
		.fixedPickList{
			width: 350px;
		}
		.fixedName{
			width: 345px;
		}
		/*
		.activeTab {
			background-color:#236FBD; 
			color:white; 
			tab-color:yellow;
			background-image:none
          }
      	.inactiveTab {
			background-color:white; 
			color:black; 
			background-image:none
        }

      	.disabledTab {
			background-color:grey; 
			color:grey; 
			background-image:none
        }
        */
        .rich-tabpanel{
        	margin:10px 10px 0 10px;
        	width:98.5%;
        }
        .pbBody .rich-tabpanel .rich-tab-header{
			border: 1px solid #d3d3d3 !important;
			background: ;
			color: #555 !important;
			border-top-right-radius: 4px !important;
			border-top-left-radius: 4px !important;
			padding: 7px 12px;
			text-decoration:none;
			font-size:13px;
			background: #999999; /* Old browsers */
			/* IE9 SVG, needs conditional override of 'filter' to 'none' */
			background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzk5OTk5OSIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjUxJSIgc3RvcC1jb2xvcj0iI2Q2ZDZkNiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjUxJSIgc3RvcC1jb2xvcj0iIzIwN2NjYSIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjUxJSIgc3RvcC1jb2xvcj0iI2Q2ZDZkNiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
			background: -moz-linear-gradient(top,  #999999 0%, #d6d6d6 51%, #207cca 51%, #d6d6d6 51%, #e5e5e5 100%); /* FF3.6+ */
			background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#999999), color-stop(51%,#d6d6d6), color-stop(51%,#207cca), color-stop(51%,#d6d6d6), color-stop(100%,#e5e5e5)); /* Chrome,Safari4+ */
			background: -webkit-linear-gradient(top,  #999999 0%,#d6d6d6 51%,#207cca 51%,#d6d6d6 51%,#e5e5e5 100%); /* Chrome10+,Safari5.1+ */
			background: -o-linear-gradient(top,  #999999 0%,#d6d6d6 51%,#207cca 51%,#d6d6d6 51%,#e5e5e5 100%); /* Opera 11.10+ */
			background: -ms-linear-gradient(top,  #999999 0%,#d6d6d6 51%,#207cca 51%,#d6d6d6 51%,#e5e5e5 100%); /* IE10+ */
			background: linear-gradient(to bottom,  #999999 0%,#d6d6d6 51%,#207cca 51%,#d6d6d6 51%,#e5e5e5 100%); /* W3C */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#999999', endColorstr='#e5e5e5',GradientType=0 ); /* IE6-8 */
        }
        .rich-tab-active{
        	background: #f1f1f1 !important;
        	font-weight:bold !important;
        }
        .pbBody .rich-tabpanel .rich-tab-header.activeTab{
        	border-bottom:none !important;
        }
        .pbBody .rich-tabpanel .disabledTab{
        	opacity:0.45 !important;
        }
        .rich-tabhdr-side-border, .rich-tabhdr-side-border{
        	background:none !important;
        	display:none;
        }
        .rich-tabhdr-side-cell{
        	border-top:none;
        }
        
		.infoTable {
			background: #f5f5f5;
			border-collapse: separate;
			font-size: 12px;
			line-height: 24px;
			text-align: left;
			margin:5px 14px 0 14px;
		}	
		.infoTable table{
			width:100%;
		}
		.infoTable th {
			background-color: #a6afa2 !important;
			color: #fff;
	  		font-weight: bold;
			padding: 3px 9px;
			position: relative;
			border:none !important;
		}
		.infoTable th:first-child{
			border-right:1px solid #fff !important;
		}

		.infoTable th:after {
			content: '';
			display: block;
			height: 25%;
			left: 0;
			margin: 1px 0 0 0;
			position: absolute;
			top: 25%;
			width: 100%;
		}
		.infoTable td {
			border-right: 1px solid #fff;
			border-left: 1px solid #e8e8e8;
			border-top: 1px solid #fff;
			border-bottom: 1px solid #e8e8e8;
			padding: 3px 9px;
			position: relative;
			transition: all 300ms;
		}
		.rich-tab-header:hover{
			cursor:pointer !important;
		}
		.rich-tab-disabled:hover{
			cursor:auto !important;
		}
		.infoTable td:first-child {
			box-shadow: inset 1px 0 0 #fff;
		}	

		.infoTable td:last-child {
			border-right: 1px solid #e8e8e8;
			box-shadow: inset -1px 0 0 #fff;
		}	

		.infoTable tr {
		}

		.infoTable tr:nth-child(odd) td {
			background: #f1f1f1;	
		}

		.infoTable tr:last-of-type td {
			box-shadow: inset 0 -1px 0 #fff; 
		}

		.infoTable tr:last-of-type td:first-child {
			box-shadow: inset 1px -1px 0 #fff;
		}	

		.infoTable tr:last-of-type td:last-child {
			box-shadow: inset -1px -1px 0 #fff;
		}	

		.infoTable tbody:hover td {
		}

		.infoTable tbody:hover tr:hover td {
			color: #444;
			text-shadow: 0 1px 0 #fff;
		}
		body .bEditBlock .pbBody .pbSubheader, body .bWizardBlock .pbBody .pbSubheader{
			background-image:none !important;
			margin:10px 12px 5px 12px;
			color:#27282e;
		}
		body .bPageBlock .pbBody .pbSubheader h3{
			color:#fff;
		}

	</style>

	<apex:sectionHeader title="Project Accounts" subtitle="Manage Project Accounts" />

	<apex:outputPanel id="WholeForm">

		<script type="text/javascript">
			$(function(){
				$("#AddressInput input").bind('keypress', function(e){
				        if (e.keyCode == 13) {
				            SearchSites();
				        }
				});

				$("#ProjectInput input").bind('keypress', function(e){
				        if (e.keyCode == 13) {
				            CreateProject();
				        }
				});
			
			});

		</script>


		

		<apex:form >
			<apex:pageMessages id="messages" />

			<apex:outputPanel id="SelectAddressPanel">
				<apex:pageBlock mode="edit">
					<apex:pageBlockButtons location="top">
						<apex:commandButton value="Save" action="{!stubsave}"/>
						<apex:commandButton value="Return to Project" action="{!cancel}"/>
					</apex:pageBlockButtons>

					<apex:actionRegion >

						<apex:outputPanel id="SiteSelectPanel">
							<apex:pageBlockSection title="Selected Accounts"  columns="1" collapsible="false"></apex:pageBlockSection>
							<apex:actionStatus id="SiteSelectUpdateStatus">
								
								<apex:facet name="start">
									<p style="padding-bottom:20px;" class="searchText"><img style="position:relative;top:12px;" src="/img/loading32.gif" /> Updating...</p>
								</apex:facet>
								<apex:facet name="stop">
									<!-- Shows search results for associated Sites (Temp holder)-->
										<apex:outputPanel >
											<apex:pageMessage severity="INFO" rendered="{!IF(lstProjectSites.size > 0, false, true)}" summary="No Sites Were Selected."></apex:pageMessage> 
											<apex:outputPanel id="SiteSelect" rendered="{!if(lstProjectSites.size > 0, true, false)}">
												<div style="padding:0 12px;margin-top:7px">
													<apex:variable var="rowNum" value="{!0}"/>
													<apex:pageBlockTable value="{!lstProjectSites}" var="Site" rendered="{!if(lstProjectSites.size > 0, true, false)}">
                                                      <apex:column headerValue="Action">

                                                            <apex:commandLink style="text-decoration: none;" value="Remove" action="{!RemoveSite}" title="Remove" rerender="WholeForm" status="SiteSelectUpdateStatus" rendered="{!and(not(Site.Is_Default_Top_Task__c), not(Site.Is_Primary_End__c))}">
                                                              <apex:param name="rowIndex" value="{!rowNum}" assignTo="{!iSiteRowDelete}"/>
                                                           </apex:commandLink>
                                                           <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                                                        </apex:column>
														<apex:repeat value="{!$ObjectType.Project_Site__c.FieldSets.pse_ClientFinder_Display_Fieldset}" var="SearchField">
															<apex:column value="{!Site[SearchField]}" />
														</apex:repeat>
														<apex:column headerValue="Billing Client">
															<apex:inputCheckbox value="{!Site.Is_Billing__c}" disabled="{!Site.Is_Default_Top_Task__c}">
																<apex:actionSupport event="onclick" action="{!BillingSelect}" reRender="WholeForm">
																	<apex:param assignTo="{!idSiteID}" name="SiteID" value="{!Site.id}" />
																</apex:actionSupport>
															</apex:inputCheckbox>
														</apex:column>
														<apex:column headerValue="Primary Billing" >
															<apex:inputCheckbox value="{!Site.Is_Default_Top_Task__c}" disabled="{!OR(Site.Is_Default_Top_Task__c, NOT(Site.Is_Billing__c))}">
																<apex:actionSupport event="onclick" action="{!DefaultTopSelect}" reRender="WholeForm">
																	<apex:param assignTo="{!idSiteID}" name="SiteID" value="{!Site.id}" />
																</apex:actionSupport>
															</apex:inputCheckbox>
														</apex:column>
														<apex:column headerValue="End Client" >
															<apex:inputCheckbox value="{!Site.Is_End__c}"  disabled="{!Site.Is_Primary_End__c}">
																<apex:actionSupport event="onclick" action="{!EndSelect}" reRender="WholeForm">
																	<apex:param assignTo="{!idSiteID}" name="SiteID" value="{!Site.id}" />
																</apex:actionSupport>
															</apex:inputCheckbox>
														</apex:column>
														<apex:column headerValue="Primary End">
															<apex:inputCheckbox value="{!Site.Is_Primary_End__c}" disabled="{!OR(Site.Is_Primary_End__c, NOT(Site.Is_End__c))}">
																<apex:actionSupport event="onclick" action="{!PrimaryEndSelect}" reRender="WholeForm">
																	<apex:param assignTo="{!idSiteID}" name="SiteID" value="{!Site.id}" />
																</apex:actionSupport>
															</apex:inputCheckbox>
														</apex:column>
														<apex:column headerValue="Client">
															<apex:selectList value="{!Site.BillingContactID__c}" disabled="{!NOT(Site.Is_Billing__c)}">
            													<apex:selectOptions value="{!mapSiteIDtoOptions[Site.Site__c]}"></apex:selectoptions>
															</apex:selectList>
														</apex:column>
                                                        <apex:column headerValue="Contributions">
                                                             <apex:inputField value="{!Site.Contribution__c}" />
                                                        </apex:column>
														
													</apex:pageBlockTable>
												</div>

												<BR />

												<div class="infoTable">
													<table  border="1" cellpadding="0" cellspacing="0">
														<tr>
															<th>Attribute</th>
															<th>Definitition</th>
														</tr>
														<TR>
															<TD>Billing Client</TD>
															<TD>Billing clients to whom invoices will be sent.  These clients will be available to be selected for assignment to particular tasks during project setup.</TD>
														</TR>	
														<TR>
															<TD>Primary Billing</TD>
															<TD>The client to whom invoices will be sent (typically the client on the Prime Contract).  Where multiple billing clients exists, this client will be the default client on all tasks but can be changed to one of the Other Billing clients.</TD>
														</TR>
														<TR >
															<TD>End Client</TD>
															<TD>End Clients associated with the project (or may be intermediate clients between the contracted/billing client and the ultimate end client)</TD>
														</TR>	
														<TR>
															<td>Primary End</td>
															<td>The ultimate end Client for the project</td>
														</TR>
													</table>
												</div>
												<BR /><BR /><BR />	
											</apex:outputPanel>
										</apex:outputPanel>
								</apex:facet>
							</apex:actionStatus>	
						</apex:outputPanel>	

					</apex:actionRegion>


					<apex:actionRegion >

						<apex:actionFunction action="{!SearchSites}" name="SearchSites"  rerender="WholeForm" status="SiteSearchUpdateStatus" />

						<div id="AddressInput">
						<apex:pageBlockSection title="Search For Account" columns="2" collapsible="false">
                            <apex:pageBlockSectionItem HelpText="Enter client name">
                                <apex:outputLabel value="Account Name" />
                                <apex:inputText value="{!oSiteSearch.name}" />
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="City/Town" />
                                <apex:inputText value="{!oSiteSearch.city}" />
                            </apex:pageBlockSectionItem>
                             <apex:pageBlockSectionItem >
                                <apex:outputLabel value="State/Province/Emirate" />
                                <apex:inputText value="{!oSiteSearch.province}" />
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem >
                                <apex:outputLabel value="Country" />
                                <apex:inputText value="{!oSiteSearch.country}" />
                            </apex:pageBlockSectionItem>   
						</apex:pageBlockSection>
						</div>
						<div style="text-align:center;">
							<apex:commandButton id="SearchButton" action="{!SearchSites}" value="Search" rerender="WholeForm" status="SiteSearchUpdateStatus" />
						</div>
					</apex:actionRegion>
					<BR /><BR /><BR />

					<apex:actionRegion >
						<apex:outputPanel id="SiteSearch">						
							<apex:actionStatus id="SiteSearchUpdateStatus">
								<apex:facet name="start">
									<p style="padding-bottom:20px;" class="searchText"><img style="position:relative;top:12px;" src="/img/loading32.gif" /> Updating...</p>
								</apex:facet>
								<apex:facet name="stop">
									<apex:outputtext value="{!strSearchResults}"/>

									<apex:outputPanel id="SiteSearchResult" rendered="{!booDisplaySiteSearchResult}">
										<apex:pageBlockSection title="Search Results"  columns="1" collapsible="false"></apex:pageBlockSection>
											<div style="padding:0 12px;margin-top:7px">

												<apex:outputText Value="No Results Where Found." rendered="{!IF(lstSitesSearchResults.size > 0, false, true)}" />

												<apex:pageBlockTable value="{!lstSitesSearchResults}" rendered="{!IF(lstSitesSearchResults.size > 0, true, false)}" var="Site">
													<apex:column width="35">
														<apex:facet name="header">Action</apex:facet>
										            	<apex:commandLink action="{!SelectSite}" value="Select" rerender="WholeForm" status="SiteSelectUpdateStatus">
										            		<apex:param assignTo="{!idSiteID}" name="SiteID" value="{!Site.id}" />
										            	</apex:commandLink>&nbsp;&nbsp;
													</apex:column>
													<apex:repeat value="{!$ObjectType.Site__c.FieldSets.pse_ClientFinder_Search_Result_Fieldset}" var="SearchField">
														<apex:column value="{!Site[SearchField]}" />
													</apex:repeat>
												</apex:pageBlockTable>
											</div>
											<BR /><BR />
											<div style="text-align:center;">
												<apex:commandButton value="{!showMoreSiteText}" action="{!toggleSiteShow}"  rerender="WholeForm" status="SiteSearchUpdateStatus" rendered="{!bShowMoreButtonSite}" />
											</div>
											<BR /><BR /><BR />
									</apex:outputPanel>
								</apex:facet>
							</apex:actionStatus>
						</apex:outputPanel>		

					</apex:actionRegion>
				</apex:pageblock>
			</apex:outputPanel>
		</apex:form>
	</apex:outputPanel>
</apex:page>