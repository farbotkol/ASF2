<apex:page applyBodyTag="false" controller="ECO_PortalController" showheader="false" sidebar="false" standardStylesheets="false" action="{!onLoad}" id="portalPage" title="{!$Label.Ecosystem}" >
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/jquery.lazyload.min.js')}"></script>
    <script>
       $(function() {
            $("img.lazy").lazyload({
                event : "sporty"
            });
        });

        $(window).bind("load", function() {
            var timeout = setTimeout(function() { $("img.lazy").trigger("sporty") }, 500);
        });   

        $(document).ready(function(){
          
           $(".showAllApps").click(function(){
                $(".hiddenOnMobile").toggle();
            });

           $(".showAllApps").click(function(){
                $(".showHideSwap").toggleClass("hidden-xs");
           });


            $(".showAllApps").click(function(){
              if ($("i").is('.fa-eye')) {
                $("i.fa-eye").toggleClass("fa-eye-slash");
              } else {
                $("i.fa-eye-slash").toggleClass("fa-eye");
              }
            });
            
            // Plugin used: http://jedfoster.com/Readmore.js, part of ECONiftyResources static resource
            $('div.nf').readmore({
			  speed: 75,
			  collapsedHeight: 40,
			  moreLink: '<a href="#">{!$Label.ECOPortalMore}</a>',
			  lessLink: '<a href="#">{!$Label.ECOPortalLess}</a>'
			});
			
			// Plugin used: http://tablesorter.com/docs, part of ECONiftyResources static resource
			$("#projectsTable").tablesorter();
        });

    </script>

    <style>

        @media screen and (max-width:768px){
            .hiddenOnMobile{
                opacity:0.8;
                display:none;
                background-color:#333 !important;
            }
            .showHideSwap{
                float: right;
                width: 132px;
                margin-top: -33px;
            }
        }
        .badge-header{
            margin-top: 8px !important;
            top:0 !important;
        }
        .publishercontainer .bottomBar{
            height:45px !important;
        }
        .menuText{
            width:100%;
            position:absolute;
            bottom:3px;
            left:0;
            font-size:10px;
            text-align:center;
            text-transform:uppercase;
        }
        .nav li a i, .nav li a img{
            margin-top:-10px;
        }
        #dropdown-user img{
        	margin-top:0 !important;
        }
        body .navbar-top-links > li > a{
            padding:0 28px;
        }
        .badge-header{
        	margin-right:10px;
        }
        body #navbar .navbar-content{
        	padding:0;
        }
        #dropdown-user a{
        	padding: 0 6px !important;
        }
        .reportsMenuButton{
        	position:relative;
        }
        .list-group{
        	margin-bottom:0;
        }
        body .nano > .nano-pane::before{
			content:" ";
			width: 0; 
			height: 0; 
			border-left: 4px solid transparent;
			border-right: 4px solid transparent;			
			border-bottom: 4px solid #231f20;
			z-index:99999;
			top: 0;
			margin-top: 5px;
			position: absolute;
			margin-left:2px;
        }
        body .nano > .nano-pane::after{
			content:" ";
			width: 0; 
			height: 0; 
			border-left: 4px solid transparent;
			border-right: 4px solid transparent;			
			border-top: 4px solid #231f20;
			z-index:99999;
			bottom: 0;
			margin-bottom: 5px;
			position: absolute;
			margin-left:2px;
        }
        #portfolioTable{
        	min-height:250px;
        	max-height:250px;
        	width:auto;
        	margin:0 0 0 20px;
        	right:0 !important;
            overflow:hidden;
        }
        .myProjectsPortfolio{
        	height:250px;
        }


        /** STUFF FOR SURE IN NIFTY.CSS - there is likely more above as well, 7/7/2015, ANDREW SMITH  **/
        body .nano > .nano-pane{
        	width:12px;
        }
        body .nano > .nano-pane{
        	opacity:1;
        }
    </style>

    <body class="nifty-ready">

    <apex:composition template="ECO_Temp_Portal" >
        
        <apex:define name="head">
            <script>var AWAN_online = false;</script>
            <script src="{!awanJSPath}"></script>
        </apex:define>

        <apex:define name="content" >
                        

            <!-- This is where I am storing all of the modals -->
            <div class="modal fade" id="modalAlerts" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" id="myModalLabel">{!$Label.ECOPortalAlerts}</h4>
                        </div>
                        
                        <div class="modal-body">
                            <table class="table table-striped table-hover">
                                <thead> 
                                    <tr>
                                    <th>{!$Label.ECOPortalProjectNo}</th>
                                    <th>{!$Label.ECOPortalProjectName}</th>
                                    <th>{!$Label.ECOPortalAlert}</th>
                                    <th>{!$Label.ECOPortalResponse}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!alerts}" var="alert" >
                                    
                                        <tr>
                                            <td><a href="{!alert.LinkToRecord__c}"><apex:outputText value="{!alert.Project_Number__c}" /></a></td>
                                            <td><a href="{!alert.LinkToRecord__c}"><apex:outputField value="{!alert.Subject__c}" /></a></td>
                                            <td><apex:outputField value="{!alert.LongDescriptionMaxLength__c}" /></td>
                                            <td><apex:outputText value="Comment" /></td>
                                        </tr>                                       

                                    </apex:repeat>
                                    <apex:outputPanel rendered="{!alerts.size = 0}" layout="none">
                                        <tr>
                                            <td colspan="5" style="text-align:center;"><h3>{!$Label.ECOPortalNoAlerts}</h3></td>
                                        </tr>
                                    </apex:outputPanel>
                                </tbody>
                            </table>

                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">{!$Label.ECOOK}</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal fade" id="modalTasks" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" id="myModalLabel">{!$Label.ECOPortalTasks}</h4>
                        </div>
                        
                        <div class="modal-body">

                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                    <th>{!$Label.ECOPortalProjectNo}</th>
                                    <th>{!$Label.ECOPortalRelatedto}</th>
                                    <th>{!$Label.ECOPortalSubject}</th>
                                    <th>{!$Label.ECOPortalDueDate}</th>
                                    <th>{!$Label.ECOPortalPriority}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!tasks}" var="task" >
                                    
                                        <tr>
                                            <td><a href="/{!task.id}"><apex:outputField value="{!task.Subject}" /></a></td>
                                            <td><a href="/{!task.id}"><apex:outputField value="{!task.What.Name}" /></a></td>
                                            <td><apex:outputField value="{!task.Subject}" /></td>
                                            <td><apex:outputField value="{!task.ActivityDate}" /></td>
                                            <td><apex:outputField value="{!task.Priority}" /></td>
                                        </tr>

                                    </apex:repeat>

                                    <apex:outputPanel rendered="{!tasks.size = 0}" layout="none">
                                        <tr>
                                            <td colspan="5" style="text-align:center;"><h3>{!$Label.ECOPortalNoTasks}</h3></td>
                                        </tr>
                                    </apex:outputPanel>

                                </tbody>
                            </table>

                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">{!$Label.ECOOK}</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal fade" id="modalApprovals" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" id="myModalLabel">{!$Label.ECOPortalApprovals}</h4>
                        </div>
                        
                        <div class="modal-body">

                            <table class="table table-striped table-hover displayNone">
                                <thead>
                                    <tr>
                                    <th>{!$Label.ECOPortalProjectNo}</th>
                                    <th>{!$Label.ECOPortalProjectName}</th>
                                    <th>{!$Label.ECOPortalType}</th>
                                    <th>{!$Label.ECOPortalAlert}</th>
                                    <th>{!$Label.ECOPortalRequestInfo}</th>
                                    <th>{!$Label.ECOPortalApprove}</th>
                                    <th>{!$Label.ECOPortalReject}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!approvals}" var="approval" >
                                    
                                        <tr>
                                            <td></td>
                                            <td><a href="#"><apex:outputField value="{!approval.ProcessInstance.TargetObject.Name}" /></a></td>
                                            <td></td>
                                            <td><apex:outputField value="{!approval.ProcessInstance.Status}" /></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>

                                    </apex:repeat>

                                    <apex:outputPanel rendered="{!approvals.size = 0}" layout="none">
                                        <tr>
                                            <td colspan="7" style="text-align:center;"><h3>{!$Label.ECOPortalNoApprovals}</h3></td>
                                        </tr>
                                    </apex:outputPanel>

                                </tbody>
                            </table>

                            <div class="tempAlert">
                                {!$Label.ECOPortalApprovalMessage}
                            </div>

                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">{!$Label.ECOOK}</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- End Modal Storage -->
        
        
            <apex:pageMessages id="pageMessages" />
            
            <apex:form id="theForm" >   
                <apex:actionFunction name="goToReportsBuilder" action="{!goToReportBuilder}" />
                <apex:actionFunction name="goToApplicationConfiguration" action="{!goToApplicationConfiguration}" />
                <apex:actionFunction name="goToNewProject" action="{!goToNewProject}" />
                <apex:actionFunction name="goToNewOpportunity" action="{!goToNewOpportunity}" />

            </apex:form>


    <div id="container" class="aside effect mainnav-lg">
        
        <!-- 
           TOP NAVBAR: EcoSystemAllCaps, links for modal windows, outlook, new project, 
                      new oppty, icons for portal home, smart search, dropdown for sso and logout
        -->
        <!--===================================================-->
        <header id="navbar">
            <div id="navbar-container" class="boxed">

                <!--Brand logo & name-->
                <!--================================-->
                <div class="navbar-header">
                    <a style="cursor:default;" class="navbar-brand">
                        <img src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/loader.gif')}" data-original="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/my-aecom-apps.jpg')}" class="brand-icon lazy" />
                        <div class="brand-title" style="padding:0; margin:0; width:100%;">
                            <span class="brand-text"><span style="color:#D2D2D2; display:inline;">SELECTED</span> APPS</span>
                        </div>
                    </a>
                </div>
                <!--================================-->
                <!--End brand logo & name-->

                <!--Navbar Dropdown-->
                <!--================================-->
                <div class="navbar-content clearfix">
                    <ul class="nav navbar-top-links pull-left">

                        <!--Navigation toogle button - THIS OUT 7/7/2015, ANDREW SMITH
                        <li class="btn-hover-info add-tooltip hidden-xs" data-placement="bottom" data-toggle="tooltip" data-original-title="{!$Label.ECOPortalExpandApp}">
                            <a class="mainnav-toggle" href="#">
                                <i class="fa fa-th fa-lg"></i>
                            </a>
                        </li>
                         <li class=" visible-xs">
                            <a class="mainnav-toggle" href="#">
                                <i class="fa fa-th fa-lg"></i>
                            </a>
                        </li>
                        -->
                        <!--End Navigation toogle button-->


                        <!--Alerts Modal-->
                        <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
                        <li class="btn-hover-info hidden-xs" data-placement="bottom" data-original-title="{!$Label.ECOPortalAlerts}">
                            <a onclick="$('#modalAlerts').modal('show')" style="cursor:pointer;">
                                <i class="fa fa-warning fa-lg"></i><br />
                                <div class="menuText">Alerts</div>
                                <apex:outputPanel layout="block" styleClass="badge badge-header badge-danger" rendered="{!alerts.size > 0}">
                                    <apex:outputText value="{!alerts.size}" />
                                </apex:outputPanel>
                            </a>
                        </li>

                        <!--Task Modal -->
                        <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
                        <li class="btn-hover-info hidden-xs" data-placement="bottom" data-original-title="{!$Label.ECOPortalTasks}">
                            <a onclick="$('#modalTasks').modal('show')" style="cursor:pointer;">
                                <i class="fa fa-tasks fa-lg"></i><br />
                                <div class="menuText">Tasks</div>
                                <apex:outputPanel layout="block" styleClass="badge badge-header badge-danger" rendered="{!tasks.size > 0}">
                                    <apex:outputText value="{!tasks.size}" />
                                </apex:outputPanel>
                            </a>
                        </li>

                        <!--Approval Modal -->
                        <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
                        <li class="btn-hover-info hidden-xs" data-placement="bottom" data-original-title="{!$Label.ECOPortalApprovals}">
                            <a onclick="$('#modalApprovals').modal('show')" style="cursor:pointer;">
                                <i class="fa fa-check-square fa-lg"></i><br />
                                <div class="menuText">Approvals</div>
                                <apex:outputPanel layout="block" styleClass="badge badge-header badge-danger" rendered="{!approvals.size > 0}">
                                    <apex:outputText value="{!approvals.size}" />
                                </apex:outputPanel>
                            </a>
                        </li>


                        <li class="btn-hover-info hidden-xs" data-placement="bottom" data-original-title="{!$Label.ECOPortalOutlook}">
                            <a href="outlook:Inbox" style="cursor:pointer; padding:0 37px;">
                                <i class="fa fa-envelope fa-lg"></i><br />
                                <div class="menuText">Open Outlook</div>
                            </a>
                        </li>

                        <li class="dropdown hidden-xs" style="margin:0 5px;">
                            
                            <button class="btn btn-primary" onclick="javascript:showNewProjectMessage();" style="margin:12px 0 0 0;">{!$Label.ECOPortalProject}</button>
                            
                        </li>

                        <li class="dropdown hidden-xs">
                            <button class="btn btn-success" onclick="goToNewOpportunityWithPermCheck();" style="margin:12px 0 0 0;" >{!$Label.ECOPortalOpportunity}</button>
                        </li>

                    </ul>

                    <!-- SmartSearch Search Bar -->
                        <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
                       <!-- <script type="text/javascript">
                              $(function () {
                                if (!isOnSearchPage()) {
                                  Coveo.Rest.SearchEndpoint.configureOnPremiseEndpoint(â€˜your endpoint');
                                  $('#searchBox').coveo('initSearchBox', '/ECO_SmartSearch');
                                }
                              });
                             
                              function isOnSearchPage() {
                                return $('#search').length > 0;
                              }
                            </script>
                        <div class="coveo-search-section hidden-sm hidden-xs ecoFrameSearch">
                            <div class="coveo-searchBox-column">
                                <div class="coveo-search-section-wrapper">
                                    <div id="headerSearchBox" class="col-lg-3 col-md-3">
                                        <input type="search" placeholder="SEARCH..." class="CoveoQueryBox" /><span type="button" class="CoveoSearchButton" >Go</span>
                                    </div>
                                </div>
                            </div>
                        </div>-->

                    <ul class="nav navbar-top-links pull-right">
                        <!--User dropdown-->
                        <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
                        <li data-placement="bottom" data-original-title="{!$Label.ECOPortalHome}"><a href="/apex/ECO_Portal"><img src="{!URLFOR($Resource.ECO_SmartSearchAssets, 'ss_homeIcon.png')}" /><br />
                        <div class="menuText">Home</div>
                        </a></li>
                        <li data-placement="bottom" data-original-title="{!$Label.ECOPortalSmartSearch}"><a style="padding:0 36px !important;" href="/apex/ECO_SmartSearch"><img src="{!URLFOR($Resource.ECO_SmartSearchAssets, 'ss_searchIcon.png')}" /><br />
                        <div class="menuText">Smart Search</div>
                        </a></li>

                        <li class="hidden-xs AWAN"  data-placement="bottom" data-original-title="{!$Label.ECOPortalHelp}" >
                            <a href="http://my.aecomnet.com/Intranet/About/Delivery%20Excellence/Ecosystem/Training" target="_blank"><i class="fa fa-question-circle"></i><br />
                        <div class="menuText">Help</div></a>
                        </li>

                        <li id="dropdown-user" class="dropdown">
                            <a href="#" data-toggle="dropdown" class="dropdown-toggle text-right">
                                <span class="pull-right">
                                    <apex:image value="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/loader.gif')}" html-data-original="{!photoUrl}" styleClass="img-circle img-user media-object lazy"/>
                                    
                                </span>
                                <div class="username visible-lg"><strong><apex:outputText value="{!theUser.Name}'s" /></strong> {!$Label.Ecosystem}</div>
                            </a>

                            <div class="dropdown-menu dropdown-menu-md dropdown-menu-right with-arrow panel-default">

                                <!-- Dropdown heading  -->
                                <div class="pad-all bord-btm">
                                    You are logged in as: <strong><apex:outputText value="{!theUser.Name}" /></strong>
                                </div>


                                <!-- User dropdown menu -->
                                <ul class="head-list">
                                    <li>
                                        <a href="/_ui/core/userprofile/UserProfilePage?tab=sfdc.ProfilePlatformFeed" target="_profilePage">
                                            <i class="fa fa-user fa-fw fa-lg"></i> Profile
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/ui/setup/Setup?setupid=PersonalSetup" target="_settingsPage">
                                            <i class="fa fa-gear fa-fw fa-lg"></i> Settings
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://aecom.okta.com/" target="_ssoPage">
                                            <i class="fa fa-gear fa-fw fa-lg"></i> {!$Label.ECOSSO}
                                        </a>
                                    </li>
                                </ul>

                                <!-- Dropdown footer -->
                                <div class="pad-all text-right">
                                    <a href="https://aecom--ecosysdev.cs15.my.salesforce.com/secur/logout.jsp" class="btn btn-primary">
                                        <i class="fa fa-sign-out fa-fw"></i> Logout
                                    </a>
                                </div>
                            </div>
                        </li>
                        <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
                        <!--End user dropdown-->

                        <li class="logo" style="padding:12px 15px 0 8px;">
                            <img src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/loader.gif')}" data-original="{!URLFOR($Resource.ECO_CustomGraphicAssets, 'AECOMLogo.jpg')}" height="25px" class="hidden-xs lazy" />
                            <img src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/loader.gif')}" data-original="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/EcosystemMark.jpg')}" class="visible-xs lazy" height="25px" />
                        </li>

                    </ul>
                </div>
                <!--================================-->
                <!--End Navbar Dropdown-->

            </div>
        </header>
        <!--===================================================-->
        <!--END NAVBAR-->

        <div class="boxed">

            <!--CONTENT CONTAINER-->
            <!-- 
               Contains the following:
                 1) show/hide reports button and ticker messages
                 2) followed by news feed and chatter
                 3) followed by projects portfolio 
                 4) followed by graphs 
            -->
            <!--===================================================-->
            <div id="content-container">

                <a class="aside-toggle hidden-xs" href="#" title="{!$Label.ECOPortalshowhideReports}"> 
                    <div class="reportsMenuButton" title="{!$Label.ECOPortalshowhideReports}">
                        <i class="fa fa-file" style="font-size:20px; color:#fff; margin:-5px 0 0 3px"></i><br />
                        <div class="menuText" style="bottom:7px;">Reports</div>
                    </div>
                </a>


                <apex:outputPanel layout="none" rendered="{!AND(tickerMessages != NULL, tickerMessages.size > 0)}" >
                    <div class="gallery autoplay items-{!tickerMessages.size}">
                        <apex:repeat value="{!tickerMessages}" var="message" >
	                        <apex:outputPanel layout="none" rendered="{!AND(message.NewsFeedTranslations__r != NULL, message.NewsFeedTranslations__r.size>0)}">
	                            <div id="item-{!message.Order__c}" class="control-operator"></div>
	                            <figure class="item">
	                            	<h4 id="tickerHeader">{!message.NewsFeedTranslations__r[0].Subject__c}</h4>
	                            	<apex:outputText value="{!message.NewsFeedTranslations__r[0].LongDescription__c}" />
	                            </figure>
	                        </apex:outputPanel>
                        </apex:repeat>

                        <div class="controls">
                            <apex:repeat value="{!tickerMessages}" var="message" >
                            	<apex:outputPanel layout="none" rendered="{!AND(message.NewsFeedTranslations__r != NULL, message.NewsFeedTranslations__r.size>0)}">
                                	<a href="#item-{!message.Order__c}" class="control-button">&bull;</a>
                                </apex:outputPanel>
                            </apex:repeat>
                        </div>
                    </div>
                </apex:outputPanel>

                
                <!--Page content-->
                <!--===================================================-->
                <div id="page-content">


                    
                    <div class="row">




                        <div class="col-lg-7">
                    
                            <div id="newsFeed" class="panel">
                                <div class="panel-heading">
                                    <div class="panel-control">
                                        
                                    </div>
                                    <a name="newsFeed" style="height:0;"></a>
                                    <h3 class="panel-title">{!$Label.ECOPortalNewsFeed}</h3>
                                </div>

                                <div class="panel-body collapse in nano"  style="max-height:372px; min-height:372px;">
                                    <div class="nano-content pad-all">
                                        <!-- REPEAT THIS -->
                                        <apex:repeat value="{!newsFeed}" var="feedItem" >
                                        	<apex:outputPanel layout="none" rendered="{!AND(feedItem.NewsFeedTranslations__r != NULL, feedItem.NewsFeedTranslations__r.size>0)}">
                                            <div class="row">
                                                <div class="col-sm-2">
                                                    <apex:image value="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/loader.gif')}" html-data-original="{!feedItem.FullImageUrl__c}" styleClass="media-object hidden-xs lazy" rendered="{!feedItem.FullImageUrl__c != ''}"/>
                                                    <apex:image value="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/loader.gif')}" html-data-original="{!$Resource.ECO_DELogo}" styleClass="media-object hidden-xs lazy" rendered="{!feedItem.FullImageUrl__c == ''}"/>
                                                </div>
                                                <div class="col-sm-10" style="line-height:165%;">
                                                	<apex:outputPanel layout="none" rendered="{!AND(feedItem.NewsFeedTranslations__r != NULL, feedItem.NewsFeedTranslations__r.size>0, feedItem.NewsFeedTranslations__r[0].LinkToRecord__c != '')}">
                                                        <a href="{!feedItem.NewsFeedTranslations__r[0].LinkToRecord__c}" class="linkFix hidden-xs" target="_newsFeedItem{!feedItem.Id}">
                                                            {!feedItem.NewsFeedTranslations__r[0].Subject__c}
                                                        </a>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel layout="none" rendered="{!AND(feedItem.NewsFeedTranslations__r != NULL, feedItem.NewsFeedTranslations__r.size>0, feedItem.NewsFeedTranslations__r[0].LinkToRecord__c == '')}">
                                                        <h2 style="line-height:200%;">
                                                        	<apex:outputText value="{!feedItem.NewsFeedTranslations__r[0].Subject__c}" />
                                                    	</h2>
                                                    </apex:outputPanel>
                                                    <br />
													<div class="nf">
														<p>{!feedItem.NewsFeedTranslations__r[0].LongDescription__c}</p>
													</div>
													
													<br />
                                                    <span style="color:#c6c6c6; font-size:10px; margin-top:5px; display:block;">
                                                        <!-- Posted on Feb. 26th, 2015 | By: This Person -->
                                                        <apex:outputText value="{!$Label.ECOPortalPostedOn} {!feedItem.StartDate__c} | {!$Label.ECOPortalBy}:  {!feedItem.User__r.Name} "/>
                                                    </span>
                                                </div>
                                                <div class="col-sm-12">
                                                    <hr />
                                                </div>
                                            </div>
                                            </apex:outputPanel>
                                        </apex:repeat>
                                        <!-- END REPEAT -->
                                    </div>
                                </div>
                            </div>
                        </div>




                        <div class="col-lg-5">

                    
                            <!--Chat Widget-->
                            <div class="panel hidden-xs">
                    
                                <!--Chat widget header-->
                                <div class="panel-heading">
                                    <a href="/home/home.jsp" target="_blank">
                                    <div class="panel-control">
                                        <div class="btn-group">
                                        <i class="fa fa-sign-in" style="float:right; font-size:16px; margin-right:6px;"></i>
                                        </div>
                                    </div>
                                    <a name="chatterFeed" style="height:0;"></a>
                                    <h3 class="panel-title">{!$Label.ECOPortalChatter}</h3>
                                    </a>
                                </div>
                    
                                <!--Chat widget body-->
                                <div class="panel-body collapse in nano" style="padding-top:5px; max-height:372px; min-height:372px;">
                                    <div class="nano-content pad-all">
                                        <!-- <chatter:feed entityId="{!$User.Id}" /> -->
                                        <chatter:newsFeed />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END FIRST ROW -->


                    <!--START SECOND ROW My Projects portfolio  -->
                    <div id="myProjectsPortfolio" class="row">
                        <div class="col-lg-12">
                    
                            <div class="panel">
                                <div class="panel-heading">
                                    <div class="panel-control hidden-xs">
                                        <apex:form id="selecterForm">
                                            <apex:actionFunction name="changeProjectOutputType" action="{!changeProjectOutputType}" />
                                            
                                             <apex:selectList value="{!selectedOutputType}" multiselect="false" onchange="changeProjectOutputType();" size="1" >
                                                <apex:selectOptions value="{!projectOutputTypes}"/>
                                             </apex:selectList>
                                            
                                             <apex:actionFunction name="apexRefreshProjects" action="{!refreshProjects}" />

                                             Show Closed&nbsp;<apex:inputCheckbox value="{!showClosed}" onchange="apexRefreshProjects();" />
                                            
                                             Show for Roles&nbsp;<apex:inputField value="{!ptmPickListProvider.Role__c}" onchange="apexRefreshProjects();" />
                                        </apex:form>
                                    </div>
                                    <a name="myProjects" style="height:0;"></a>
                                    <h3 class="panel-title">{!$Label.ECOPortalMyProjectsPortfolio}</h3>
                                </div>

                                <div class="tempAlert" style="margin:8px 20px;">
                                    {!$Label.ECOPortalMyProjectsPortfolioMessage}
                                </div>

   
								<div class="panel-body myProjectsPortfolio nano has-scrollbar">
                                    <div class="table-responsive hidden-xs nano-content" id="portfolioTable">
                                        <table id="projectsTable" class="table table-striped table-hover tablesorter">
                                            <thead>
                                                <tr>
                                                    <apex:repeat: value="{!fieldSetFields}" var="field" id="headerRepeater" >
                                                        <th>
                                                            {!field.Label}
                                                        </th>
                                                    </apex:repeat:>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <apex:repeat value="{!projects}" var="p">
                                                    <tr>
                                                        <apex:repeat: value="{!fieldSetFields}" var="fieldName" id="rowRepeater">
                                                            <td>
                                                                <apex:outputField value="{!p[fieldName]}" />
                                                            </td>
                                                        </apex:repeat:>
                                                    </tr>
                                                </apex:repeat>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                               
                            </div>
                        </div>
                    </div> 
<!--                END 2nd Row (my projects table)    -->

           
                    <div class="row">
                    <a name="graphs" style="height:0;"></a>
            
                        <!-- CLIENT CARE PROGRAM -->
                        <div class="col-md-4">
                            <div class="panel panel-dark panel-colorful">
                                <div class="panel-body text-center">
                                    <p class="text-uppercase mar-btm text-sm">{!$Label.ECOPortalClientCareProgram}</p>
                                    <div id="client-care-program" class="box-inline "></div>
                                    <hr />
                                    <p class="h2 text-thin">{!$Label[clientCareNpsTextLabel]}</p>
                                </div>
                            </div>
                        </div>
            
            
                        <!-- SAFETY -->
                        <div class="col-md-4">
                            <div class="panel panel-danger panel-colorful">
                                <div class="panel-body text-center">
                                    <p class="text-uppercase mar-btm text-sm">{!$Label.ECOPortalTotalCaseIncidentRate}</p>
                                    <!-- Dynamic graph out <div id="demo-sparkline-bar" class="box-inline "></div> -->

                                    <!--Gauge placeholder-->
                                    <canvas id="case-incident-rate" height="120" class="canvas-responsive"></canvas>
            
                                    <p class="h4" style="display:none;">
                                        <span id="case-incident-rate-txt" class="label label-primary"></span>
                                    </p>
                                    <hr />

                                    <p class="h2 text-thin">{!$Label[incidentRateTextLabel]}</p>
                                </div>
                            </div>
                        </div>

                        <!-- TPN -->
                        <div class="col-md-4">
                            <div class="panel panel-primary panel-colorful">
                                <div class="panel-body text-center">
                                    <p class="text-uppercase mar-btm text-sm">{!$Label.ECOPortalTechincalPracticeNetworks}</p>
                                    <div id="technical-practice-networks" style="height:120px"></div>
                                    <hr />
                                    <p class="h2 text-thin">{!$Label.ECOPortalVisitorData}</p>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">
                        <div class="col-sm-3">
                        </div>

                        <div class="col-sm-6" style="text-align:center;">
                            <div class="tempAlert">
                                {!$Label.ECOPortalAlertMessage}
                            </div>
                        </div>

                        <div class="col-sm-3">
                        </div>
                    </div>
            
                            
                </div>
                <!--===================================================-->
                <!--End page content-->

            </div>
            <!--===================================================-->
            <!--END CONTENT CONTAINER-->


            
            <!--AECOM APPS: Edit and List all apps-->
            <!--===================================================-->
            <nav id="mainnav-container">
                <div id="mainnav" >

                    <!--Menu-->
                    <!--================================-->
                    <div id="mainnav-menu-wrap">
                        <div class="nano">
                            <div class="nano-content"> <!-- took out classes:  ui-widget-content hoverscroll vertical" style="height:85vh !important;" -->
                                <!-- THIS OUT FOR NOW 3/20/2015, FOR APP SCROLLING <div class="fixed-listcontainer"> -->
                                    <ul id="mainnav-menu" class="list-group">

                                        <li class="visible-xs showAllApps">
                                            <a href="#">
                                                <div class="media-left">
                                                    <i class="fa fa-eye" style="font-size:33px; padding-left:1px;"></i>
                                                </div>
                                                <div class="media-body menu-title showHideSwap visible-xs" style="height:35px;">
                                                    Show Non-Mobile Applications
                                                </div>
                                                <div class="media-body menu-title showHideSwap hidden-xs" style="height:35px;">
                                                    Hide Non-Mobile Applications
                                                </div>
                                            </a>
                                        </li>


                                        <li class="editApps">
                                            <a href="#" onclick="goToApplicationConfiguration();">
                                                <div class="media-left">
                                                    <i class="fa fa-cog" style="font-size:33px; padding-left:1px;"></i>
                                                </div>
                                                <div class="media-body menu-title" style="height:35px;">
                                                    {!$Label.ECOEditAecomApps} 
                                                </div>
                                            </a>
                                        </li>

                                        <apex:repeat value="{!applications}" var="app" >
                                            <apex:outputPanel rendered="{!!app.IsHidden__c}" layout="none">
                                                <li class="{!app.Application__r.NetworkRequirement__c} {!IF(app.Application__r.MobileEnabled__c, '', 'hiddenOnMobile')} anApplication">
                                                    <a target="_blank" href="{!app.Application__r.ApplicationURL__c}">
                                                        <div class="media-left">
                                                            <apex:image value="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/img/loader.gif')}" html-data-original="{!URLFOR($Resource.ECO_CustomGraphicAssets, app.Application__r.ImageName__c)}" styleClass="lazy" width="33px" height="33px" />
                                                        </div>
                                                        <div class="media-body menu-title" style="height:35px;">
                                                            <apex:outputText value="{!$Label[app.Application__r.ApplicationName__c]}" />
                                                        </div>
                                                    </a>
                                                    
                                                </li>
                                            </apex:outputPanel>
                                        </apex:repeat>
                                        


                                    </ul>
                                <!-- END THIS OUT FOR NOW 3/20/2015 </div> -->

                            </div>
                        </div>
                    </div>
                    <!--================================-->
                    <!--End menu-->

                </div>
            </nav>
            <!--===================================================-->
            <!--END MAIN NAVIGATION-->


            <!--ASIDE: Edit Reports and list reports -->
            <!--===================================================-->
            <aside id="aside-container">
                <div id="aside">
                    <div class="nano has-scrollbar">
                        <div class="nano-content">
                            <div class="tab-pane fade in active" id="demo-asd-tab-1">
	                        	<div class="navbar-header">
				                    <a class="navbar-brand" style="cursor:default;">
				                        <div class="brand-title" style="text-align:center;">
				                            <span class="brand-text"><span style="color:#D2D2D2; display:inline;">SELECTED</span> REPORTS</span>
				                        </div>
				                    </a>
				                </div>

			                <!-- OLD TITLE OUT FOR NOW, 7/7/2015, ANDREW SMITH
                                <h4 class="pad-hor text-thin">
                                    <a style="margin:0 25px 0 5px; cursor:pointer; float:right;">Selected {!$Label.ECOPortalReports}</a>
                                </h4>
                            -->
                                
                                <div>
                                    <div class="list-group bg-trans">
                                    	<div class="editReports editApps" style="float:left; display:block">
	                                		<a style="cursor:pointer" onclick="goToReportsBuilder()" class="list-group-item">
	                                    		<div class="media-left">
	                                            	<i class="fa fa-cog" style="font-size:22px;" title="{!$Label.ECOPortalEditReports}"></i>
	                                            </div>
	                                			<div class="media-body menu-title">
	                                				Edit Reports
	                                			</div>
	                            			</a>
                            			</div>
   
                                        <apex:repeat value="{!reports}" var="report" >
	                                    	<div style="float:left; display:block">
		                                        <apex:outputLink value="/{!report.ReportId__c}" styleClass="list-group-item" target="_Report-{!report.ReportId__c}">
		                                            <div class="media-left">
		                                                <i class="fa fa-file" style="font-size:20px; padding-top:5px;"></i>
		                                            </div>
		                                            <div class="media-body">
		                                                <apex:outputText value="{!report.ReportName__c}" />
		                                            </div>
		                                        </apex:outputLink>
	                                        </div>
                                        </apex:repeat>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </aside>
            <!--===================================================-->
            <!--END ASIDE-->
        </div>


        <!-- FOOTER -->
        <!--===================================================-->
        <footer id="footer">
            <div class="hide-fixed pull-right pad-rgt"></div>


            <p class="pad-lft">&#0169; 2015 AECOM</p>


        </footer>
        <!--===================================================-->
        <!-- END FOOTER -->

        <!-- SCROLL TOP BUTTON -->
        <!--===================================================-->
        <button id="scroll-top" class="btn"><i class="fa fa-chevron-up"></i></button>
        <!--===================================================-->

    </div>
    <!--===================================================-->
    <!-- END OF CONTAINER -->


    
    <apex:includeScript value="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/jquery.sparkline.min.js')}" />
    
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/jquery.sparkline.min.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/bootstrap.min.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/nifty.min.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/morris.min.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/raphael.min.js')}"></script>
    <!-- out for now, this was for scrolling APPs
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/jquery.hoverscroll.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/jquery.simplyscroll.min.js')}"></script>
    -->
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/gauge.min.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/ECO_PortalSpecificJS.min.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/readmore.min.js')}"></script>
    <script src="{!URLFOR($Resource.ECO_NiftyAssets, 'ECO_NiftyAssets/js/jquery.tablesorter.min.js')}"></script>
    
    

    <script>
        // CLIENT CARE PROGRAM
        // =================================================================
        $("#client-care-program").sparkline(["{!$Setup.ECO_Portal_Graph_Settings__c.Client_Care_Promoter__c}", "{!$Setup.ECO_Portal_Graph_Settings__c.Client_Care_Passive__c}", "{!$Setup.ECO_Portal_Graph_Settings__c.Client_Care_Detractor__c}"], {
            type: 'pie',
            width: '120',
            height: '120',
            tooltipChartTitle: '{!$Label.ECOPortalClientCareProgram}',
            tooltipFormat: '{{offset:offset}} ({{percent.1}}%)',
            tooltipValueLookups: {
                'offset': {
                    0: '{!$Label.ECOPortalPromoter}',
                    1: '{!$Label.ECOPortalPassive}',
                    2: '{!$Label.ECOPortalDetractor}',
                }
            },
            sliceColors: ['#7ad689','#fec311','#fe2d11'],
        });

        // TECHNICAL PRACTICE NETWORKS
        // =================================================================
        Morris.Area({
            element: 'technical-practice-networks',
            data: [{
                period: '{!$Label.ECOPortalJanuary}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Jan_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Jan_UP__c} 
                }, {
                period: '{!$Label.ECOPortalFebruary}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Feb_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Feb_UP__c}
                }, {
                period: '{!$Label.ECOPortalMarch}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Mar_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Mar_UP__c}
                }, {
                period: '{!$Label.ECOPortalApril}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Apr_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Apr_UP__c}
                }, {
                period: '{!$Label.ECOPortalMay}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_May_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_May_UP__c}
                }, {
                period: '{!$Label.ECOPortalJune}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Jun_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Jun_UP__c}
                }, {
                period: '{!$Label.ECOPortalJuly}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Jul_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Jul_UP__c}
                }, {
                period: '{!$Label.ECOPortalAugust}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Aug_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Aug_UP__c}
                }, {
                period: '{!$Label.ECOPortalSeptember}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Sep_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Sep_UP__c}
                }, {
                period: '{!$Label.ECOPortalOctober}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Oct_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Oct_UP__c}
                }, {
                period: '{!$Label.ECOPortalNovember}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Nov_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Nov_UP__c}
                }, {
                period: '{!$Label.ECOPortalDecember}',
                dl: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Dec_DL__c},
                up: {!$Setup.ECO_Portal_Graph_Settings__c.Visitor_Date_Dec_UP__c}
            }],
            gridEnabled: false,
            gridLineColor: 'transparent',
            behaveLikeLine: true,
            xkey: 'period',
            ykeys: ['dl', 'up'],
            labels: ['{!$Label.ECOPortalVisitors}', '{!$Label.ECOPortalPageviews}'],
            lineColors: ['#00729d'],
            pointSize: 0,
            pointStrokeColors : ['#00729d'],
            lineWidth: 0,
            resize:true,
            hideHover: 'auto',
            fillOpacity: 0.7,
            parseTime:false,
            gridTextColor: ['#fff']
        });

        // CASE INDICENT RATE (Safety)
        // =================================================================
        var opts = {
            lines: 10, // The number of lines to draw
            angle: 0, // The length of each line
            lineWidth: 0.3, // The line thickness
            pointer: {
                length: 0.45, // The radius of the inner circle
                strokeWidth: 0.035, // The rotation offset
                color: '#231f20' // Fill color
            },
            limitMax: 'true', // If true, the pointer will not go past the end of the gauge
            colorStart: '#59ba47', // Colors
            colorStop: '#59ba47', // just experiment with them
            strokeColor: '#ddd', // to see which ones work best for you
            generateGradient: true
        };

        var target = document.getElementById('case-incident-rate'); // your canvas element
        var gauge = new Gauge(target).setOptions(opts); // create sexy gauge!
        gauge.maxValue = 6; // set max gauge value
        gauge.animationSpeed = 32; // set animation speed (32 is default value)
        gauge.set({!$Setup.ECO_Portal_Graph_Settings__c.Incident_Rate_YTD_TCIR__c}); // set actual value
        gauge.setTextField(document.getElementById("case-incident-rate-txt"));

        // GOOGLE ANALYTICS
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ 
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), 
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) 
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); 

        ga('create', 'UA-33974532-22', 'auto'); 
        ga('send', 'pageview'); 

        function goToNewOpportunityWithPermCheck() {
          	var hasOpptyAccess =  {!$ObjectType.Opportunity.accessible};
           	if (!hasOpptyAccess) {
           		alert("{!$Label.ECOPortalNoOppAlert}");
           	} else {
           		goToNewOpportunity();
           	}
		}

		function showNewProjectMessage() {
			alert("{!$Label.ECOPortalProjectMessage}");
		}
    </script>

        </apex:define>
    </apex:composition>
</body>
</apex:page>