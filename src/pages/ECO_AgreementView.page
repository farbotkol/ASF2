<apex:page standardController="Agreement__c" showHeader="true" sidebar="true" extensions="ECO_AgreementController" action="{!init}">
<apex:pageMessages id="pageMessages"/>

    <style>
        .attachNewFile{
            visibility: hidden;
        }
        
        .tempAlert{
            text-align:center;
            padding:10px 15px;
            background-color:#fff996;
            font-size:13px;
            font-weight:bold;
            border:1px solid #FFDC48;
        }
        
        .tableStyle {border-collapse: collapse; border-spacing: 1px 1px; }
        .colStyle1 { width: 50%; padding: 2px 2px 2px 2px;  }
        .colStyle2 { width: 50%; padding: 0px 0px 0px 0px;                  }
        .rowstyle { border-bottom-style:solid; border-bottom-width:0px; border-bottom-color:#E8E8E8 }
        
        body .bPageBlock .pbBody .labelCol{
            padding-top: 3px !important;
            padding-bottom: 5px;
            vertical-align: middle;
        }       
       
        .halfWidthWrapper {
            width:50%;
            display:inline-block;
            float:left;
        }
        
        #notifications{
            margin-left:50%;
            padding-left:20px;
        }
              	
        .customHelpIcon
        {
            display:inline-block;
            margin:0 5px 0 0;
            width:24px;
            height:24px;
            vertical-align:top !important;
        }
        /* CUSTOM HELP / GUIDANCE TEXT BOX */
        .customHelpText{
            padding: 7px;
            border: 1px solid #85B3CE;
            min-height: 10px;
            display: block;
            width: auto;
            margin: 0 0 5px 0;
            background-repeat: no-repeat;
            border-radius: 4px;
            background-color: #A2D3F1;
            
        }
        .customHelpBody{
            display:inline-block;
            color:#;
            max-width:95%;
        }           
        
        .infoTable {
            background: #f5f5f5;
            border-collapse: separate;
            font-size: 12px;
            line-height: 24px;
            text-align: left;
            margin:5px 14px 0 14px;
        }   
        .infoTable table{
            width:100%;
        }
        .infoTable th {
            background-color: #a6afa2 !important;
            color: #fff;
            font-weight: bold;
            padding: 3px 9px;
            position: relative;
            border:none !important;
        }
        .infoTable th:first-child{
            border-right:1px solid #fff !important;
        }

        .infoTable th:after {
            content: '';
            display: block;
            height: 25%;
            left: 0;
            margin: 1px 0 0 0;
            position: absolute;
            top: 25%;
            width: 100%;
        }
        .infoTable td {
            border-right: 1px solid #fff;
            border-left: 1px solid #e8e8e8;
            border-top: 1px solid #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 3px 9px;
            position: relative;
            transition: all 300ms;
            min-width: 90px;
        }   
        .printAgreement{
            padding:4px !important;
        } 

        .billRateTable {
          font-family: 'Arial';
          margin: 25px auto;
          border-collapse: collapse;
          /*border: 0px solid #eee;*/
          box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.1), 0px 10px 20px rgba(0, 0, 0, 0.05), 0px 20px 20px rgba(0, 0, 0, 0.05), 0px 30px 20px rgba(0, 0, 0, 0.05);
          width: 100%
        }

        .billRateTable tr{
          border-bottom: 1px solid #f2f3f3;
        }

        .billRateTable tr:hover {
          background: #e8f4f8;
        }

        .billRateTable tr:hover td {
            background: #e8f4f8;
        }

        .billRateTable th, .billRateTable td {
          border: 0px solid #eee;
          /*padding: 8px 2px 8px 5px;*/
          border-collapse: collapse;
        }

        .billRateTable td {
          background: #fff;
        }

        .billRateTable th {

          background:  #f2f3f3;
          font-size: .9em;
          font-weight: bold;  
          border: 0px solid #D3D3D3;
        }

        .billRateTable th.last {
          border-right: none;
        }
                 
        tr.dataRow {
           background-color:white;
         }
        
        tr.dataRow:hover {
           background-color: #e3f3ff;
         };

    </style>

<script>



    function fileChosen(attachButton,documentField,overrideField)
    {
        if(documentField.value != '')
        {
            document.getElementById(attachButton).style.visibility = 'visible';         
            document.getElementById(overrideField).value = '';
            document.getElementById(overrideField).style.visibility = 'visible';
                        
        }
        else
        {
            document.getElementById(attachButton).style.visibility= 'hidden';
            document.getElementById(overrideField).style.visibility= 'hidden';          
        }       
    }
    
    function fileChosen2(attachButton,documentField,overrideField,comments)
    {
        if(documentField.value != '')
        {
            document.getElementById(attachButton).style.visibility = 'visible';         
            document.getElementById(overrideField).value = '';
            document.getElementById(overrideField).style.visibility = 'visible';
            document.getElementById(comments).style.visibility = 'visible';
                        
        }
        else
        {
            document.getElementById(attachButton).style.visibility= 'hidden';
            document.getElementById(overrideField).style.visibility= 'hidden'; 
            document.getElementById(comments).style.visibility= 'hidden';                    
        }       
    } 
    
    function fileChosen3(attachButton,documentField,overrideField,picklist, comments)
    {
        if(documentField.value != '')
        {
            document.getElementById(attachButton).style.visibility = 'visible';         
            document.getElementById(overrideField).value = '';
            document.getElementById(overrideField).style.visibility = 'visible';
            document.getElementById(picklist).style.visibility = 'visible';
            document.getElementById(comments).style.visibility = 'visible';
                        
        }
        else
        {
            document.getElementById(attachButton).style.visibility= 'hidden';
            document.getElementById(overrideField).style.visibility= 'hidden'; 
            document.getElementById(picklist).style.visibility= 'hidden'; 
            document.getElementById(comments).style.visibility = 'hidden';                   
        }       
    }   

    function scopeChanged(scopeField, editField)
    {
        if(scopeField.value == '')
        {
            alert('Empty');
            document.getElementById(editField).style.visibility= 'hidden';
        }
        else
        {
            alert('Not Empty');
            document.getElementById(editField).style.visibility = 'visible';
        }
    }

    
    function primeScopeChanged()
    {
        primeScopeChanged();
    }
    
    function subScopeChanged()
    {
        subScopeChanged();
    }

    function changedAgreementStatus()
    {
        agreementStatusChanged();
    }
    
    function paymentTermChanged()
    {
        paymentTermChanged();
    }
    
</script>


    <apex:outputPanel rendered="{!agreementRecordType =='Prime'}">
        <apex:sectionHeader title="Prime Agreement Edit" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode!= ''}"/>
        <apex:sectionHeader title="Prime Agreement" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode == ''}"/>
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType =='Other'}">
        <apex:sectionHeader title="Other Agreement Edit" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode!= ''}"/>
        <apex:sectionHeader title="Other Agreement" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode == ''}"/>
    </apex:outputPanel>
      
   <apex:outputPanel rendered="{!agreementRecordType =='Prime Interim Agreement'}">
        <apex:sectionHeader title="Prime Interim Agreement Edit" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode!= ''}"/>
        <apex:sectionHeader title="Prime Interim Agreement" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode == ''}"/>
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType =='Joint Venture'}">
        <apex:sectionHeader title="Joint Venture Agreement Edit" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode!= ''}"/>
        <apex:sectionHeader title="Joint Venture Agreement" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode == ''}"/>
    </apex:outputPanel>    

    <apex:outputPanel rendered="{!agreementRecordType =='Sub'}">
        <apex:sectionHeader title="{!'Sub Agreement ' + mode}" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}"/>
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType =='Inter-Company'}">
        <apex:sectionHeader title="{!'Inter-Company Agreement ' + mode}" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}"/>
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType =='Prime Task Order'}">
        <apex:sectionHeader title="{!'Prime Task Order Agreement ' + mode}" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}"/>
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType =='Prime (MSA)'}">
        <apex:sectionHeader title="Prime (MSA) Edit" subtitle="{!Agreement__c.SectionHeaderSubtitle__c}" rendered="{!mode!= ''}"/>
        <apex:sectionHeader title="{!'Master Services Agreement'}" subtitle="{!agreement.ContractTitle__c}({!agreement.AgreementNumber__c})" rendered="{!mode = ''}"/>
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType !='Prime (MSA)'}">
        <div class="customHelpText">
            <div class="customHelpBody">
                This section captures the basic information for the respective project agreement.  Once the record has been created, upload supporting documentation, including but not limited to, the executed agreement, record of negotiations, variations, subcontractor bid documents, intercompany agreement backup.  A prime agreement record must be created to manage and the executed agreement attached as part of budget setup in Oracle.  For subcontract agreements, a record must be created for each vendor, subcontractor or sub-consultant prior to requesting a purchase order.   <br /><br />
 
                Requests for contract review from the legal team can also be actioned from this screen for each type of agreement.
            </div>
        </div> 
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType =='Prime (MSA)'}">
        <div class="customHelpText">
            <div class="customHelpBody">
                Master Service Agreements (MSA) are any type of multi-use, task order contract for general consulting services between AECOM and the client where the client orders individual services within a single project or for multiple projects.   These types of agreements may also referred to as panel agreements, on-call contracts or Indefinite Deliverable/Indefinite Quantity (ID/IQ) contracts. <br/><br/>   

                The MSA Manager captures basic information in a unique contract record for project teams to reference when pursuing and executing task order projects, and for contract owners (e.g., Program Manager, Contract Manager) to manage the portfolio of task order projects entered in the Ecosystem.   As such, the record should be maintained for the life of the agreement to reflect the most current and accurate information. 
            </div>
        </div> 
    </apex:outputPanel>


    <apex:outputPanel rendered="{!agreementRecordType != 'Prime (MSA)' && agreementRecordType != 'Joint Venture' && agreementRecordType != 'Prime' && agreementRecordType != 'Sub' && agreementRecordType != 'Inter-Company' && agreementRecordType != 'Prime Task Order' && agreementRecordType != 'Other' && agreementRecordType != 'Prime Interim Agreement'}">
        <apex:detail relatedList="treu" title="Test" inlineEdit="false"/>   
        <apex:form >
        <apex:pageBlock >
            <apex:pageBlockSection >
                <apex:outputField value="{!agreement.Name}" />
            
            </apex:pageBlockSection>
        
            <br />
            <br />
            <apex:outputText value="Agreement Record Type:"/><apex:outputText value="{agreementRecordType}"/>
            <apex:outputtext value="Reminder: Prior to initiating a contract review, contact the relevant Client Account Manager, Program Manager or Contract Manager to assess any account-specific procedures or lessons learned from previous contracting exercises, and to avoid potential duplicate reviews." />
            <br />
            <br />
            <apex:commandButton value="Initiate Contract Review" />
            <br />
            <br />
    
    
        </apex:pageBlock>
        </apex:form>
    
        <apex:relatedList list="CombinedAttachments"/>
    
        <apex:relatedList list="PurchaseOrders__r"/>
        
        <apex:relatedList list="Funding__r" />
    
    </apex:outputPanel>

    <apex:outputPanel rendered="{!agreementRecordType =='Prime'}" id="primeSection">
    <apex:form > 
        <apex:actionFunction id="primeScopeChanged" name="primeScopeChanged" action="{!primeScopeChangedApex}" onComplete="window.location.reload();"/>
        <apex:actionFunction id="changedPrimeAgreementStatus" name="changedPrimeAgreementStatus" rerender="primeExecutionDetails" immediate="true"/>
        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Prime Agreement ' + mode}">
        <apex:pageBlockButtons >
            <apex:commandLink value="Print Agreement" action="{!printPdf}" styleClass="btn printAgreement" immediate="true" target="_blank" style="text-decoration:none" />
            <apex:commandButton value="Save" action="{!save}" rendered="{!mode != ''}"/>
            <apex:commandButton value="Return To Agreement" action="{!cancel}" rendered="{!mode == 'Edit'}"/>   
            <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode == ''}"/>   
            <apex:commandButton value="Initiate Contract Review" action="{!initiateContractReview}" rendered="{!mode == ''}"/>
            <apex:commandButton value="Return To Project" action="{!cancel}" rendered="{!mode == 'New' && agreement.Project__c != null}" immediate="true"/>
            <apex:commandButton value="Return To Project" action="{!URLFOR($Action.pse__Proj__c.view, agreement.Project__c)}" rendered="{!mode != 'New'}"/>
            <apex:commandButton value="Return To Project Agreements" action="{!returnToProjectAgreements}" rendered="{!mode == ''}" />
            <apex:commandButton value="Delete" rendered="{!contractReviewCount == 0 && agreement.AgreementNumber__c == null && mode == '' && agreement.AgreementStatus__c != 'Executed'}" action="{!deleteAgreement}"/>
            <apex:commandButton value="Cancel" action="{!cancel}" rendered="{!agreement.Project__c == null && mode =='New'}" />
        </apex:pageBlockButtons>
        <apex:pageBlockSection >

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Name.inlineHelpText}">
                <apex:outputText value="ECO Agreement Number"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Name}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Name}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementNumber__c.inlineHelpText}">
                <apex:outputText value="Oracle Agreement No"/>
                 <apex:outputPanel >
               <apex:outputField value="{!agreement.AgreementNumber__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementNumber__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem >
                <apex:outputText value="Agreement Status"/>
                <apex:outputPanel >
                    <apex:actionRegion>
                        <apex:inputField value="{!agreement.AgreementStatus__c}" rendered="{!mode != ''}">
                            <apex:actionSupport event="onchange" immediate="false" rerender="primeExecutionDetails"/>
                        </apex:inputField>
                    </apex:actionRegion>
                    <apex:outputField value="{!agreement.AgreementStatus__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem >
                <apex:outputText value="Project Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Project__c}" rendered="{!mode == 'New' && project == null}" required="true" />                  
                    <apex:outputField value="{!project.Name}" rendered="{!mode == 'New' && project != null}" />
                    <apex:outputField value="{!agreement.Project__r.Name}" rendered="{!mode != 'New'}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>             

            <!--<apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ParentAgreement__c.inlineHelpText}">
                <apex:outputText value="Parent Agreement"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ParentAgreement__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ParentAgreement__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>     
            </apex:pageBlockSectionItem> -->

            <apex:pageBlockSectionItem >
                <apex:outputText value="Billing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Account__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.Account__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>               

            <apex:pageBlockSectionItem >
                <apex:outputText value="Ecosystem Project Reference ID"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.EcoSystemReferenceNumber__c}" rendered="{!mode == 'New'}"/>              
                    <apex:outputField value="{!agreement.Project__r.EcoSystemReferenceNumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <!--<apex:pageBlockSectionItem >
                <apex:outputText value="Billing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Account__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.Account__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>     -->   
          
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProjectTeamMember__c.inlineHelpText}">
                <apex:outputText value="Agreement Owner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>          
       
            <apex:pageBlockSectionItem >
                <apex:outputText value="Oracle Project No"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.OracleProjectnumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.OracleProjectnumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>        
           
            </apex:pageBlockSection>    
 
<!--             <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.InvoicingClient__c.inlineHelpText}">
                <apex:outputText value="Invoicing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.InvoicingClient__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.InvoicingClient__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>    -->   
  
            <apex:pageBlockSection title="Contract Details" collapsible="false">

            <apex:pageBlockSectionItem >
                <apex:outputText value="Contract Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementType__c}" rendered="{!mode != ''}" required="true"/>               
                    <apex:outputField value="{!agreement.AgreementType__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>   

            <apex:pageBlockSectionItem helptext="The date the agreement record was created in Ecosystem (& Oracle)">
                <apex:outputText value="Create Date"/>
                <apex:outputField value="{!agreement.CreatedDate}"/>                
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ContractTitle__c.inlineHelpText}">
                <apex:outputText value="Contract Title/Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ContractTitle__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ContractTitle__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>    

             <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.StartDate__c.inlineHelpText}">
                <apex:outputText value="Start Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.StartDate__c}" rendered="{!mode != ''}"/>               
                    <apex:outputField value="{!agreement.StartDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>                           
          
             <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ClientContractReferenceNo__c.inlineHelpText}">
                <apex:outputText value="Client Contract Reference No."/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExpirationDate__c.inlineHelpText}">
                <apex:outputText value="End Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExpirationDate__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.ExpirationDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>                         
            </apex:pageBlockSectionItem>

             <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProfIndemnityLiabilityAmt__c.inlineHelpText}">
                <apex:outputText value="Prof Indemnity/Liability Amt"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode != ''}"/>   
                    <apex:outputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>                                         
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem >
                    <apex:outputText value="Contract Review Status"/>
                    <apex:outputPanel >
                        <apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
                    </apex:outputPanel>                                                 
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.PublicGeneralLiabilityAmt__c.inlineHelpText}">
                <apex:outputText value="Public/General Liability Amt"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode != ''}"/>               
                    <apex:outputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode == ''}"/>      
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>
  
            </apex:pageBlockSection>

        <apex:pageBlockSection columns="1">
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopePackage__c.inlineHelpText}">
                <apex:outputText value="Scope Package"/>
                <apex:outputPanel >
                        <apex:inputField value="{!agreement.ScopePackage__c}" rendered="{!mode != ''}" onchange="primeScopeChanged(); return true;"/>
                    <apex:outputField value="{!agreement.ScopePackage__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>    
                
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopeOfServices__c.inlineHelpText}">
                <apex:outputText value="Scope of Services"/>
                <apex:outputPanel id="primeScopeChanged">
                  <apex:inputField id="pscp1" style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode != '' && agreement.ScopePackage__c == null}"/>               
                    <apex:outputField id="pscp2" style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode == '' && agreement.ScopePackage__c == null}"/>
                    <apex:outputText id="pscp3" style="width: 780px" value="{!primeScopeText}" rendered="{!agreement.ScopePackage__c != null}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>    
        </apex:pageBlockSection>             

            <apex:pageBlockSection title="Financial (note - all values are in agreement currency)" collapsible="false">

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FeeType__c.inlineHelpText}">
                <apex:outputText value="Fee Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FeeType__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.FeeType__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>            
      
        <apex:pageBlockSectionItem >
            <apex:outputText value="Total Approved Revenue Limit"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.TotalApprovedRevenueLimit__c}" rendered="{!mode != ''}" />
                <apex:outputField value="{!agreement.TotalApprovedRevenueLimit__c}" rendered="{!mode == ''}"/>                        
            </apex:outputPanel>
        </apex:pageBlockSectionItem>
           
            <apex:pageBlockSectionItem >
                <apex:outputText value="Payment Terms"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode != ''}" required="true">
                    </apex:inputField>
                    <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>    

            <apex:pageBlockSectionItem >
                <apex:outputText value="Total Funding Amount"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}" required="true"/>              
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>
                      
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}">
                <apex:outputText value="Agreement Currency"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>  
 
            <apex:pageBlockSectionItem >
                <apex:outputText value="Unallocated Funding"/>        
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.UnallocatedFunding__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.UnallocatedFunding__c}" rendered="{!mode == ''}"/>                        
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementAmountEstimated__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (estimated)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode != ''}"/>                
                    <apex:outputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>  

            <apex:pageBlockSectionItem >
                <apex:outputText value="Variance (Confirmed - Approved Revenue Limit)"/>
                <apex:outputField value="{!agreement.AgreementVariance__c}"/>                
            </apex:pageBlockSectionItem>              
   
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Amount__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (confirmed and committed)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Amount__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.Amount__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
            </apex:pageBlockSectionItem>    
           
            <apex:pageBlockSectionItem >
                    <apex:outputText value="Variance Reason"/>
                    <apex:outputPanel >
                        <apex:inputField value="{!agreement.VarianceReason__c}" rendered="{!mode != ''}"/>  
                        <apex:outputField value="{!agreement.VarianceReason__c}" rendered="{!mode == ''}"/> 
                    </apex:outputPanel>                                                 
            </apex:pageBlockSectionItem>                                                                                             
        </apex:pageBlockSection>
        
        <apex:pageBlockSection title="Interim Agreement / Work At Risk  (if applicable)" collapsible="false" columns="2">
            <apex:pageBlockSectionItem >
                <apex:outputText value="Interim Approval Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.InterimApprovalType__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.InterimApprovalType__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Interim Approval Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.InterimApprovalDate__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.InterimApprovalDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Interim Approval Revenue/Fee Limit"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.InterimApprovalRevenueFeeLimit__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.InterimApprovalRevenueFeeLimit__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Interim Approval Expiry Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.InterimApprovalExpiryDate__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.InterimApprovalExpiryDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Interim Approval Cost Limit"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.InterimApprovalCostLimit__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.InterimApprovalCostLimit__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
        </apex:pageBlockSection>

        <apex:pageBlockSection columns="1">
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Interim Approval Comments"/>
                    <apex:outputPanel >
                        <apex:inputField style="width:780" value="{!agreement.InterimApprovalComments__c}" rendered="{!mode != ''}"/>  
                        <apex:outputText style="width:780px" value="{!agreement.InterimApprovalComments__c}" rendered="{!mode == ''}"/> 
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

    <apex:outputPanel id="primeExecutionDetails">
    <apex:pageBlockSection title="Agreement Execution Details" collapsible="false">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c =='Executed'}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode == ''}"/>    
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>    

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExecutionDate__c.inlineHelpText}">
            <apex:outputText value="Execution Date"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ExecutionDate__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c =='Executed'}"/>
                <apex:outputField value="{!agreement.ExecutionDate__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>   

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy2__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode == ''}"/>    
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>

    </apex:pageBlockSection>
    </apex:outputPanel>


        </apex:pageBlock>
        <apex:inputHidden value="{!projectFundingId}" id="testfunding"/>
        <apex:actionFunction name="manageFundingProjectLevel" id="manageFundingProjectLevel" action="{!manageFundingByProject}" rerender="testfunding">
            <apex:param id="projId" name="fundingProjectId" value="" assignTo="{!projectFundingId}"/>
        </apex:actionFunction>        
        
        <apex:pageBlock title="Funding" rendered="{!mode == ''}">       
            <apex:pageBlockButtons location="top"><apex:commandButton value="Manage Funding" action="{!manageFunding}" rendered="{!projects.size == 1}"/></apex:pageBlockButtons>
            <apex:outputPanel id="fundingPanel" rendered="{!projects.size == 1}">
            <apex:outputPanel rendered="{!fundings.size > 0}">
            <apex:pageBlockTable value="{!fundings}" var="funding">
                <apex:column headervalue="Date Allocated">
                    <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                    <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                </apex:column>   
                <apex:column headervalue="Classification">
                    <apex:outputField value="{!funding.FundingClassification__c}"/>
                </apex:column>               
                <apex:column headervalue="Allocated Amount">
                    <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                    <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                </apex:column>
        </apex:pageBlockTable>   
        </apex:outputPanel>
        </apex:outputPanel>
       
       <!-- switchType="client" value="{!fundings.size}"  tabClass="activeTab" inactiveTabClass="inactiveTab" disabledTabClass="disabledTab" -->
       
        <apex:outputPanel id="tabPanel" rendered="{!projects.size > 1}">    
        
        <c:Tabpanel >
            <apex:repeat value="{!projects}" var="proj">
            <c:Tab title="{!proj.Name}">
                <apex:commandButton value="Manage Funding" onclick="manageFundingProjectLevel('{!proj.Id}'); return false;"/>
                    <apex:pageBlockTable value="{!projectFundingMap[proj.Id]}" var="funding">
                        <apex:column headervalue="Date Allocated">
                            <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                            <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                         </apex:column>           
                        <apex:column headervalue="Classification">
                            <apex:outputField value="{!funding.FundingClassification__c}"/>
                        </apex:column>                                 
                        <apex:column headervalue="Allocated Amount">
                            <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                            <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                        </apex:column>
                    </apex:pageBlockTable>                      
            </c:Tab>
            </apex:repeat>
        </c:Tabpanel>
        
        </apex:outputPanel>
                  
        <apex:outputPanel rendered="{!fundings.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>   

        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock> 

<!--         <c:ECO_MSAFlyout MSAId="{!agreement.MSAReference__c}" rendered="{!agreement.MSAReference__c != null}" id="primeMSAFlyout"/>  -->     
        <c:ECO_RiskFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_AssumptionFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
		<c:ECO_ProjectTeamFlyout ProjectId="{!project.Id}" rendered="{!project != null}"  />
    </apex:form>
 
    <!--<apex:relatedList list="ContractReviews__r" rendered="{!mode==''}"/>-->
    <apex:relatedList list="CombinedAttachments" rendered="{!mode == ''}" />   
    </apex:outputPanel>
    
    <!-- Other -->
    <apex:outputPanel rendered="{!agreementRecordType =='Other'}">
    <apex:form > 
        <apex:actionFunction id="primeScopeChanged" name="primeScopeChanged" rerender="primeScope"/>

        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Prime Agreement ' + mode}">
        <apex:pageBlockButtons >
            <apex:commandLink value="Print Agreement" action="{!printPdf}" styleClass="btn printAgreement" immediate="true" target="_blank" style="text-decoration:none" />
            <apex:commandButton value="Save" action="{!save}" rendered="{!mode != ''}"/>
            <apex:commandButton value="Return To Agreement" action="{!cancel}" rendered="{!mode == 'Edit'}"/>   
            <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode == ''}"/>   
            <apex:commandButton value="Initiate Contract Review" action="{!initiateContractReview}" rendered="{!mode == ''}"/>
            <apex:commandButton value="Return to Project" action="{!cancel}" rendered="{!mode == 'New' && agreement.Project__c != null}" immediate="true"/>
            <apex:commandButton value="Return To Project" action="{!URLFOR($Action.pse__Proj__c.view, agreement.Project__c)}" rendered="{!mode != 'New'}"/>
            <apex:commandButton value="Return To Project Agreements" action="{!returnToProjectAgreements}" rendered="{!mode == ''}" />
            <apex:commandButton value="Delete" rendered="{!contractReviewCount == 0 && agreement.AgreementNumber__c == null && mode == '' && agreement.AgreementStatus__c != 'Executed'}" action="{!deleteAgreement}"/>
            <apex:commandButton value="Cancel" action="{!cancel}" rendered="{!agreement.Project__c == null && mode =='New'}" />
        </apex:pageBlockButtons>
    <apex:pageBlockSection >
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Name.inlineHelpText}">
                <apex:outputText value="ECO Agreement Number"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Name}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Name}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementNumber__c.inlineHelpText}">
            <apex:outputText value="Oracle Agreement No"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementNumber__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementNumber__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem >
                <apex:outputText value="Agreement Status"/>
                <apex:outputPanel >
                    <apex:actionRegion>
                        <apex:inputField value="{!agreement.AgreementStatus__c}" rendered="{!mode != ''}">
                            <apex:actionSupport event="onchange" immediate="false" rerender="otherExecutionDetails"/>
                        </apex:inputField>
                    </apex:actionRegion>
                    <apex:outputField value="{!agreement.AgreementStatus__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem >
                <apex:outputText value="Project Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Project__c}" rendered="{!mode == 'New' && project == null}" required="true" />                  
                    <apex:outputField value="{!project.Name}" rendered="{!mode == 'New' && project != null}" />
                    <apex:outputField value="{!agreement.Project__r.Name}" rendered="{!mode != 'New'}"/>    
                </apex:outputPanel>         
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ParentAgreement__c.inlineHelpText}">
                <apex:outputText value="Parent Agreement"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ParentAgreement__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ParentAgreement__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>     
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem >
                <apex:outputText value="Ecosystem Project Reference ID"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.EcoSystemReferenceNumber__c}" rendered="{!mode == 'New'}"/>              
                    <apex:outputField value="{!agreement.Project__r.EcoSystemReferenceNumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>
       
        <apex:pageBlockSectionItem >
                <apex:outputText value="Billing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Account__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.Account__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem >
                <apex:outputText value="Oracle Project No"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.OracleProjectnumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.OracleProjectnumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.InvoicingClient__c.inlineHelpText}">
            <apex:outputText value="Invoicing Client"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.InvoicingClient__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.InvoicingClient__c}" rendered="{!mode == ''}"/>        
            </apex:outputPanel>     
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem >

        </apex:pageBlockSectionItem>      
              
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProjectTeamMember__c.inlineHelpText}">
                <apex:outputText value="Agreement Owner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>
      
    </apex:pageBlockSection>

    <apex:pageBlockSection collapsible="false" title="Contract Details">  

        <apex:pageBlockSectionItem >
            <apex:outputText value="Contract Type"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementType__c}" rendered="{!mode != ''}" required="true"/>               
                <apex:outputField value="{!agreement.AgreementType__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem> 
            
        <apex:pageBlockSectionItem helptext="The date the agreement record was created in Ecosystem (& Oracle)">
                <apex:outputText value="Create Date"/>
                <apex:outputField value="{!agreement.CreatedDate}"/>                
        </apex:pageBlockSectionItem>    
                
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ContractTitle__c.inlineHelpText}">
            <apex:outputText value="Contract Title/Name"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ContractTitle__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.ContractTitle__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.StartDate__c.inlineHelpText}">
            <apex:outputText value="Start Date"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.StartDate__c}" rendered="{!mode != ''}"/>               
                <apex:outputField value="{!agreement.StartDate__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>     
        
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ClientContractReferenceNo__c.inlineHelpText}">
            <apex:outputText value="Client Contract Reference No."/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExpirationDate__c.inlineHelpText}">
            <apex:outputText value="End Date"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ExpirationDate__c}" rendered="{!mode != ''}"/>  
                <apex:outputField value="{!agreement.ExpirationDate__c}" rendered="{!mode == ''}"/> 
            </apex:outputPanel>                         
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProfIndemnityLiabilityAmt__c.inlineHelpText}">
                <apex:outputText value="Prof Indemnity/Liability Amt"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode != ''}"/>   
                    <apex:outputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>                                         
        </apex:pageBlockSectionItem>   

        <apex:pageBlockSectionItem >
            <apex:outputText value="Contract Review Status"/>
            <apex:outputPanel >
                <apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
            </apex:outputPanel>                                                 
        </apex:pageBlockSectionItem> 
          
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.PublicGeneralLiabilityAmt__c.inlineHelpText}">
                <apex:outputText value="Public/General Liability Amt"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode != ''}"/>               
                    <apex:outputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode == ''}"/>      
                </apex:outputPanel>     
        </apex:pageBlockSectionItem>                

    </apex:pageBlockSection>
         
    <apex:pageBlockSection columns="1">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopePackage__c.inlineHelpText}">
            <apex:outputText value="Scope Package"/>
            <apex:outputPanel >
                <!--<apex:inputField value="{!agreement.ScopePackage__c}" onChange="primeScopeChanged();" rendered="{!mode != ''}"/>  -->
                <apex:inputField value="{!agreement.ScopePackage__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.ScopePackage__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>               

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopeOfServices__c.inlineHelpText}">
            <apex:outputText value="Scope of Services"/>
            <apex:outputPanel id="primeScope">
                <apex:inputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode != '' && agreement.ScopePackage__c == null}"/>               
                <apex:outputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode == '' && agreement.ScopePackage__c == null}"/>
                <apex:outputField style="width: 780px" value="{!agreement.ScopePackage__r.Scope_Details__c}" rendered="{!agreement.ScopePackage__c != null}"/>
                </apex:outputPanel>             
        </apex:pageBlockSectionItem>    
    </apex:pageBlockSection> 

    <apex:pageBlockSection collapsible="false" title="Financial  (note - all values are in agreement currency)">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FeeType__c.inlineHelpText}">
            <apex:outputText value="Fee Type"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.FeeType__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.FeeType__c}" rendered="{!mode == ''}"/>        
            </apex:outputPanel>     
        </apex:pageBlockSectionItem>            
 
        <apex:pageBlockSectionItem >
            <apex:outputText value="Total Approved Revenue Limit"/>
            <apex:outputPanel >

            </apex:outputPanel>

        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem >
            <apex:outputText value="Payment Terms"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode != ''}" required="true"/>
                <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>             
        </apex:pageBlockSectionItem>    


        <apex:pageBlockSectionItem >
            <apex:outputText value="Total Funding Amount"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}" required="true"/>              
                <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/> 
            </apex:outputPanel>         
        </apex:pageBlockSectionItem> 
           
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}">
                <apex:outputText value="Agreement Currency"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>    

        <apex:pageBlockSectionItem >
            <apex:outputText value="Unallocated Funding"/>
            <apex:outputPanel >

            </apex:outputPanel>

        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementAmountEstimated__c.inlineHelpText}">
            <apex:outputText value="Agreement Amount (estimated)"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode != ''}"/>                
                <apex:outputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>             
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem >
                <apex:outputText value="Variance (Confirmed - Approved Revenue Limit)"/>
                <apex:outputField value="{!agreement.AgreementVariance__c}"/>                
        </apex:pageBlockSectionItem>   
  
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Amount__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (confirmed and committed)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Amount__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.Amount__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
        </apex:pageBlockSectionItem>    
                                            
        <apex:pageBlockSectionItem >
                    <apex:outputText value="Variance Reason"/>
                    <apex:outputPanel >
                        <apex:inputField value="{!agreement.VarianceReason__c}" rendered="{!mode != ''}"/>  
                        <apex:outputField value="{!agreement.VarianceReason__c}" rendered="{!mode == ''}"/> 
                    </apex:outputPanel>                                                 
        </apex:pageBlockSectionItem>        
  
    </apex:pageBlockSection>

    <apex:pageBlockSection collapsible="false" title="Agreement Execution Details" id="otherExecutionDetails">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode == ''}"/>    
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>     

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExecutionDate__c.inlineHelpText}">
            <apex:outputText value="Execution Date"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ExecutionDate__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.ExecutionDate__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy2__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode == ''}"/>    
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>                       
          <!--  <apex:pageBlockSectionItem >
                <apex:outputText value="Revenue Limit"/>
                <apex:outputPanel >
                        <apex:inputField value="{!agreement.RevenueLimitFlag__c}" rendered="{!mode != ''}"/>  
                        <apex:outputField value="{!agreement.RevenueLimitFlag__c}" rendered="{!mode == ''}"/>                 
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>    
            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Action Code"/>
                <apex:outputPanel >
                <apex:inputField value="{!agreement.ActionCode__c}" rendered="{!mode == 'Edit'}"  />                           
                
                <apex:outputField value="{!agreement.ActionCode__c}" rendered="{!mode == ''}" />   
                </apex:outputPanel>                        
            </apex:pageBlockSectionItem>
                
            <apex:pageBlockSectionItem >
                <apex:outputText value="Invoice Limit"/>
                <apex:outputPanel >
                        <apex:inputField value="{!agreement.InvoiceLimitFlag__c}" rendered="{!mode != ''}"/>  
                        <apex:outputField value="{!agreement.InvoiceLimitFlag__c}" rendered="{!mode == ''}"/>                 
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>    



            <apex:pageBlockSectionItem > 
                <apex:outputText value="Description"/> 
                <apex:outputPanel >
                <apex:inputField value="{!agreement.Description__c}" rendered="{!mode != ''}"/>  
                <apex:outputField value="{!agreement.Description__c}" rendered="{!mode == ''}"/>                 
                </apex:outputPanel>   
            </apex:pageBlockSectionItem> -->
            
                                                                                                                                   
        </apex:pageBlockSection>
        
  
        </apex:pageBlock>
        <apex:inputHidden value="{!projectFundingId}" id="testfunding"/>
        <apex:actionFunction name="manageFundingProjectLevel" id="manageFundingProjectLevel" action="{!manageFundingByProject}" rerender="testfunding">
            <apex:param id="projId" name="fundingProjectId" value="" assignTo="{!projectFundingId}"/>
        </apex:actionFunction>        
        
        <apex:pageBlock title="Funding" rendered="{!mode == ''}">       
            <apex:pageBlockButtons location="top"><apex:commandButton value="Manage Funding" action="{!manageFunding}" rendered="{!projects.size == 1}"/></apex:pageBlockButtons>
            <apex:outputPanel id="fundingPanel" rendered="{!projects.size == 1}">
            <apex:outputPanel rendered="{!fundings.size > 0}">
            <apex:pageBlockTable value="{!fundings}" var="funding">
                <apex:column headervalue="Date Allocated">
                    <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                    <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                </apex:column>           
                <apex:column headervalue="Classification">
                    <apex:outputField value="{!funding.FundingClassification__c}"/>
                </apex:column>                        
                <apex:column headervalue="Allocated Amount">
                    <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                    <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                </apex:column>
        </apex:pageBlockTable>   
        </apex:outputPanel>
        </apex:outputPanel>
       
       <!-- switchType="client" value="{!fundings.size}"  tabClass="activeTab" inactiveTabClass="inactiveTab" disabledTabClass="disabledTab" -->
       
        <apex:outputPanel id="tabPanel" rendered="{!projects.size > 1}">    
        
        <c:Tabpanel importCSS="false">
            <apex:repeat value="{!projects}" var="proj">
            <c:Tab title="{!proj.Name}">
                <apex:commandButton value="Manage Funding" onclick="manageFundingProjectLevel('{!proj.Id}'); return false;"/>
                    <apex:pageBlockTable value="{!projectFundingMap[proj.Id]}" var="funding">
                        <apex:column headervalue="Date Allocated">
                            <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                            <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                         </apex:column> 
                        <apex:column headervalue="Classification">
                            <apex:outputField value="{!funding.FundingClassification__c}"/>
                        </apex:column>                  
                        <apex:column headervalue="Allocated Amount">
                            <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                            <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                        </apex:column>
                    </apex:pageBlockTable>                      
            </c:Tab>
            </apex:repeat>
        </c:Tabpanel>
        
     <!--   <apex:dynamicComponent componentValue="{!ProjectFundingTabs}" />
        
        
        <apex:tabPanel id="thetabpanel" >
            <apex:repeat value="{!projects}" var="proj">            
            <apex:tab label="{!proj.Name}" name="{!proj.Name}" id="projTab">
            <apex:pageBlockTable value="{!fundings}" var="funding">
                <apex:column headervalue="Date Allocated">
                    <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                    <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                </apex:column>                  
                <apex:column headervalue="Allocated Amount">
                    <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                    <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                </apex:column>
        </apex:pageBlockTable>                  
            
            </apex:tab>
            </apex:repeat>
        </apex:tabPanel> --> 
        </apex:outputPanel>

        <apex:outputPanel rendered="{!fundings.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>     

        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock> 

        <c:ECO_RiskFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_AssumptionFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_ProjectTeamFlyout ProjectId="{!project.Id}" rendered="{!project != null}"  />

    </apex:form>
 
    <!--<apex:relatedList list="ContractReviews__r" rendered="{!mode==''}"/>-->
    <apex:relatedList list="CombinedAttachments" rendered="{!mode == ''}" />   
    </apex:outputPanel> 
    
    <!-- Prime Interim Agreement -->
    <apex:outputPanel rendered="{!agreementRecordType =='Prime Interim Agreement'}">
    <apex:form > 
        <apex:actionFunction id="primeScopeChanged" name="primeScopeChanged" rerender="primeScope"/>

        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Prime Agreement ' + mode}">
        <apex:pageBlockButtons >
            <apex:commandLink value="Print Agreement" action="{!printPdf}" styleClass="btn printAgreement" immediate="true" target="_blank" style="text-decoration:none" />
            <apex:commandButton value="Save" action="{!save}" rendered="{!mode != ''}"/>
            <apex:commandButton value="Return To Agreement" action="{!cancel}" rendered="{!mode == 'Edit'}"/>   
            <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode == ''}"/>   
            <apex:commandButton value="Initiate Contract Review" action="{!initiateContractReview}" rendered="{!mode == ''}"/>
            <apex:commandButton value="Return To Project" action="{!URLFOR($Action.pse__Proj__c.view, agreement.Project__c)}" rendered="{!mode != 'New'}"/>
            <apex:commandButton value="Return to Project" action="{!cancel}" rendered="{!mode == 'New' && agreement.Project__c != null}" immediate="true"/>
            <apex:commandButton value="Return To Project Agreements" action="{!returnToProjectAgreements}" rendered="{!mode == ''}" />
            <apex:commandButton value="Delete" rendered="{!contractReviewCount == 0 && agreement.AgreementNumber__c == null && mode == '' && agreement.AgreementStatus__c != 'Executed'}" action="{!deleteAgreement}"/>
            <apex:commandButton value="Cancel" action="{!cancel}" rendered="{!agreement.Project__c == null && mode =='New'}" />
        </apex:pageBlockButtons>
        <apex:pageBlockSection >
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Name.inlineHelpText}">
                <apex:outputText value="ECO Agreement Number"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Name}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Name}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
            <apex:pageBlockSectionItem >
                <apex:outputText value="Ecosystem Project Reference ID"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.EcoSystemReferenceNumber__c}" rendered="{!mode == 'New'}"/>              
                    <apex:outputField value="{!agreement.Project__r.EcoSystemReferenceNumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
            <apex:pageBlockSectionItem >
                <apex:outputText value="Agreement Status"/>
                <apex:outputPanel >
                    <apex:actionRegion>
                        <apex:inputField value="{!agreement.AgreementStatus__c}" rendered="{!mode != ''}">
                            <apex:actionSupport event="onchange" immediate="false" rerender="intExecutedBy,intExecutedDate"/>
                        </apex:inputField>
                    </apex:actionRegion>
                    <apex:outputField value="{!agreement.AgreementStatus__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>        
            <apex:pageBlockSectionItem >
                <apex:outputText value="Oracle Project No"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.OracleProjectnumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.OracleProjectnumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementNumber__c.inlineHelpText}">
                <apex:outputText value="Oracle Agreement No"/>
                 <apex:outputPanel >
               <apex:inputField value="{!agreement.AgreementNumber__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementNumber__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem >
                <apex:outputText value="Project Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Project__c}" rendered="{!mode == 'New' && project == null}" required="true" />                  
                    <apex:outputField value="{!project.Name}" rendered="{!mode == 'New' && project != null}" />
                    <apex:outputField value="{!agreement.Project__r.Name}" rendered="{!mode != 'New'}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ParentAgreement__c.inlineHelpText}">
                <apex:outputText value="Parent Agreement"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ParentAgreement__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ParentAgreement__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProjectTeamMember__c.inlineHelpText}">
                <apex:outputText value="Agreement Owner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>
            <apex:pageBlockSectionItem >
                <apex:outputText value="Billing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Account__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.Account__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
                <apex:outputText value="Agreement Executed By"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}" id="intExecutedBy"/>
                    <apex:outputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.InvoicingClient__c.inlineHelpText}">
                <apex:outputText value="Invoicing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.InvoicingClient__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.InvoicingClient__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy2__c.inlineHelpText}">
                <apex:outputText value="Agreement Executed By"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>  

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExecutionDate__c.inlineHelpText}">
                <apex:outputText value="Execution Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExecutionDate__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}" id="intExecutedDate"/>
                    <apex:outputField value="{!agreement.ExecutionDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ContractTitle__c.inlineHelpText}">
                <apex:outputText value="Contract Title/Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ContractTitle__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ContractTitle__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FeeType__c.inlineHelpText}">
                <apex:outputText value="Fee Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FeeType__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.FeeType__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ClientContractReferenceNo__c.inlineHelpText}">
                <apex:outputText value="Client Contract Reference No."/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Payment Terms"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode != ''}" required="true">
                    </apex:inputField>
                    <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem >
                <apex:outputText value="Contract Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementType__c}" rendered="{!mode != ''}" required="true"/>               
                    <apex:outputField value="{!agreement.AgreementType__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}">
                <apex:outputText value="Agreement Currency"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem helptext="The date the agreement record was created in Ecosystem (& Oracle)">
                <apex:outputText value="Create Date"/>
                <apex:outputField value="{!agreement.CreatedDate}"/>                
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Amount__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (confirmed and committed)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Amount__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.Amount__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.StartDate__c.inlineHelpText}">
                <apex:outputText value="Start Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.StartDate__c}" rendered="{!mode != ''}"/>               
                    <apex:outputField value="{!agreement.StartDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>                                            
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementAmountEstimated__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (estimated)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode != ''}"/>                
                    <apex:outputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExpirationDate__c.inlineHelpText}">
                <apex:outputText value="End Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExpirationDate__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.ExpirationDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>                         
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem >
                <apex:outputText value="Total Funding Amount"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}" required="true"/>              
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProfIndemnityLiabilityAmt__c.inlineHelpText}">
                <apex:outputText value="Prof Indemnity/Liability Amt"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode != ''}"/>   
                    <apex:outputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>                                         
            </apex:pageBlockSectionItem>    
            <apex:pageBlockSectionItem >
                <apex:outputText value="Variance (Confirmed - Approved Revenue Limit)"/>
                <apex:outputField value="{!agreement.AgreementVariance__c}"/>                
            </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.PublicGeneralLiabilityAmt__c.inlineHelpText}">
                <apex:outputText value="Public/General Liability Amt"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode != ''}"/>               
                    <apex:outputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode == ''}"/>      
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>
            <apex:pageBlockSectionItem >
                    <apex:outputText value="Variance Reason"/>
                    <apex:outputPanel >
                        <apex:inputField value="{!agreement.VarianceReason__c}" rendered="{!mode != ''}"/>  
                        <apex:outputField value="{!agreement.VarianceReason__c}" rendered="{!mode == ''}"/> 
                    </apex:outputPanel>                                                 
            </apex:pageBlockSectionItem>   

            <apex:pageBlockSectionItem >
                    <apex:outputText value="Contract Review Status"/>
                    <apex:outputPanel >
                        <apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
                    </apex:outputPanel>                                                 
            </apex:pageBlockSectionItem> 
                             
            <apex:pageBlockSectionItem >
                <apex:outputText value="Revenue Limit"/>
                <apex:outputPanel >
                        <apex:inputField value="{!agreement.RevenueLimitFlag__c}" rendered="{!mode != ''}"/>  
                        <apex:outputField value="{!agreement.RevenueLimitFlag__c}" rendered="{!mode == ''}"/>                 
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>    
            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Action Code"/>
                <apex:outputPanel >
                <apex:inputField value="{!agreement.ActionCode__c}" rendered="{!mode == 'Edit'}"  />                           
                
                <apex:outputField value="{!agreement.ActionCode__c}" rendered="{!mode == ''}" />   
                </apex:outputPanel>                        
            </apex:pageBlockSectionItem>
                
            <apex:pageBlockSectionItem >
                <apex:outputText value="Invoice Limit"/>
                <apex:outputPanel >
                        <apex:inputField value="{!agreement.InvoiceLimitFlag__c}" rendered="{!mode != ''}"/>  
                        <apex:outputField value="{!agreement.InvoiceLimitFlag__c}" rendered="{!mode == ''}"/>                 
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>    

            <apex:pageBlockSectionItem >    
                <apex:outputText value="Change Manager Approved For Synch"/>  
               <apex:outputPanel >          
                    <apex:inputField value="{!agreement.ChangeManagerApprovedForSynch__c}" rendered="{!mode == 'Edit'}" /> 
                    <apex:outputField value="{!agreement.ChangeManagerApprovedForSynch__c}" rendered="{!mode == ''}" />  
                </apex:outputPanel>
            </apex:pageBlockSectionItem>


            <apex:pageBlockSectionItem > 
                <apex:outputText value="Description"/> 
                <apex:outputPanel >
                <apex:inputField value="{!agreement.Description__c}" rendered="{!mode != ''}"/>  
                <apex:outputField value="{!agreement.Description__c}" rendered="{!mode == ''}"/>                 
                </apex:outputPanel>   
            </apex:pageBlockSectionItem>
            
            <apex:pageBlockSectionItem >    
                <apex:outputText value="Change Manager Is Changed"/>      
                <apex:outputPanel >      
                    <apex:inputField value="{!agreement.ChangeManagerIsChanged__c}" rendered="{!mode == 'Edit'}" />  
                    <apex:outputField value="{!agreement.ChangeManagerIsChanged__c}" rendered="{!mode == ''}" />  
                </apex:outputPanel>
            </apex:pageBlockSectionItem>
                                                                                                                                   
        </apex:pageBlockSection>
        
        <apex:pageBlockSection columns="1">
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopePackage__c.inlineHelpText}">
                <apex:outputText value="Scope Package"/>
                <apex:outputPanel >
                    <!--<apex:inputField value="{!agreement.ScopePackage__c}" onChange="primeScopeChanged();" rendered="{!mode != ''}"/>-->
                     <apex:inputField value="{!agreement.ScopePackage__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ScopePackage__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>    
                
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopeOfServices__c.inlineHelpText}">
                <apex:outputText value="Scope of Services"/>
                <apex:outputPanel id="primeScope">
                    <apex:inputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode != '' && agreement.ScopePackage__c == null}"/>               
                    <apex:outputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode == '' && agreement.ScopePackage__c == null}"/>
                    <apex:outputField style="width: 780px" value="{!agreement.ScopePackage__r.Scope_Details__c}" rendered="{!agreement.ScopePackage__c != null}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>    
        </apex:pageBlockSection>        
        </apex:pageBlock>
        <apex:inputHidden value="{!projectFundingId}" id="testfunding"/>
        <apex:actionFunction name="manageFundingProjectLevel" id="manageFundingProjectLevel" action="{!manageFundingByProject}" rerender="testfunding">
            <apex:param id="projId" name="fundingProjectId" value="" assignTo="{!projectFundingId}"/>
        </apex:actionFunction>        
        
        <apex:pageBlock title="Funding" rendered="{!mode == ''}">       
            <apex:pageBlockButtons location="top"><apex:commandButton value="Manage Funding" action="{!manageFunding}" rendered="{!projects.size == 1}"/></apex:pageBlockButtons>
            <apex:outputPanel id="fundingPanel" rendered="{!projects.size == 1}">
            <apex:outputPanel rendered="{!fundings.size > 0}">
            <apex:pageBlockTable value="{!fundings}" var="funding">
                <apex:column headervalue="Date Allocated">
                    <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                    <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                </apex:column>             
                <apex:column headervalue="Classification">
                    <apex:outputField value="{!funding.FundingClassification__c}"/>
                </apex:column>      
                <apex:column headervalue="Allocated Amount">
                    <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                    <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                </apex:column>
        </apex:pageBlockTable>   
        </apex:outputPanel>
        </apex:outputPanel>
       
       <!-- switchType="client" value="{!fundings.size}"  tabClass="activeTab" inactiveTabClass="inactiveTab" disabledTabClass="disabledTab" -->
       
        <apex:outputPanel id="tabPanel" rendered="{!projects.size > 1}">    
        
        <c:Tabpanel importCSS="false">
            <apex:repeat value="{!projects}" var="proj">
            <c:Tab title="{!proj.Name}">
                <apex:commandButton value="Manage Funding" onclick="manageFundingProjectLevel('{!proj.Id}'); return false;"/>
                    <apex:pageBlockTable value="{!projectFundingMap[proj.Id]}" var="funding">
                        <apex:column headervalue="Date Allocated">
                            <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                            <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                         </apex:column>        
                        <apex:column headervalue="Classification">
                            <apex:outputField value="{!funding.FundingClassification__c}"/>
                        </apex:column>           
                        <apex:column headervalue="Allocated Amount">
                            <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                            <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                        </apex:column>
                    </apex:pageBlockTable>                      
            </c:Tab>
            </apex:repeat>
        </c:Tabpanel>
        
     <!--   <apex:dynamicComponent componentValue="{!ProjectFundingTabs}" />
        
        
        <apex:tabPanel id="thetabpanel" >
            <apex:repeat value="{!projects}" var="proj">            
            <apex:tab label="{!proj.Name}" name="{!proj.Name}" id="projTab">
            <apex:pageBlockTable value="{!fundings}" var="funding">
                <apex:column headervalue="Date Allocated">
                    <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                    <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                </apex:column>                  
                <apex:column headervalue="Allocated Amount">
                    <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                    <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                </apex:column>
        </apex:pageBlockTable>                  
            
            </apex:tab>
            </apex:repeat>
        </apex:tabPanel> --> 
        </apex:outputPanel>

        <apex:outputPanel rendered="{!fundings.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>     

        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock> 


        <c:ECO_RiskFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_AssumptionFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_ProjectTeamFlyout ProjectId="{!project.Id}" rendered="{!project != null}"  />

    </apex:form>
 
    <!--<apex:relatedList list="ContractReviews__r" rendered="{!mode==''}"/>-->
    <apex:relatedList list="CombinedAttachments" rendered="{!mode == ''}" />   
    </apex:outputPanel>     

    <!-- Sub -->    
    <apex:outputPanel rendered="{!agreementRecordType =='Sub'}">
    <apex:form > 
        <apex:actionFunction id="subScopeChanged" name="subScopeChanged" rerender="subScope"/>

        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Sub Agreement ' + mode}">             
        <apex:pageBlockButtons >
            <apex:commandLink value="Print Agreement" action="{!printPdf}" styleClass="btn printAgreement" immediate="true" target="_blank" style="text-decoration:none" />
            <apex:commandButton value="Save" action="{!save}" rendered="{!mode != ''}"/>
            <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode == ''}"/>
            <apex:commandButton value="Return To Agreement" action="{!cancel}" rendered="{!mode == 'Edit'}"/>           
            <apex:commandButton value="Initiate Contract Review" action="{!initiateContractReview}" rendered="{!mode == ''}" />
            <apex:commandButton value="Return To Project" action="{!URLFOR($Action.pse__Proj__c.view, agreement.Project__c)}" rendered="{!mode != 'New'}"/>

            <apex:commandButton value="Return to Project" action="{!cancel}" rendered="{!mode == 'New' && agreement.Project__c != null}"/> 
            <apex:commandButton value="Return To Project Agreements" action="{!returnToProjectAgreements}" rendered="{!mode == ''}" />
            <apex:commandButton value="Delete" rendered="{!contractReviewCount == 0 && agreement.AgreementNumber__c == null && mode == '' && agreement.AgreementStatus__c != 'Executed'}" action="{!deleteAgreement}"/>
            <apex:commandButton value="Cancel" action="{!cancel}" rendered="{!agreement.Project__c == null && mode =='New'}" />
        </apex:pageBlockButtons>
        <apex:pageBlockSection >
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Name.inlineHelpText}">
                <apex:outputText value="ECO Agreement Number"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Name}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Name}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem >
                <apex:outputText value="Project Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Project__c}" rendered="{!mode == 'New' && project == null}" required="true" />                                  
                    <apex:outputField value="{!project.Name}" rendered="{!mode == 'New' && project != null}}"/>
                    <apex:outputField value="{!agreement.Project__r.Name}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem >
                <apex:outputText value="Agreement Status"/>
                <apex:outputPanel >
                    <apex:actionRegion>
                        <apex:inputField value="{!agreement.AgreementStatus__c}" rendered="{!mode != ''}">
                            <apex:actionSupport event="onchange" immediate="false" rerender="subExecutionDetails"/>
                        </apex:inputField>
                    </apex:actionRegion>
                    <apex:outputField value="{!agreement.AgreementStatus__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>  
            
        <apex:pageBlockSectionItem >
                <apex:outputText value="Ecosystem Project Reference ID"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.EcoSystemReferenceNumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.EcoSystemReferenceNumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ParentAgreement__c.inlineHelpText}">
                <apex:outputText value="Parent Agreement"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ParentAgreement__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ParentAgreement__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>          

        <apex:pageBlockSectionItem >
                <apex:outputText value="Oracle Project No"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.OracleProjectnumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.OracleProjectnumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.MSAReference__c.inlineHelpText}">
                <apex:outputText value="MSA Reference"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.MSAReference__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.MSAReference__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem >
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.VendorSite__c.inlineHelpText}">
            <apex:outputText value="Sub Name"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.VendorSite__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.VendorSite__r.AccountName__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem >
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProjectTeamMember__c.inlineHelpText}">
                <apex:outputText value="Agreement Owner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode != ''}"  required="true"/>
                    <apex:outputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>        

    </apex:pageBlockSection>

    <apex:pageBlockSection title="Contract Details" collapsible="false">
        <apex:pageBlockSectionItem >
                <apex:outputText value="Contract Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementType__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.AgreementType__c}" rendered="{!mode == ''}"/>      
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="The date the agreement record was created in Ecosystem (& Oracle)">
                <apex:outputText value="Create Date"/>
                <apex:outputField value="{!agreement.CreatedDate}"/>                
        </apex:pageBlockSectionItem>        
        
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ContractTitle__c.inlineHelpText}">
                <apex:outputText value="Contract Title/Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ContractTitle__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ContractTitle__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.StartDate__c.inlineHelpText}">
                <apex:outputText value="Start Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.StartDate__c}" rendered="{!mode != ''}"/>   
                    <apex:outputField value="{!agreement.StartDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>    
            
        <apex:pageBlockSectionItem helptext="Enter the Subs reference number (if applicable)">
                <apex:outputText value="Vendor/Sub Contract Reference No."/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExpirationDate__c.inlineHelpText}">
                <apex:outputText value="End Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExpirationDate__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ExpirationDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>             
           
        <apex:pageBlockSectionItem >
            <apex:outputText value="Back-To-Back with Prime"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.BacktoBackwithPrime__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.BacktoBackwithPrime__c}" rendered="{!mode == ''}"/>    
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>          
        
        <apex:pageBlockSectionItem >
                <apex:outputText value="Contract Review Status"/>
                <apex:outputPanel >
                    <apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>                                                 
        </apex:pageBlockSectionItem>  
    
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProfIndemnityLiabilityAmt__c.inlineHelpText}">
            <apex:outputText value="Prof Indemnity/Liability Amt"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode != ''}"/>   
                <apex:outputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem >
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.PublicGeneralLiabilityAmt__c.inlineHelpText}">
            <apex:outputText value="Public/General Liability Amt"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode != ''}"/>   
                <apex:outputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode == ''}"/>      
            </apex:outputPanel>     
        </apex:pageBlockSectionItem>          

    </apex:pageBlockSection>

    <apex:pageBlockSection columns="1">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopePackage__c.inlineHelpText}">
            <apex:outputText value="Scope Package"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ScopePackage__c}" onChange="subScopeChanged();" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.ScopePackage__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>    
                
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopeOfServices__c.inlineHelpText}">
            <apex:outputText value="Scope of Services"/>
            <apex:outputPanel id="subScope">
                <apex:inputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode != '' && agreement.ScopePackage__c == null}"/>   
                <apex:outputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode == '' && agreement.ScopePackage__c == null}"/>
                <apex:outputField style="width: 780px" value="{!agreement.ScopePackage__r.Scope_Details__c}" rendered="{!agreement.ScopePackage__c != null}"/>          
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>                                  
                                                                                                                            
    </apex:pageBlockSection>

    <apex:pageBlockSection title="Financial  (note - all values are in agreement currency)" collapsible="false">

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FeeType__c.inlineHelpText}">
            <apex:outputText value="Fee Type"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.FeeType__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.FeeType__c}" rendered="{!mode == ''}"/>        
            </apex:outputPanel>     
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem >
                <apex:outputText value="Total Purchase Orders Raised"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
        </apex:pageBlockSectionItem>   

        <apex:pageBlockSectionItem >
            <apex:outputText value="Payment Terms"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode != ''}" required="true"/>                  
                <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>    
        </apex:pageBlockSectionItem>    

        <apex:pageBlockSectionItem >
                <apex:outputText value="Total Invoiced"/>
                <apex:outputField value="{!agreement.Total_Invoiced__c}"/>              
        </apex:pageBlockSectionItem>   
          
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}">
            <apex:outputText value="Agreement Currency"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>   

        <apex:pageBlockSectionItem >
                <apex:outputText value="Total Paid" />
                <apex:outputField value="{!agreement.TotalPaid__c}" />              
        </apex:pageBlockSectionItem>          
                                                                   
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementAmountEstimated__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (estimated)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode != ''}"/>    
                    <apex:outputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode == ''}"/>   
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>        

        <apex:pageBlockSection >

        </apex:pageBlockSection>           
 
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Amount__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (confirmed and committed)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Amount__c}" rendered="{!mode != ''}" />
                    <apex:outputField value="{!agreement.Amount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
        </apex:pageBlockSectionItem>             
                         
    </apex:pageBlockSection>


    <apex:pageBlockSection title="Agreement Execution Details" collapsible="false" id="subExecutionDetails">

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>   

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExecutionDate__c.inlineHelpText}">
            <apex:outputText value="Execution Date"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ExecutionDate__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                <apex:outputField value="{!agreement.ExecutionDate__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy2__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>  

    </apex:pageBlockSection>

</apex:pageBlock>   
        
        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock> 

        <!-- <c:ECO_MSAFlyout MSAId="{!agreement.MSAReference__c}" rendered="{!agreement.MSAReference__c != null}"/>  -->
        <c:ECO_RiskFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_AssumptionFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_ProjectTeamFlyout ProjectId="{!project.Id}" rendered="{!project != null}"  />
        <apex:pageBlock title="Purchase Orders" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top"><apex:commandButton value="New Purchase Order" action="{!newPurchaseOrder}"/></apex:pageBlockButtons>
            <apex:pageBlockTable value="{!PurchaseOrders}" var="po" rendered="{!PurchaseOrders != null}">
                <apex:column style="width:60px" headervalue="Action">
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.POHeader__c.edit, po.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">Edit</apex:commandLink><apex:outputText value=" | "/>
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.POHeader__c.delete, po.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}" onclick="return window.confirm('Are you sure?');">Del</apex:commandLink>
                </apex:column>
                <apex:column headervalue="Purchase Order Number">
                    <apex:commandLink action="{!URLFOR($Action.POHeader__c.view, po.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">
                        <apex:outputField value="{!po.Name}"/>
                    </apex:commandLink> </apex:column>              
                <apex:column headervalue="Project"><apex:outputField value="{!po.Project__c}"/></apex:column>               
                <apex:column headervalue="PO Date"><apex:outputField value="{!po.PODate__c}"/></apex:column>                
                <apex:column headervalue="PO Type"><apex:outputField value="{!po.POType__c}"/></apex:column>                
                <apex:column headervalue="Requestor"><apex:outputField value="{!po.Requestor__c}"/></apex:column>               
                <apex:column headervalue="Status"><apex:outputField value="{!po.Status__c}"/></apex:column>             
                <apex:column headervalue="Total"><apex:outputField value="{!po.Total__c}"/></apex:column>               
                <apex:column headervalue="Created Date"><apex:outputField value="{!po.CreatedDate}"/></apex:column>             
                <apex:column headervalue="Created By"><apex:outputField value="{!po.CreatedById}"/></apex:column>               

            </apex:pageBlockTable>
            <apex:outputPanel rendered="{!PurchaseOrders == null}">
                <apex:outputText value="No records to display"/>
            </apex:outputPanel> 
        </apex:pageBlock>
    </apex:form>
    
    <!--<apex:relatedList list="ContractReviews__r" rendered="{!mode==''}"/>-->
    <apex:relatedList list="CombinedAttachments" rendered="{!mode==''}"/>
    
    </apex:outputPanel> 
    
    <!-- Inter-Company -->  
    <apex:outputPanel rendered="{!agreementRecordType =='Inter-Company'}">
    <apex:form > 
        <apex:actionFunction id="subScopeChanged" name="subScopeChanged" rerender="subScope"/>

        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Inter-Company Agreement ' + mode}">              
        <apex:pageBlockButtons >
            <apex:commandLink value="Print Agreement" action="{!printPdf}" styleClass="btn printAgreement" immediate="true" target="_blank" style="text-decoration:none" />
            <apex:commandButton value="Save" action="{!save}" rendered="{!mode != ''}"/>
            <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode == ''}"/>
            <apex:commandButton value="Return To Agreement" action="{!cancel}" rendered="{!mode == 'Edit'}"/>           
            <apex:commandButton value="Initiate Contract Review" action="{!initiateContractReview}" rendered="{!mode == ''}" />
            <apex:commandButton value="Return to Project" action="{!cancel}" rendered="{!mode == 'New' && agreement.Project__c != null}"  immediate="true"/>  
            <apex:commandButton value="Return To Project" action="{!URLFOR($Action.pse__Proj__c.view, agreement.Project__c)}" rendered="{!mode != 'New'}"/>
            <apex:commandButton value="Return To Project Agreements" action="{!returnToProjectAgreements}" rendered="{!mode == ''}" />
            <apex:commandButton value="Delete" rendered="{!contractReviewCount == 0 && agreement.AgreementNumber__c == null && mode == '' && agreement.AgreementStatus__c != 'Executed'}" action="{!deleteAgreement}"/>
            <apex:commandButton value="Cancel" action="{!cancel}" rendered="{!agreement.Project__c == null && mode =='New'}" />
        </apex:pageBlockButtons>
        <apex:pageBlockSection >
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Name.inlineHelpText}">
                <apex:outputText value="ECO Agreement Number"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Name}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Name}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Project Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Project__c}" rendered="{!mode == 'New' && project == null}" required="true"/>               
                    <apex:outputField value="{!project.Name}" rendered="{!mode == 'New' && project != null}"/>
                    <apex:outputField value="{!agreement.Project__r.Name}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem >
                <apex:outputText value="Agreement Status"/>
                <apex:outputPanel >
                    <apex:actionRegion>
                        <apex:inputField value="{!agreement.AgreementStatus__c}" rendered="{!mode != ''}">
                            <apex:actionSupport event="onchange" immediate="false" rerender="interimExecutionDetails"/>
                        </apex:inputField>
                    </apex:actionRegion>    
                    <apex:outputField value="{!agreement.AgreementStatus__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>   

            <apex:pageBlockSectionItem >
                <apex:outputText value="Ecosystem Project Reference ID"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.EcoSystemReferenceNumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.EcoSystemReferenceNumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="Select if any parent agreement is applicable (e.g. standing contract, JV, prime contract for back-to-back with subs)">
                <apex:outputText value="Prime Agreement"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ParentAgreement__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ParentAgreement__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>  
  
            <apex:pageBlockSectionItem >
                <apex:outputText value="Oracle Project No"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.OracleProjectnumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.OracleProjectnumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>  

            <!--<apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ParentAgreement__c.inlineHelpText}">
                <apex:outputText value="Project Billing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Account__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.Account__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem> -->

             <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProjectTeamMember__c.inlineHelpText}">
                <apex:outputText value="Agreement Owner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode != ''}"  required="true"/>
                    <apex:outputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>              

            <apex:pageBlockSectionItem >
            </apex:pageBlockSectionItem>

        </apex:pageBlockSection>

        <apex:pageBlockSection title="Contract Details" collapsible="false">  

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.IntercompanySubconsultant__c.inlineHelpText}">
                <apex:outputText value="Intercompany Subconsultant"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.IntercompanySubconsultant__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.IntercompanySubconsultant__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>               

            <apex:pageBlockSectionItem helptext="The date the agreement record was created in Ecosystem (& Oracle)">
                <apex:outputText value="Create Date"/>
                <apex:outputField value="{!agreement.CreatedDate}"/>                
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="">
                <apex:outputText value="Interco Project"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.IntercoProject__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.IntercoProject__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>            

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.StartDate__c.inlineHelpText}">
                <apex:outputText value="Start Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.StartDate__c}" rendered="{!mode != ''}"/>   
                    <apex:outputField value="{!agreement.StartDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>   

            <apex:pageBlockSectionItem >
                <apex:outputText value="Back-To-Back with Prime"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.BacktoBackwithPrime__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.BacktoBackwithPrime__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>  

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExpirationDate__c.inlineHelpText}">
                <apex:outputText value="End Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExpirationDate__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ExpirationDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>  
         
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.TeamLeaderName__c.inlineHelpText}">
                <apex:outputText value="Team Leader (Name)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TeamLeaderName__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TeamLeaderName__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Contract Review Status"/>
                <apex:outputPanel >
                    <apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>                                                 
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem >
                <apex:outputText value="Team Leader (Title)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TeamLeaderTitle__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TeamLeaderTitle__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>   

            <apex:pageBlockSectionItem >
            </apex:pageBlockSectionItem>


    </apex:pageBlockSection>

    <apex:pageBlockSection title="Financial  (note - all values are in agreement currency)" collapsible="false">      
            <apex:pageBlockSectionItem helptext="Select the type of fee structure to be used." >
                <apex:outputText value="Interco Fee Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FeeType__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.FeeType__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="">
                <apex:outputText value="Payment Terms"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode != ''}" required="true">
                    </apex:inputField>
                    <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>                     

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}">
                <apex:outputText value="Agreement Currency"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>            
            
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Amount__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (confirmed and committed)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Amount__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Amount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>            
        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementAmountEstimated__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (estimated)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode != ''}"/>    
                    <apex:outputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode == ''}"/>   
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>
            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Purchase Order (only applicable if not using Cross-Charging)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>            

     
            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Total Purchase Orders Raised"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>                                                    
        
  
                
            <apex:pageBlockSectionItem >
                <apex:outputText value="Total Invoiced"/>
                <apex:outputField value="{!agreement.Total_Invoiced__c}"/>              
            </apex:pageBlockSectionItem>            
                    
            <apex:pageBlockSectionItem helptext="">
                <apex:outputPanel />
            </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Total Paid" />
                <apex:outputField value="{!agreement.TotalPaid__c}" />              
            </apex:pageBlockSectionItem>        
           

            
            </apex:pageBlockSection>

    <apex:pageBlockSection title="Execution Details" collapsible="false" id="interimExecutionDetails">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExecutionDate__c.inlineHelpText}">
            <apex:outputText value="Execution Date"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ExecutionDate__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                <apex:outputField value="{!agreement.ExecutionDate__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>   

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy2__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>                

    </apex:pageBlockSection>
            
            <apex:pageBlockSection columns="1" title="AECOM General Conditions for Inter-Company Subcontracts">
            <div class="infoTable">
                <table  border="1" cellpadding="0" cellspacing="0">
                    <TR>
                        <TD><b>1.0 Application of Main Contract Conditions</b><br/>
                        The Subconsultant shall be bound by the conditions of the Main Contract, which the Subconsultant is deemed to have reviewed and accepted at proposal stage, to the extent that they are <br/>applicable to the Subconsultancy Services (as defined in Section A Below).</TD>
                    </TR>   
                    <TR>
                        <TD><b>2.0 Responsibility</b><br/>
                        The Subconsultant shall be responsible for the professional quality, technical accuracy, coordination and timely completion (in accordance with the program requirements set forth <br/>in the scope below) of the Subconsultancy Services, shall correct any errors or deficiencies therein at its own cost, and shall indemnify the Lead Consultant against any resultant costs or liabilities.</TD>
                    </TR>
                    <TR >
                        <TD><b>3.0 Payment</b><br/>
                        Unless stipulated to the contrary in Section B, the Subconsultant shall invoice the Lead Consultant on the basis of the Main Contract payment schedule.  Payments shall be made by the Lead-Consultant<br/> within 30 days from the date of the submitted invoice.  In the event that all or part of a payment is withheld by the Client for reasons attributable to the Lead-Consultant, the Lead Consultant shall pay the Subconsultant?s invoice in full.   
                        </TD>   
                    </TR>   
                    <TR>
                        <td><b>4.0 Change Orders</b><br/>
                        In the event that the Lead Consultant instructs the Subconsultant to proceed with additional or varied work, approval for which is subsequently withheld by the Client, the Lead Consultant shall nonetheless<br/> pay the Subconsultant?s invoice for such work within 30 days of invoice date.
                        </td>
                    </TR>
                    <TR>
                        <td><b>5.0 Dispute Resolution</b><br/>
                        Any dispute which cannot be resolved between the Lead Consultant?s Project Manager and the Subconsultant?s Team Leader shall be referred to the Presidents / Regional Chief Executives of the two companies, and<br/> if still not agreed, shall be finally decided on by the Group Chief Executive(s) concerned.</td>
                    </TR>                   
                                                                                                                                                                                                        
                </table>
            </div>          
            </apex:pageBlockSection>
            
            <apex:pageBlockSection columns="1" title="Section A - Scope of Services">
                <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopePackage__c.inlineHelpText}">
                    <apex:outputText value="Scope Package"/>
                    <apex:outputPanel >
                        <apex:inputField value="{!agreement.ScopePackage__c}" onChange="subScopeChanged();" rendered="{!mode != ''}"/>
                        <apex:outputField value="{!agreement.ScopePackage__c}" rendered="{!mode == ''}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>    
                
                <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopeOfServices__c.inlineHelpText}">
                    <apex:outputText value="Scope of Services"/>
                    <apex:outputPanel id="subScope">
                        <apex:inputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode != '' && agreement.ScopePackage__c == null}"/>   
                        <apex:outputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode == '' && agreement.ScopePackage__c == null}"/>
                        <apex:outputField style="width: 780px" value="{!agreement.ScopePackage__r.Scope_Details__c}" rendered="{!agreement.ScopePackage__c != null}"/>          
                    </apex:outputPanel>         
                </apex:pageBlockSectionItem>                                 
                                                                                                                            
            </apex:pageBlockSection>
            
            <apex:pageBlockSection columns="1" title="Section B - Commercial Terms">
                    <apex:pageblockSectionItem >
                        <apex:outputText value="In accordance with the AECOM Transfer Pricing Policy, the Lead Consultant will be charged FBLR+5% on all labour inputs by the Subconsultant."/>
                        <apex:outputPanel >
                        <apex:inputField value="{!agreement.CommericialTerms__c}" rendered="{!mode != ''}"/>
                        <apex:outputField value="{!agreement.CommericialTerms__c}" rendered="{!mode == ''}" />
                        </apex:outputPanel>                     
                    </apex:pageblockSectionItem>
                    <apex:pageblockSectionItem >
                        <apex:outputText value="Other (please describe below)"/>
                        <apex:outputPanel >                     
                        <apex:inputField value="{!agreement.CommericialTerms__c}" rendered="{!mode != ''}"/>
                        <apex:outputField value="{!agreement.CommericialTerms__c}" rendered="{!mode == ''}"/>
                        </apex:outputPanel>
                    </apex:pageblockSectionItem>
                    <apex:pageblockSectionItem >
                        <apex:outputPanel >
                            <apex:inputField style="width: 780px" value="{!agreement.CommericialTermsDescription__c}" rendered="{!mode != ''}"/>
                            <apex:outputField style="width: 780px" value="{!agreement.CommericialTermsDescription__c}" rendered="{!mode == ''}"/>                       
                        </apex:outputPanel>
                    </apex:pageblockSectionItem>    
            </apex:pageBlockSection>
            
            <apex:pageBlockSection columns="1" title="Section C - Special Conditions">   
                <apex:outputPanel >       
                <apex:inputField style="width: 780px" value="{!agreement.SpecialConditions__c}" rendered="{!mode != ''}"/>
                <apex:outputField style="width: 780px" value="{!agreement.SpecialConditions__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>                 
            </apex:pageBlockSection>
        
        </apex:pageBlock>  
        <apex:pageBlock title="Purchase Orders" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top"><apex:commandButton value="New Purchase Order" action="{!newPurchaseOrder}"/></apex:pageBlockButtons>
            <apex:pageBlockTable value="{!PurchaseOrders}" var="po" rendered="{!PurchaseOrders != null}">
                <apex:column style="width:60px" headervalue="Action">
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.POHeader__c.edit, po.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">Edit</apex:commandLink><apex:outputText value=" | "/>
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.POHeader__c.delete, po.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}" onclick="return window.confirm('Are you sure?');">Del</apex:commandLink>
                </apex:column>
                <apex:column headervalue="Purchase Order Number">
                    <apex:commandLink action="{!URLFOR($Action.POHeader__c.view, po.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">
                        <apex:outputField value="{!po.Name}"/>
                    </apex:commandLink> </apex:column>              
                <apex:column headervalue="Project"><apex:outputField value="{!po.Project__c}"/></apex:column>               
                <apex:column headervalue="PO Date"><apex:outputField value="{!po.PODate__c}"/></apex:column>                
                <apex:column headervalue="PO Type"><apex:outputField value="{!po.POType__c}"/></apex:column>                
                <apex:column headervalue="Requestor"><apex:outputField value="{!po.Requestor__c}"/></apex:column>               
                <apex:column headervalue="Status"><apex:outputField value="{!po.Status__c}"/></apex:column>             
                <apex:column headervalue="Total"><apex:outputField value="{!po.Total__c}"/></apex:column>               
                <apex:column headervalue="Created Date"><apex:outputField value="{!po.CreatedDate}"/></apex:column>             
                <apex:column headervalue="Created By"><apex:outputField value="{!po.CreatedById}"/></apex:column>               

            </apex:pageBlockTable>
            <apex:outputPanel rendered="{!PurchaseOrders == null}">
                <apex:outputText value="No records to display"/>
            </apex:outputPanel> 
        </apex:pageBlock>
        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>          
      <!--   <c:ECO_MSAFlyout MSAId="{!agreement.MSAReference__c}" rendered="{!agreement.MSAReference__c != null}"/>  -->
        <c:ECO_RiskFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_AssumptionFlyout ProjectId="{!project.Id}" rendered="{!project != null}" PlanElement="" />
        <c:ECO_ProjectTeamFlyout ProjectId="{!project.Id}" rendered="{!project != null}"  />
    </apex:form>
    <!--<apex:relatedList list="ContractReviews__r" rendered="{!mode==''}"/>-->
    <apex:relatedList list="CombinedAttachments" rendered="{!mode==''}"/>
    
    </apex:outputPanel>     

    <apex:outputPanel rendered="{!agreementRecordType == 'Joint Venture'}">
    <apex:form > 
        <apex:actionFunction id="subScopeChanged" name="subScopeChanged" rerender="subScope"/>

        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Joint Venture Agreement ' + mode}">              
        <apex:pageBlockButtons >
            <apex:commandLink value="Print Agreement" action="{!printPdf}" styleClass="btn printAgreement" immediate="true" target="_blank" style="text-decoration:none" />
            <apex:commandButton value="Save" action="{!save}" rendered="{!mode != ''}"/>
            <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode == ''}"/>
            <apex:commandButton value="Return To Agreement" action="{!cancel}" rendered="{!mode == 'Edit'}"/>           
            <apex:commandButton value="Initiate Contract Review" action="{!initiateContractReview}" rendered="{!mode == ''}" />
            <apex:commandButton value="Return to Project" action="{!cancel}" rendered="{!mode == 'New' && agreement.Project__c != null}"  immediate="true"/>  
            <apex:commandButton value="Return To Project" action="{!URLFOR($Action.pse__Proj__c.view, agreement.Project__c)}" rendered="{!mode != 'New'}"/>
            <apex:commandButton value="Return To Project Agreements" action="{!returnToProjectAgreements}" rendered="{!mode == ''}" />
            <apex:commandButton value="Delete" rendered="{!contractReviewCount == 0 && agreement.AgreementNumber__c == null && mode == '' && agreement.AgreementStatus__c != 'Executed'}" action="{!deleteAgreement}"/>
            <apex:commandButton value="Cancel" action="{!cancel}" rendered="{!agreement.Project__c == null && mode =='New'}" />
        </apex:pageBlockButtons>
        <apex:pageBlockSection >
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Name.inlineHelpText}">
                <apex:outputText value="ECO Agreement Number"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Name}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Name}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Project Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Project__c}" rendered="{!mode == 'New' && project == null}" required="true"/>               
                    <apex:outputField value="{!project.Name}" rendered="{!mode == 'New' && project != null}"/>
                    <apex:outputField value="{!agreement.Project__r.Name}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem >
                <apex:outputText value="Agreement Status"/>
                <apex:outputPanel >
                    <apex:actionRegion>
                        <apex:inputField value="{!agreement.AgreementStatus__c}" rendered="{!mode != ''}">
                            <apex:actionSupport event="onchange" immediate="false" rerender="jointExecutionDetails"/>
                        </apex:inputField>
                    </apex:actionRegion>
                    <apex:outputField value="{!agreement.AgreementStatus__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>   

            <apex:pageBlockSectionItem >
                <apex:outputText value="Ecosystem Project Reference ID"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.EcoSystemReferenceNumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.EcoSystemReferenceNumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

           <!-- <apex:pageBlockSectionItem helptext="Select if any parent agreement is applicable (e.g. standing contract, JV, prime contract for back-to-back with subs)">
                <apex:outputText value="Prime Agreement"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ParentAgreement__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ParentAgreement__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>  -->

             <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProjectTeamMember__c.inlineHelpText}">
                <apex:outputText value="Agreement Owner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode != ''}"  required="true"/>
                    <apex:outputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>              
  
            <apex:pageBlockSectionItem >
                <apex:outputText value="Oracle Project No"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.OracleProjectnumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.OracleProjectnumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>  

            <!--<apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ParentAgreement__c.inlineHelpText}">
                <apex:outputText value="Project Billing Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Account__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.Account__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem> -->


        </apex:pageBlockSection>

        <apex:pageBlockSection title="Contract Details" collapsible="false">  

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.JointVenturePartner__c.inlineHelpText}">
                <apex:outputText value="Joint Venture Partner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.JointVenturePartner__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.JointVenturePartner__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>               

            <apex:pageBlockSectionItem helptext="The date the agreement record was created in Ecosystem (& Oracle)">
                <apex:outputText value="Create Date"/>
                <apex:outputField value="{!agreement.CreatedDate}"/>                
            </apex:pageBlockSectionItem>

 <!--           <apex:pageBlockSectionItem helptext="">
                <apex:outputText value="Interco Project"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.IntercoProject__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.IntercoProject__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>     -->      
            <apex:pageBlockSectionItem >
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.StartDate__c.inlineHelpText}">
                <apex:outputText value="Start Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.StartDate__c}" rendered="{!mode != ''}"/>   
                    <apex:outputField value="{!agreement.StartDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>   

 <!--           <apex:pageBlockSectionItem >
                <apex:outputText value="Back-To-Back with Prime"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.BacktoBackwithPrime__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.BacktoBackwithPrime__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>  -->

            <apex:pageBlockSectionItem >
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExpirationDate__c.inlineHelpText}">
                <apex:outputText value="End Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExpirationDate__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ExpirationDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>  
         
 <!--           <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.TeamLeaderName__c.inlineHelpText}">
                <apex:outputText value="Team Leader (Name)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TeamLeaderName__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TeamLeaderName__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>-->

            <apex:pageBlockSectionItem >
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Contract Review Status"/>
                <apex:outputPanel >
                    <apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>                                                 
            </apex:pageBlockSectionItem> 

 <!--           <apex:pageBlockSectionItem >
                <apex:outputText value="Team Leader (Title)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TeamLeaderTitle__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TeamLeaderTitle__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
                            </apex:pageBlockSectionItem>   -->

    </apex:pageBlockSection>

    <apex:pageBlockSection title="Financial  (note - all values are in agreement currency)" collapsible="false">      
            <apex:pageBlockSectionItem helptext="Select the type of fee structure to be used." >
                <apex:outputText value="Fee Type"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FeeType__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.FeeType__c}" rendered="{!mode == ''}"/>        
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="">
                <apex:outputText value="Payment Terms"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode != ''}" required="true">
                    </apex:inputField>
                    <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>                     

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}">
                <apex:outputText value="Agreement Currency"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>            
            
            <apex:pageBlockSectionItem >
            </apex:pageBlockSectionItem> 
        
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementAmountEstimated__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (estimated)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode != ''}"/>    
                    <apex:outputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode == ''}"/>   
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>
            
            <apex:pageBlockSectionItem >
            </apex:pageBlockSectionItem> 

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Amount__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (confirmed and committed)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Amount__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Amount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>              
         <!--  <apex:pageBlockSectionItem >
                <apex:outputText value="Purchase Order (only applicable if not using Cross-Charging)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>           

     
            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Total Purchase Orders Raised"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>             
            </apex:pageBlockSectionItem>          -->                                          
        
  
                
         <!--   <apex:pageBlockSectionItem >
                <apex:outputText value="Total Invoiced"/>
                <apex:outputField value="{!agreement.Total_Invoiced__c}"/>              
            </apex:pageBlockSectionItem>            
                    
            <apex:pageBlockSectionItem helptext="">
                <apex:outputPanel />
            </apex:pageBlockSectionItem>            
            <apex:pageBlockSectionItem >
                <apex:outputText value="Total Paid" />
                <apex:outputField value="{!agreement.TotalPaid__c}" />              
            </apex:pageBlockSectionItem>        -->
                    
            </apex:pageBlockSection>

    <apex:pageBlockSection title="Execution Details" collapsible="false" id="jointExecutionDetails">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExecutionDate__c.inlineHelpText}">
            <apex:outputText value="Execution Date"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.ExecutionDate__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                <apex:outputField value="{!agreement.ExecutionDate__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>      

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>             

    </apex:pageBlockSection>
    </apex:pageBlock>

        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock> 

    
    </apex:form>

    <apex:relatedList list="CombinedAttachments" rendered="{!mode==''}"/>

    </apex:outputPanel>


    <!-- Prime Task Order -->   
    <apex:outputPanel rendered="{!agreementRecordType =='Prime Task Order'}" id="primeTaskOrder">
    <apex:form > 
        <apex:inputHidden value="{!agreement.Project__c}"/>
        <apex:outputPanel id="msaChanged">
        <apex:inputHidden value="{!MSAChanged}"/>
        </apex:outputPanel>
        <apex:actionFunction id="subScopeChanged" name="subScopeChanged" rerender="subScope"/>

        <apex:actionFunction name="changedMSA" rerender="testPanel, msaChanged" immediate="false">
            <apex:param name="changedBool" value="" assignTo="{!MSAChanged}" />
        </apex:actionFunction>

        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Prime Task Order Agreement ' + mode}">
             
        <apex:pageBlockButtons >
            <apex:commandLink value="Print Agreement" action="{!printPdf}" styleClass="btn printAgreement" immediate="true" target="_blank" style="text-decoration:none" />
            <apex:commandButton value="Save" action="{!save}" rendered="{!mode != ''}"/>
            <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode == ''}"/>
            <apex:commandButton value="Return To Agreement" action="{!cancel}" rendered="{!mode == 'Edit'}"/>           
            <apex:commandButton value="Initiate Contract Review" action="{!initiateContractReview}" rendered="{!mode == ''}" />
            <apex:commandButton value="View MSA" action="{!viewMSA}" rendered="{!mode == ''}" />
            <apex:commandButton value="Return to Project" action="{!cancel}" rendered="{!mode == 'New' && agreement.Project__c != null}" immediate="true"/>                       
            <apex:commandButton value="Return To Project" action="{!URLFOR($Action.pse__Proj__c.view, agreement.Project__c)}" rendered="{!mode != 'New'}"/>
            <apex:commandButton value="Return To Project Agreements" action="{!returnToProjectAgreements}" rendered="{!mode == ''}" />
            <apex:commandButton value="Delete" rendered="{!contractReviewCount == 0 && agreement.AgreementNumber__c == null && mode == '' && agreement.AgreementStatus__c != 'Executed'}" action="{!deleteAgreement}"/>
            <apex:commandButton value="Cancel" action="{!cancel}" rendered="{!agreement.Project__c == null && mode =='New'}" />
        </apex:pageBlockButtons>

        <apex:pageBlockSection >
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Name.inlineHelpText}">
                <apex:outputText value="ECO Agreement Number"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Name}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.Name}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementNumber__c.inlineHelpText}">
                <apex:outputText value="Oracle Agreement No"/>
                <apex:outputField value="{!agreement.AgreementNumber__c}"/>
            </apex:pageBlockSectionItem>  

            <apex:pageBlockSectionItem >
                <apex:outputText value="Agreement Status"/>
                <apex:outputPanel >
                    <apex:actionRegion>
                        <apex:inputField value="{!agreement.AgreementStatus__c}" rendered="{!mode != ''}" >
                            <apex:actionSupport event="onchange" immediate="false" reRender="taskOrderExecutionDetails" />
                        </apex:inputField>
                    </apex:actionRegion>
                    <apex:outputField value="{!agreement.AgreementStatus__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>             

            <apex:pageBlockSectionItem >
                <apex:outputText value="Project Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Project__c}" rendered="{!mode == 'New' && project == null}" required="true" />                  
                    <apex:outputField value="{!project.Name}" rendered="{!mode == 'New' && project != null}" />
                    <apex:outputField value="{!agreement.Project__r.Name}" rendered="{!mode != 'New'}"/>    
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="Search and select the MSA that applies to the contract. ">
                <apex:outputText value="MSA Reference"/>
                <apex:outputPanel id="testPanel">
                    <apex:inputField value="{!agreement.MSAReference__c}" rendered="{!mode != ''}" required="true" onchange="changedMSA('true');">
                    </apex:inputField>
                    <apex:outputField value="{!agreement.MSAReference__c}" rendered="{!mode == ''}"/>       
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >
                <apex:outputText value="Ecosystem Project Reference ID"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.EcoSystemReferenceNumber__c}" rendered="{!mode == 'New'}"/>              
                    <apex:outputField value="{!agreement.Project__r.EcoSystemReferenceNumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem helptext="Start and End Dates of Contract">
                <apex:outputText value="MSA Period"/>
                <apex:outputPanel rendered="{!agreement.MSAReference__c != null}">
                    <apex:outputField value="{!agreement.MSAReference__r.OrderingPeriodStart__c}"  html-placeholder="Start Date"/>
                    <apex:outputText value=" - "/>
                    <apex:outputField value="{!agreement.MSAReference__r.OrderingPeriodEnd__c}"  html-placeholder="End Date"/>          
                </apex:outputPanel>     
            </apex:pageBlockSectionItem>  
       
            <apex:pageBlockSectionItem >
                <apex:outputText value="Oracle Project No"/>
                <apex:outputPanel >
                    <apex:outputField value="{!project.OracleProjectnumber__c}" rendered="{!mode == 'New'}"/>
                    <apex:outputField value="{!agreement.Project__r.OracleProjectnumber__c}" rendered="{!mode != 'New'}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>        
  
            <apex:pageBlockSectionItem >
                <apex:outputText value="End Client"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Account__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.Account__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>                     
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >

            </apex:pageBlockSectionItem>
    
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProjectTeamMember__c.inlineHelpText}">
                <apex:outputText value="Agreement Owner"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode != ''}"  required="true"/>
                    <apex:outputField value="{!agreement.ProjectTeamMember__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
            </apex:pageBlockSectionItem>

            <apex:pageBlockSectionItem >

            </apex:pageBlockSectionItem>


            
    </apex:pageBlockSection>

    <apex:pageBlockSection collapsible="false" title="Contract Details">

        <apex:pageBlockSectionItem >
            <apex:outputText value="Contract Type"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementType__c}" rendered="{!mode != ''}" required="true"/>               
                <apex:outputField value="{!agreement.AgreementType__c}" rendered="{!mode == ''}"/>  
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>      

        <apex:pageBlockSectionItem helptext="The date the agreement record was created in Ecosystem (& Oracle)">
            <apex:outputText value="Create Date"/>
            <apex:outputField value="{!agreement.CreatedDate}"/>                
        </apex:pageBlockSectionItem>         
            
        <apex:pageBlockSectionItem helptext="Enter a Title or Name of the Contract">
                <apex:outputText value="Task Order Title/Name"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ContractTitle__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ContractTitle__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.StartDate__c.inlineHelpText}">
                <apex:outputText value="Start Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.StartDate__c}" rendered="{!mode != ''}"/>               
                    <apex:outputField value="{!agreement.StartDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>                 
           
        <apex:pageBlockSectionItem helptext="Enter the Clients reference number (if applicable)">
                <apex:outputText value="Task Order Reference No."/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ClientContractReferenceNo__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
        </apex:pageBlockSectionItem> 


        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExpirationDate__c.inlineHelpText}">
                <apex:outputText value="End Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExpirationDate__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.ExpirationDate__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>                         
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ProfIndemnityLiabilityAmt__c.inlineHelpText}">
                <apex:outputText value="Prof Indemnity/Liability Amt"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode != ''}"/>   
                    <apex:outputField value="{!agreement.ProfIndemnityLiabilityAmt__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>                                         
        </apex:pageBlockSectionItem>        

        <apex:pageBlockSectionItem >
                <apex:outputText value="Contract Review Status"/>
                <apex:outputPanel >
                    <apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>                                                 
        </apex:pageBlockSectionItem>   

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.PublicGeneralLiabilityAmt__c.inlineHelpText}">
            <apex:outputText value="Public/General Liability Amt"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode != ''}"/>               
                <apex:outputField value="{!agreement.PublicGeneralLiabilityAmt__c}" rendered="{!mode == ''}"/>      
            </apex:outputPanel>     
        </apex:pageBlockSectionItem>            

    </apex:pageBlockSection>

    <apex:pageBlockSection columns="1">
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopePackage__c.inlineHelpText}">
                <apex:outputText value="Scope Package"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ScopePackage__c}" onChange="subScopeChanged();" rendered="{!mode != ''}"/>
                    <apex:outputField value="{!agreement.ScopePackage__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:pageBlockSectionItem>    
            
            <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ScopeOfServices__c.inlineHelpText}">
                    <apex:outputText value="Scope of Services"/>
                    <apex:outputPanel id="subScope">
                        <apex:inputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode != '' && agreement.ScopePackage__c == null}"/>   
                        <apex:outputField style="width: 780px" value="{!agreement.ScopeOfServices__c}" rendered="{!mode == '' && agreement.ScopePackage__c == null}"/>
                        <apex:outputField style="width: 780px" value="{!agreement.ScopePackage__r.Scope_Details__c}" rendered="{!agreement.ScopePackage__c != null}"/>          
                    </apex:outputPanel>         
            </apex:pageBlockSectionItem> 
                                                                                                                                
    </apex:pageBlockSection>

    <apex:outputPanel id="taskOrderFinancial">
    <apex:pageBlockSection collapsible="false" title="Financial  (note - all values are in agreement currency)" >      

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FeeType__c.inlineHelpText}">
            <apex:outputText value="Fee Type"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.FeeType__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.FeeType__c}" rendered="{!mode == ''}"/>        
            </apex:outputPanel>     
        </apex:pageBlockSectionItem> 

        <apex:pageBlockSectionItem >
            <apex:outputText value="Total Approved Revenue Limit"/>
            <apex:outputPanel id="totalApprovedRevenueLimit">
                <apex:outputPanel >
                        <apex:inputField value="{!agreement.TotalApprovedRevenueLimit__c}" rendered="{!mode != ''}" />
                    <apex:outputField value="{!agreement.TotalApprovedRevenueLimit__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem id="termId">
                <apex:outputText value="Payment Terms"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode != ''}" required="true"/>
                    <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode == ''}"/>
                </apex:outputPanel> 
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem >
                <apex:outputText value="Total Funding Amount"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode != ''}"/>              
                    <apex:outputField value="{!agreement.TotalFundingAmount__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}">
            <apex:outputText value="Agreement Currency"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>    
            </apex:outputPanel>         
        </apex:pageBlockSectionItem>    

        <apex:pageBlockSectionItem >
            <apex:outputText value="Unallocated Funding"/>
            <apex:outputPanel >
                <apex:outputField value="{!agreement.UnallocatedFunding__c}" rendered="{!mode == ''}"/>    
            </apex:outputPanel>

        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementAmountEstimated__c.inlineHelpText}">
            <apex:outputText value="Agreement Amount (estimated)"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode != ''}"/>                
                <apex:outputField value="{!agreement.AgreementAmountEstimated__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel> 

        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem >
                <apex:outputText value="Variance (Confirmed - Approved Revenue Limit)"/>
                <apex:outputField value="{!agreement.AgreementVariance__c}"/>                
        </apex:pageBlockSectionItem>  

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.Amount__c.inlineHelpText}">
                <apex:outputText value="Agreement Amount (confirmed and committed)"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.Amount__c}" rendered="{!mode != ''}"/>  
                    <apex:outputField value="{!agreement.Amount__c}" rendered="{!mode == ''}"/> 
                </apex:outputPanel>
        </apex:pageBlockSectionItem>
            
        <apex:pageBlockSectionItem >
            <apex:outputText value="Variance Reason"/>
            <apex:outputPanel >
                    <apex:inputField value="{!agreement.VarianceReason__c}" rendered="{!mode != ''}"/>  
                <apex:outputField value="{!agreement.VarianceReason__c}" rendered="{!mode == ''}"/> 
            </apex:outputPanel>                                                 
        </apex:pageBlockSectionItem>            
              
        <apex:outputPanel ></apex:outputPanel>                
    </apex:pageBlockSection>

    <apex:pageBlockSection collapsible="false" title="Agreement Execution Details" id="taskOrderExecutionDetails">
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
                <apex:outputText value="Agreement Executed By"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                    <apex:outputField value="{!agreement.AgreementExecutedBy__c}" rendered="{!mode == ''}"/>    
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>
                                
        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.ExecutionDate__c.inlineHelpText}">
                <apex:outputText value="Execution Date"/>
                <apex:outputPanel >
                    <apex:inputField value="{!agreement.ExecutionDate__c}" rendered="{!mode != ''}" required="{!agreement.AgreementStatus__c == 'Executed'}"/>
                    <apex:outputField value="{!agreement.ExecutionDate__c}" rendered="{!mode == ''}"/>  
                </apex:outputPanel>         
        </apex:pageBlockSectionItem>

        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.AgreementExecutedBy__c.inlineHelpText}">
            <apex:outputText value="Agreement Executed By"/>
            <apex:outputPanel >
                <apex:inputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode != ''}"/>
                <apex:outputField value="{!agreement.AgreementExecutedBy2__c}" rendered="{!mode == ''}"/>
            </apex:outputPanel>
        </apex:pageBlockSectionItem>         

    </apex:pageBlockSection>
    </apex:outputPanel>

                        
        </apex:pageBlock>   

        <apex:pageBlock title="Funding" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top"><apex:commandButton value="Manage Funding" action="{!manageFunding}"/></apex:pageBlockButtons>
            <apex:outputPanel rendered="{!fundings.size > 0}">
            <apex:pageBlockTable value="{!fundings}" var="funding">
                <apex:column headervalue="Date Allocated">
                    <apex:outputField value="{!funding.CreatedDate}" rendered="{!funding.DateAllocatedDate__c == null}"></apex:outputField>
                    <apex:outputField value="{!funding.DateAllocatedDate__c}" rendered="{!funding.DateAllocatedDate__c != null}"></apex:outputField>                    
                </apex:column>         
                <apex:column headervalue="Classification">
                    <apex:outputField value="{!funding.FundingClassification__c}"/>
                </apex:column>          
                <apex:column headervalue="Allocated Amount">
                    <apex:outputField value="{!funding.TotalBaselinedAmount__c}" rendered="{!funding.AllocatedAmount__c==null}"/>
                    <apex:outputField value="{!funding.AllocatedAmount__c}" rendered="{!funding.AllocatedAmount__c!=null}"/>
                </apex:column>
        </apex:pageBlockTable>      
        </apex:outputPanel>
        
        <apex:outputPanel rendered="{!fundings.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>   

        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>  
        
        <apex:pageBlock title="MSA DOA Conditions of Approval" rendered="{!mode == ''}">
            <apex:outputPanel rendered="{!msaDOAConditions != null && msaDOAConditions.size > 0}">
            <apex:pageBlockTable value="{!msaDOAConditions}" var="condition">
                <apex:column headervalue="Name"><apex:commandlink action="{!URLFOR($Action.DOAConditions__c.view, condition.Id)}"><apex:outputField value="{!condition.Name}"/></apex:commandLink></apex:column>                   
                <apex:column headervalue="Mitigation Plan"><apex:outputField value="{!condition.Mitigation_Plan__c}"/></apex:column>                   
<!--                <apex:column headervalue="DOA Approval Request"><apex:outputField value="{!conditions.DOAApprovalRequest__c}"/></apex:column>                   
                <apex:column headervalue="DOA Trigger Number"><apex:outputField value="{!conditions.DoATriggerNo__c}"/></apex:column>                   
                <apex:column headervalue="DOA Register"><apex:outputField value="{!conditions.DOARegister__c}"/></apex:column>                   
                <apex:column headervalue="Compliance Status"><apex:outputField value="{!conditions.ComplianceStatus__c}"/></apex:column>                   
                <apex:column headervalue="Compliance Date"><apex:outputField value="{!conditions.ComplianceDate__c}"/></apex:column>                   
                <apex:column headervalue="Completed"><apex:outputField value="{!conditions.Completed__c}"/></apex:column>                   
                <apex:column headervalue="Level"><apex:outputField value="{!conditions.Level__c}"/></apex:column>   -->                
                <apex:column headervalue="Trigger Description"><apex:outputField value="{!condition.TriggerDescription__c}"/></apex:column>                   
            </apex:pageBlockTable>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!msaDOAConditions == null || msaDOAConditions.size == 0}">
                <apex:outputText value="No records to display"/>
            </apex:outputPanel> 
        </apex:pageBlock>   
        
        <apex:pageBlock title="MSA Management Team Members" rendered="{!mode == ''}">
            <apex:outputPanel rendered="{!msaManagementTeamMembers != null && msaManagementTeamMembers.size > 0}">
            <apex:pageBlockTable value="{!msaManagementTeamMembers}" var="managementTeamMember">
                <apex:column headervalue="Role"><apex:outputField value="{!managementTeamMember.Role__c}"/></apex:column>                   
                <apex:column headervalue="Name"><apex:outputField value="{!managementTeamMember.TeamMember__r.Name}"/></apex:column>
                <apex:column headervalue="Phone"><apex:outputField value="{!managementTeamMember.TeamMember__r.Phone}"/></apex:column>                  
                <apex:column headervalue="Email"><apex:outputField value="{!managementTeamMember.TeamMember__r.Email}"/></apex:column>
            </apex:pageBlockTable>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!msaManagementTeamMembers == null || msaManagementTeamMembers.size == 0}">
                <apex:outputText value="No records to display"/>
            </apex:outputPanel>             
        </apex:pageBlock>           
        
        <c:ECO_RiskFlyout ProjectId="{!project.Id}" PlanElement="" rendered="{!project != null}"/>
        <c:ECO_AssumptionFlyout ProjectId="{!project.Id}" PlanElement="" rendered="{!project != null}"/>
        <c:ECO_ProjectTeamFlyout ProjectId="{!project.Id}" rendered="{!project != null}"  />
       <!--  <c:ECO_MSABillRateFlyout ProjectId="{!Agreement__c.Project__c}" rendered="{!Agreement__c.Project__c != null}" />  -->
        
       <!--  <c:ECO_MSAFlyout MSAId="{!agreement.Id}" />  -->

    </apex:form>
    <!--<apex:relatedList list="ContractReviews__r" rendered="{!mode==''}"/> -->
    <apex:relatedList list="CombinedAttachments" rendered="{!mode==''}"/>
    
    </apex:outputPanel> 
    

<!-- MSA -->    
    <apex:outputPanel rendered="{!agreementRecordType =='Prime (MSA)'}">
    <apex:form > 

        <apex:pageBlock mode="{!pageBlockMode}" title="{!'Master Service Agreement ' + mode}">        
            <apex:pageBlockButtons >
                <apex:commandButton value="Save" action="{!save}" rendered="{!mode !=''}"/>
                <apex:commandButton value="Edit" action="{!editAgreement}" rendered="{!mode ==''}" />
                <apex:commandButton value="Segmentation" action="{!launchSegmentationQuestionnaire}" rendered="{!mode == ''}" />
                <apex:commandButton value="MSA Project Portfolio" action="{!msaProjectSnapshot}" rendered="{!mode == '' && relAgreements.size > 0}" />
                <apex:commandButton value="Return To MSA" action="{!cancel}" rendered="{!mode =='Edit'}"/>             
            </apex:pageBlockButtons>

                <div class="halfWidthWrapper">
                    <apex:pageBlockSection columns="1" title="Contract Details" collapsible="false">
                        <apex:inputField value="{!agreement.Account__c}" rendered="{!mode!=''}" required="true"/>
                        <apex:inputField value="{!agreement.ContractTitle__c}" rendered="{!mode!=''}"/>
                        <apex:inputField value="{!agreement.Description__c}" rendered="{!mode!=''}" style="width: 400px; height: 40px"/>
                        <apex:inputField value="{!agreement.AgreementNumber__c}" rendered="{!mode!=''}"/>
                        <apex:pageBlockSectionItem helptext="Enter the start and end dates of the contract." rendered="{!mode != ''}">
                            <apex:outputLabel value="Ordering Period" rendered="{!mode!=''}"/>
                            <apex:outputPanel >
                                <apex:inputField value="{!agreement.OrderingPeriodStart__c}" rendered="{!mode!=''}" html-placeholder="Start Date"/>
                                <apex:outputText value=" - " rendered="{!mode!=''}"/>
                                <apex:inputField value="{!agreement.OrderingPeriodEnd__c}" rendered="{!mode!=''}" html-placeholder="End Date"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:inputField value="{!agreement.ContractingAgency__c}" rendered="{!mode!=''}"/>
                        <apex:inputField value="{!agreement.AgreementType__c}" rendered="{!mode!=''}" required="true"/>
                        <apex:inputField value="{!agreement.PaymentTerms__c}" rendered="{!mode!=''}" required="true"/>
                        <apex:inputField value="{!agreement.TotalContractValue__c}" rendered="{!mode!=''}"/>
                        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}" rendered="{!mode != ''}">
                            <apex:outputText value="Agreement Currency" rendered="{!mode != ''}"/>
                                 <apex:outputPanel >
                                    <apex:inputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode != ''}" required="true"/>
                                </apex:outputPanel>         
                        </apex:pageBlockSectionItem> 
                        <apex:pageBlockSectionItem helpText="Provide a detailed description of the scope of services available under the agreement." rendered="{!mode != ''}">
                            <apex:outputText value="Scope of Services"/>
                            <apex:inputField value="{!agreement.ScopeOfServices__c}" style="width: 400px; height: 40px" rendered="{!mode!=''}"/> 
                        </apex:pageBlockSectionItem>
                        <apex:outputField value="{!agreement.Account__c}" rendered="{!mode==''}"/>                      
                        <apex:outputField value="{!agreement.ContractTitle__c}" rendered="{!mode==''}"/>
                        <apex:outputField value="{!agreement.Description__c}" rendered="{!mode==''}" style="width: 400px; height: 40px"/>
                        <apex:outputField value="{!agreement.AgreementNumber__c}" rendered="{!mode==''}"/>
                        <apex:pageBlockSectionItem helptext="Enter the start and end dates of the contract." rendered="{!mode == ''}">
                            <apex:outputLabel value="Ordering Period" rendered="{!mode==''}"/>
                            <apex:outputPanel >
                                <apex:outputField value="{!agreement.OrderingPeriodStart__c}" rendered="{!mode==''}" html-placeholder="Start Date"/>
                                <apex:outputText value=" - " rendered="{!mode==''}"/>
                                <apex:outputField value="{!agreement.OrderingPeriodEnd__c}" rendered="{!mode==''}" html-placeholder="End Date"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:outputField value="{!agreement.ContractingAgency__c}" rendered="{!mode==''}"/>
                        <apex:outputField value="{!agreement.AgreementType__c}" rendered="{!mode==''}"/>
                        <apex:outputField value="{!agreement.PaymentTerms__c}" rendered="{!mode==''}"/> 
                        <apex:outputField value="{!agreement.TotalContractValue__c}" rendered="{!mode==''}"/>
                        <apex:outputField value="{!agreement.TotalTaskOrdersValue__c}" rendered="{!mode ==''}"/>
                        <apex:pageBlockSectionItem helptext="{!$ObjectType.Agreement__c.Fields.FundingCurrencyCode__c.inlineHelpText}" rendered="{!mode == ''}">
                            <apex:outputText value="Agreement Currency" rendered="{!mode == ''}"/>
                                 <apex:outputPanel >
                                    <apex:outputField value="{!agreement.FundingCurrencyCode__c}" rendered="{!mode == ''}"/>    
                                </apex:outputPanel>         
                        </apex:pageBlockSectionItem> 
                        <apex:pageBlockSectionItem >
                		  <apex:outputText value="Contract Review Status"/>
                		  <apex:outputPanel >
                			<apex:outputText value="{!ContractReviewStatus}" rendered="{!mode == ''}"/> 
                		  </apex:outputPanel>                                                 
            			</apex:pageBlockSectionItem> 

                         <apex:outputField value="{!agreement.ScopeOfServices__c}" style="width: 400px; height: 40px" rendered="{!mode==''}"/>                            
                    </apex:pageBlockSection>
                </div>
                <div id="notifications">
                <apex:outputPanel rendered="{!mode == ''}" >
                    <apex:pageBlockSection columns="1" title="Management Team Members" collapsible="false">
                        <apex:outputPanel >
                        <c:ECO_HelpIcon helpText="Use this section to list the contract management team, such as the AECOM Program Manager, Contract Manager, Deputy Program Manager, Contracts Administrator.  This section could also be used to capture the client contact details."/>
                        <!-- <div class="customHelpText">
                            <img src="../img/icon/forecasts24.png" class="customHelpIcon"/> 
                            <div class="customHelpBody">
                            
                            </div>
                        </div> -->        
                        <apex:commandButton value="New Team Member" action="{!newManagementTeamMember}" immediate="true"/></apex:outputPanel>
                        <apex:outputPanel rendered="{!managementTeamMembers.size > 0}">
                        <apex:pageBlockTable value="{!managementTeamMembers}" var="managementTeamMember">
                            <apex:column style="width:80px" headervalue="Action">
                            <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.ManagementTeam__c.edit, managementTeamMember.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">Edit</apex:commandLink><apex:outputText value=" | "/>
                            <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.ManagementTeam__c.delete, managementTeamMember.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}" onclick="return window.confirm('Are you sure?');">Del</apex:commandLink></apex:column>
                            <apex:column headervalue="Role"><apex:outputField value="{!managementTeamMember.Role__c}"/></apex:column>                   
                            <apex:column headervalue="Name"><apex:outputField value="{!managementTeamMember.TeamMember__r.Name}"/></apex:column>
                            <apex:column headervalue="Organization"><apex:outputField value="{!managementTeamMember.Organization__c}"/></apex:column>
                            <apex:column headervalue="Phone"><apex:outputField value="{!managementTeamMember.TeamMember__r.Phone}"/></apex:column>                  
                            <apex:column headervalue="Email"><apex:outputField value="{!managementTeamMember.TeamMember__r.Email}"/></apex:column>
                        </apex:pageBlockTable>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!managementTeamMembers.size == 0}">
                            <apex:outputText value="No records to display"/>
                        </apex:outputPanel>     
                    </apex:pageBlockSection>

                </apex:outputPanel>
                </div>
                <div style="clear:both;"></div><br/>
        <!--    </apex:panelGrid> -->
        </apex:pageBlock>

        <apex:pageBlock title="List of Projects/Task Orders" rendered="{!mode == ''}" >
            <apex:outputPanel rendered="{!relAgreements.size > 0}">
            <apex:pageBlockTable value="{!relAgreements}" var="relAgreement">
                <apex:column headervalue="Oracle Project Number"><apex:outputField value="{!relAgreement.agreement.Project__r.OracleProjectnumber__c}"/></apex:column>                   
                <apex:column headervalue="Project Name"><apex:commandlink action="{!URLFOR($Action.pse__Proj__c.view, relAgreement.agreement.Project__c)}"><apex:outputField value="{!relAgreement.agreement.Project__r.Name}"/></apex:commandlink></apex:column>
                <apex:column headervalue="Project Manager"><apex:outputField value="{!relAgreement.agreement.Project__r.pse__Project_Manager__c}"/></apex:column>
<!--                <apex:column headervalue="Contract Value (Confirmed)"><apex:outputField value="{!relAgreement.agreement.Amount__c}"/></apex:column>-->
                <apex:column headervalue="Contract Value (Confirmed)">
                    <apex:outputtext value="{0, number, currency}">
                        <apex:param value="{!relAgreement.convertedConfirmedValue}"/>
                    </apex:outputText>
                </apex:column>
                <apex:column headervalue="Approved Cost Budget">
                    <apex:outputtext value="{0, number, currency}">
                        <apex:param value="{!relAgreement.agreement.Project__r.TotalApprovedCost__c}"/>
                    </apex:outputtext>
                </apex:column>                   
                 
                <apex:column headervalue="% Cost Complete"><apex:outputField value="{!relAgreement.agreement.Project__r.CostComplete__c}"/></apex:column>               
                <apex:column headervalue="Billed To Date"><apex:outputField value="{!relAgreement.agreement.Project__r.pse__Billing_Eligible_Last_Updated__c}"/></apex:column>
            </apex:pageBlockTable>      
        </apex:outputPanel>
        
        <apex:outputPanel rendered="{!relAgreements.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>                
        <!--<apex:pageBlock title="List of Projects/Task Orders" rendered="{!mode == ''}" >
            <apex:outputPanel rendered="{!relatedAgreements.size > 0}">
            <apex:pageBlockTable value="{!relatedAgreements}" var="relatedAgreement">
                <apex:column headervalue="Oracle Project Number"><apex:outputField value="{!relatedAgreement.Project__r.OracleProjectnumber__c}"/></apex:column>                   
                <apex:column headervalue="Project Name"><apex:commandlink action="{!URLFOR($Action.pse__Proj__c.view, relatedAgreement.Project__c)}"><apex:outputField value="{!relatedAgreement.Project__r.Name}"/></apex:commandlink></apex:column>
                <apex:column headervalue="Project Manager"><apex:outputField value="{!relatedAgreement.Project__r.pse__Project_Manager__c}"/></apex:column>
                <apex:column headervalue="Contract Value (Confirmed)"><apex:outputText value="{!relatedAgreement.Amount__c}"/></apex:column>                   
                <apex:column headervalue="Approved Cost Budget"><apex:outputText value="{!relatedAgreement.Project__r.TotalApprovedCost__c}"/></apex:column>                 
                <apex:column headervalue="% Cost Complete"><apex:outputField value="{!relatedAgreement.Project__r.CostComplete__c}"/></apex:column>               
                <apex:column headervalue="Billed To Date"><apex:outputField value="{!relatedAgreement.Project__r.pse__Billing_Eligible_Last_Updated__c}"/></apex:column>
            </apex:pageBlockTable>      
        </apex:outputPanel>
        
        <apex:outputPanel rendered="{!relatedAgreements.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>-->
        
        <!--<apex:pageBlock title="Project Portfolio Performance" rendered="{!mode == ''}">
            <apex:chart height="400" width="1000" data="{!data}">
                  <apex:axis type="Numeric" position="left" fields="data1" 
                    title="Y Axis" grid="true"/>
                  <apex:axis type="Category" position="bottom" fields="name" 
                    title="X Axis">
                </apex:axis>
                <apex:lineSeries axis="left" fill="true" xField="name" yField="data1"
                  markerType="cross" markerSize="4" markerFill="#FF0000"/>
           </apex:chart>
        </apex:pageBlock>       -->
        
        <apex:pageBlock title="Contract Documents" rendered="{!mode == ''}">
                <apex:outputPanel rendered="{!AttachedContractFiles.size > 0}">
                    <div class="fileList">
                    <apex:pageBlockTable value="{!AttachedContractFiles}" var="attachedContractFile" style="width: 100%;" rendered="{!agreement.ContractAttachment__c != null}">
                        <apex:column headerValue="Document Type" value="{!attachedContractFile.attachmentType}" />    
                        <apex:column headerValue="File Name">
                            <apex:outputLink value="{!URLFOR($Action.Attachment.Download, attachedContractFile.attachmentId)}" target="_blank">
                                <apex:outputText value="{!attachedContractFile.attachment.Name}" />
                            </apex:outputLink>
                        </apex:column>
                        <apex:column headervalue="Comments" value="{!attachedContractFile.comments}" />
                       <!-- <apex:column value="{!attachedContractFile.attachment.ContentType}" /> -->
                        <apex:column value="{!attachedContractFile.attachment.LastModifiedDate}" />    
                        <apex:column value="{!attachedContractFile.attachment.LastModifiedById}" />
                    </apex:pageBlockTable>
                    </div>      
                </apex:outputPanel>
                <apex:outputPanel rendered="{!AttachedContractFiles.size == 0}">
                    <apex:outputText value="No records to display"/><br/><br/>
                </apex:outputPanel>      
                <apex:outputPanel >
                    <apex:selectList value="{!contractDocumentType}" html-placeholder="Document Type" multiselect="false" id="contractDocumentType" styleclass="attachNewFile" size="1">
                        <apex:selectOptions value="{!ContractDocumentTypes}"/>
                    </apex:selectList>
                    <apex:inputText id="cmdContractComments" value="{!contractDocumentComments}"  maxlength="255" html-placeholder="Comments" styleclass="attachNewFile"/>
                    <apex:inputText id="overrideContractName" value="{!overrideContractAttachmentName}"  maxlength="80" html-placeholder="Override File Name" styleclass="attachNewFile"/>
                    <apex:commandButton id="cmdContractAttachment" value="Attach" action="{!saveContractAttachment}" styleclass="attachNewFile"/>   
               </apex:outputPanel>
                <br/>                           
                <apex:outputText value="Attachment"/><apex:inputFile id="contractAttachment" value="{!contractAttach.Body}" contentType="{!contractAttach.ContentType}" fileName="{!contractAttach.Name}" onchange="fileChosen3('{!$Component.cmdContractAttachment}', this, '{!$Component.overrideContractName}', '{!$Component.contractDocumentType}', '{!$Component.cmdContractComments}'); return false;"/>
        
        </apex:pageBlock>               

        <apex:pageBlock title="Program Plans" rendered="{!mode == ''}">
        <div class="customHelpText">
        <!--    <img src="../img/icon/forecasts24.png" class="customHelpIcon"/> -->
            <div class="customHelpBody">
                Plans may include any document prepared to help manage the contract, such as Program Management Plans, Program Health and Safety Plans, Program QA/QC Plans or Communication Plans.
            </div>
        </div>          
            <apex:outputPanel rendered="{!AttachedProgramPlanFiles.size > 0}">
                <div class="fileList">
                <apex:pageBlockTable value="{!AttachedProgramPlanFiles}" var="attachedProgramPlanFile" style="width: 825px;" rendered="{!agreement.ProgramPlanAttachment__c != null}">
                    <apex:column headerValue="File Name">
                        <apex:outputLink value="{!URLFOR($Action.Attachment.Download, attachedProgramPlanFile.Attachment.Id)}" target="_blank">
                            <apex:outputText value="{!attachedProgramPlanFile.Attachment.Name}" />
                        </apex:outputLink>
                    </apex:column>
                    <apex:column headervalue="Comments" value="{!attachedProgramPlanFile.Comments}" /> 
                    <apex:column value="{!attachedProgramPlanFile.Attachment.ContentType}" />  
                    <apex:column value="{!attachedProgramPlanFile.Attachment.LastModifiedDate}" /> 
                    <apex:column value="{!attachedProgramPlanFile.Attachment.LastModifiedById}" />
                </apex:pageBlockTable>
                </div>
            </apex:outputPanel> 
            <apex:outputPanel rendered="{!AttachedProgramPlanFiles.size == 0}">
                <apex:outputText value="No records to display"/><br/><br/>
            </apex:outputPanel> 
            <apex:outputPanel >
                <apex:inputText id="commentsProgramPlan" value="{!programPlanAttachmentComments}"  maxlength="255" html-placeholder="Comments" styleclass="attachNewFile"/>
                <apex:inputText id="overrideProgramPlanName" value="{!overrideProgramPlanAttachmentName}"  maxlength="80" html-placeholder="Override File Name" styleclass="attachNewFile"/>
                <apex:commandButton id="cmdProgramPlanAttachment" value="Attach" action="{!saveProgramPlanAttachment}" styleclass="attachNewFile"/>
            </apex:outputPanel>
            <br/>
            <apex:outputText value="Attachment"/><apex:inputFile id="programPlanAttachment" value="{!programPlanAttach.Body}" contentType="{!programPlanAttach.ContentType}" fileName="{!programPlanAttach.Name}" onchange="fileChosen2('{!$Component.cmdProgramPlanAttachment}', this, '{!$Component.overrideProgramPlanName}','{!$Component.commentsProgramPlan}' ); return false;"/>

        </apex:pageBlock>
        
        <apex:pageBlock title="Guidance Documents" rendered="{!mode == ''}">
        <div class="customHelpText">
          <!--  <img src="../img/icon/forecasts24.png" class="customHelpIcon"/>  -->
            <div class="customHelpBody">
                Program-type documents may include presentation templates/examples, regulatory guidance documents, document control requirements or project proposal templates.
            </div>
        </div>          
            <apex:outputPanel rendered="{!AttachedGuidanceFiles.size > 0}">
                <div class="fileList">
                <apex:pageBlockTable value="{!AttachedGuidanceFiles}" var="attachedGuidanceFile" style="width: 825px;" rendered="{!agreement.GuidanceAttachment__c != null}">
                    <apex:column headerValue="File Name">
                        <apex:outputLink value="{!URLFOR($Action.Attachment.Download, attachedGuidanceFile.Attachment.Id)}" target="_blank">
                            <apex:outputText value="{!attachedGuidanceFile.Attachment.Name}" />
                        </apex:outputLink>
                    </apex:column>
                    <apex:column headervalue="Comments" value="{!attachedGuidanceFile.comments}"/>
                    <apex:column value="{!attachedGuidanceFile.Attachment.ContentType}" /> 
                    <apex:column value="{!attachedGuidanceFile.Attachment.LastModifiedDate}" />    
                    <apex:column value="{!attachedGuidanceFile.Attachment.LastModifiedById}" />
                </apex:pageBlockTable>
                </div>
            </apex:outputPanel>         
            <apex:outputPanel rendered="{!AttachedGuidanceFiles.size == 0}">
                <apex:outputText value="No records to display"/><br/><br/>
            </apex:outputPanel> 
            
            <apex:outputPanel >
                <apex:inputText id="commentsGuidance" value="{!guidanceAttachmentComments}"  maxlength="255" html-placeholder="Comments" styleclass="attachNewFile"/>
                <apex:inputText id="overrideGuidanceName" value="{!overrideGuidanceAttachmentName}"  maxlength="80" html-placeholder="Override File Name" styleclass="attachNewFile"/>
                <apex:commandButton id="cmdGuidanceAttachment" value="Attach" action="{!saveGuidanceAttachment}" styleclass="attachNewFile"/>               
                </apex:outputPanel>
            <br/>
            <apex:outputText value="Attachment"/><apex:inputFile id="guidanceAttachment" value="{!guidanceAttach.Body}" contentType="{!guidanceAttach.ContentType}" fileName="{!guidanceAttach.Name}" onchange="fileChosen2('{!$Component.cmdGuidanceAttachment}', this, '{!$Component.overrideGuidanceName}', '{!$Component.commentsGuidance}'); return false;"/>
        
        </apex:pageBlock>   
        
        <apex:pageBlock title="Business Development" rendered="{!mode == ''}">
        <div class="customHelpText">
        <!--    <img src="../img/icon/forecasts24.png" class="customHelpIcon"/> -->
            <div class="customHelpBody">
                Business development documents may include contract cut sheets or brochures, client surveys or evaluations (e.g., CPARs), client commendation letters or awards, or program-level presentations.            
            </div>
        </div>
            <apex:outputPanel rendered="{!AttachedBusinessDevelopmentFiles.size > 0}">
            <div class="fileList">
            <apex:pageBlockTable value="{!AttachedBusinessDevelopmentFiles}" var="attachedBusinessDevelopmentFile" style="width: 825px;" rendered="{!agreement.BusinessDevelopmentAttachment__c != null}">
                <apex:column headerValue="File Name">
                    <apex:outputLink value="{!URLFOR($Action.Attachment.Download, attachedBusinessDevelopmentFile.Attachment.Id)}" target="_blank">
                        <apex:outputText value="{!attachedBusinessDevelopmentFile.Attachment.Name}" />
                    </apex:outputLink>
                </apex:column>
                <apex:column headervalue="Comments" value="{!attachedBusinessDevelopmentFile.Comments}" />  
                <apex:column value="{!attachedBusinessDevelopmentFile.Attachment.ContentType}" />  
                <apex:column value="{!attachedBusinessDevelopmentFile.Attachment.LastModifiedDate}" /> 
                <apex:column value="{!attachedBusinessDevelopmentFile.Attachment.LastModifiedById}" />
            </apex:pageBlockTable>
            </div>          
            </apex:outputPanel>
            <apex:outputPanel rendered="{!AttachedBusinessDevelopmentFiles.size == 0}">
                <apex:outputText value="No records to display"/><br/><br/>
            </apex:outputPanel> 
            
            <apex:outputPanel >
                <apex:inputText id="commentsBusinessDevelopment" value="{!businessDevelopmentAttachmentComments}"  maxlength="255" html-placeholder="Comments" styleclass="attachNewFile"/>
                <apex:inputText id="overrideBusinessDevelopmentName" value="{!overrideBusinessDevelopmentAttachmentName}"  maxlength="80" html-placeholder="Override File Name" styleclass="attachNewFile"/>
                <apex:commandButton id="cmdBusinessDevelopmentAttachment" value="Attach" action="{!saveBusinessDevelopmentAttachment}" styleclass="attachNewFile"/><br/>                                
            </apex:outputPanel>
            <br/>
            <apex:outputText value="Attachment"/><apex:inputFile id="businessDevelopmentAttachment" value="{!businessDevelopmentAttach.Body}" contentType="{!businessDevelopmentAttach.ContentType}" fileName="{!businessDevelopmentAttach.Name}" onchange="fileChosen2('{!$Component.cmdBusinessDevelopmentAttachment}', this, '{!$Component.overrideBusinessDevelopmentName}', '{!$Component.commentsBusinessDevelopment}'); return false;"/>

        </apex:pageBlock>   

        <apex:pageBlock title="Approved or Preferred Subs/Vendors" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top"><!-- <apex:commandButton value="New Approved Sub" action="{!newApprovedSub}"/> -->
             <apex:commandButton value="New Approved Sub" action="{!URLFOR($Action.Approved_Sub__c.new, null, ['Agreement__c'=agreement.Id, 'saveURL'='/apex/ECO_AgreementView?Id='&agreement.Id, 'retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}"/>
            </apex:pageBlockButtons>
            <apex:outputPanel rendered="{!approvedSubs.size > 0}">
            <apex:pageBlockTable value="{!approvedSubs}" var="approvedSub">
                <apex:column style="width:80px" headervalue="Action">
                <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.Approved_Sub__c.edit, approvedSub.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">Edit</apex:commandLink><apex:outputText value=" | "/>
                <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.Approved_Sub__c.delete, approvedSub.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}" onclick="return window.confirm('Are you sure?');">Del</apex:commandLink></apex:column>
                <apex:column headervalue="Name"><apex:outputField value="{!approvedSub.Account__r.Name}"/></apex:column>                    
                <apex:column headervalue="Role"><apex:outputField value="{!approvedSub.Role__c}"/></apex:column>
                <apex:column headervalue="Contact Name"><apex:outputField value="{!approvedSub.Contact_Name__c}"/></apex:column>                    
                <apex:column headervalue="Phone"><apex:outputField value="{!approvedSub.Phone__c}"/></apex:column>
                <apex:column headervalue="Email"><apex:outputField value="{!approvedSub.Email__c}"/></apex:column>
                <apex:column headervalue="Comments"><apex:outputField value="{!approvedSub.Comments__c}"/></apex:column>
            </apex:pageBlockTable>      
            </apex:outputPanel>
            <apex:outputPanel rendered="{!approvedSubs.size == 0}">
                <apex:outputText value="No records to display"/>
            </apex:outputPanel>         
        </apex:pageBlock>
        
        <apex:pageBlock title="MSA Teaming Partners" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top">
            	<!-- <apex:commandButton value="New MSA Team Partner" action="{!createNewMSATeamingPartner}"/>> -->
             	<apex:commandButton value="New MSA Team Partner" action="{!URLFOR($Action.MSATeamingPartner__c.new, null, ['Agreement__c'=agreement.Id, 'saveURL'='/apex/ECO_AgreementView?Id='&agreement.Id, 'retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}"/>
            </apex:pageBlockButtons>
            <apex:outputPanel rendered="{!msaTeamingPartners.size > 0}">
            <apex:pageBlockTable value="{!msaTeamingPartners}" var="msaTeamingPartner">
                <apex:column style="width:80px" headervalue="Action">
                <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.MSATeamingPartner__c.edit, msaTeamingPartner.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">Edit</apex:commandLink><apex:outputText value=" | "/>
                <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.MSATeamingPartner__c.delete, msaTeamingPartner.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}" onclick="return window.confirm('Are you sure?');">Del</apex:commandLink></apex:column>
                <apex:column headervalue="Name"><apex:outputField value="{!msaTeamingPartner.Account__r.Name}"/></apex:column>                  
                <apex:column headervalue="Role"><apex:outputField value="{!msaTeamingPartner.Role__c}"/></apex:column>
                <apex:column headervalue="Contact Name"><apex:outputField value="{!msaTeamingPartner.Contact_Name__c}"/></apex:column>                  
                <apex:column headervalue="Phone"><apex:outputField value="{!msaTeamingPartner.Phone__c}"/></apex:column>
                <apex:column headervalue="Email"><apex:outputField value="{!msaTeamingPartner.Email__c}"/></apex:column>
                <apex:column headervalue="Comments"><apex:outputField value="{!msaTeamingPartner.Comments__c}"/></apex:column>
        </apex:pageBlockTable>      
        </apex:outputPanel>
        
        <apex:outputPanel rendered="{!msaTeamingPartners.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>   
        
        <apex:pageBlock title="Contract Billing Rates" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top"><apex:commandButton value="Edit Bill Rates" action="{!editBillingRates}"/></apex:pageBlockButtons>
            <apex:outputPanel rendered="{!billingRates.size > 0}">
                <apex:outputPanel >
                    <div>
                    <table class="list " border="0" cellpadding="0" cellspacing="0">
                    <tr class="headerRow">
                        <th></th>
                        <apex:repeat value="{!billRateController.periods}" var="period">
                            <th class="headerRow"><span>
                            <apex:outputText value="{0,date,MM/dd/yyyy}' - '">
                                <apex:param value="{!period.BillRateStart__c}"/>
                            </apex:outputText>
                            <apex:outputText value="{0,date,MM/dd/yyyy}">
                                <apex:param value="{!period.BillRateEnd__c}"/>
                            </apex:outputText>
                            </span></th>
                        </apex:repeat>
                    </tr>
                    <apex:repeat value="{!billRateController.laborCategories}" var="laborCategory">
                    <tr class="dataRow">
                        <td class="dataCell"><apex:outputText value="{!laborCategory}"></apex:outputText></td>
                            <apex:repeat value="{!billRateController.periods}" var="period">
                            <apex:variable var="key" value="{!period.Id}-{!laborCategory}"/>
                            <td class="dataCell">
                                <apex:outputField value="{!billRateController.billRatePeriodCategoryRateMap[key].BillRate__c}"/>                   
                            </td>           
                        </apex:repeat> 
                    </tr>
                    </apex:repeat>
                    </table>
                    </div>
                </apex:outputPanel>
            <!--<apex:pageBlockTable value="{!billingRates}" var="billingRate">
                <apex:column headervalue="Action"></apex:column> 
                <apex:column headervalue="Labor Category"><apex:outputField value="{!billingRate.LaborCategory__c}"/></apex:column>
                <apex:column headervalue="Bill Rate Start"><apex:outputField value="{!billingRate.BillRatePeriod__r.BillRateStart__c}"/></apex:column>
                <apex:column headervalue="Bill Rate End"><apex:outputField value="{!billingRate.BillRatePeriod__r.BillRateEnd__c}"/></apex:column>
                <apex:column headervalue="Bill Rate"><apex:outputField value="{!billingRate.BillRate__c}"/></apex:column>
        </apex:pageBlockTable>   -->   
        </apex:outputPanel>
        
        <apex:outputPanel rendered="{!billingRates.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>           
                
        <apex:pageBlock title="Other Direct Costs" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top">
            	<!-- <apex:commandButton value="New Other Direct Cost" action="{!URLFOR($Action.OtherDirectCost__c.new, null, ['saveURL'='/apex/ECO_AgreementView?Id='&agreement.Id,'retURL'='/apex/ECO_AgreementView?Id='&agreement.Id, 'CF00Ne0000001Hxnt_lktp'=agreement.Id, 'CF00Ne0000001Hxnt'=agreement.Name])}"/> -->
				<apex:commandButton value="New Other Direct Cost" action="{!URLFOR($Action.OtherDirectCost__c.new, null, ['Agreement__c'=agreement.Id, 'saveURL'='/apex/ECO_AgreementView?Id='&agreement.Id, 'retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}"/>
            </apex:pageBlockButtons>
            <apex:outputPanel rendered="{!otherDirectCosts.size > 0}">
                <apex:pageBlockTable value="{!otherDirectCosts}" var="otherDirectCost">
                    <apex:column style="width:80px" headervalue="Action">
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.OtherDirectCost__c.edit, otherDirectCost.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">Edit</apex:commandLink><apex:outputText value=" | "/>
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.OtherDirectCost__c.delete, otherDirectCost.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}" onclick="return window.confirm('Are you sure?');">Del</apex:commandLink></apex:column>
                    <apex:column headervalue="Type"><apex:outputField value="{!otherDirectCost.Type__c}"/></apex:column>
                    <apex:column headervalue="Description"><apex:outputField value="{!otherDirectCost.Description__c}"/></apex:column>                  
                    <apex:column headervalue="Markup"><apex:outputField value="{!otherDirectCost.Markup__c}"/></apex:column> 
                    <apex:column headervalue="Allowable"><apex:outputField value="{!otherDirectCost.Allowable__c}"/></apex:column>
                    <apex:column headervalue="Comments"><apex:outputField value="{!otherDirectCost.Comments__c}"/></apex:column>                    
                </apex:pageBlockTable>
            </apex:outputPanel>
        <apex:outputPanel rendered="{!otherDirectCosts.size == 0}">
                <apex:outputText value="No records to display"/>
        </apex:outputPanel>     
        </apex:pageBlock>
        
       <apex:pageBlock title="Meeting Minutes" rendered="{!mode == ''}">
            <apex:outputPanel rendered="{!AttachedMeetingMinutesFiles.size > 0}">
                <apex:inputHidden value="{!agreement.MeetingMinutesAttachment__c}"/>
                <div class="fileList">
                <apex:pageBlockTable value="{!AttachedMeetingMinutesFiles}" var="attachedMeetingMinutesFile" style="width: 825px;">
                    <apex:column headerValue="File Name">
                        <apex:outputLink value="{!URLFOR($Action.Attachment.Download, attachedMeetingMinutesFile.Attachment.Id)}" target="_blank">
                            <apex:outputText value="{!attachedMeetingMinutesFile.Attachment.Name}" />
                        </apex:outputLink>
                    </apex:column>
                    <apex:column value="{!attachedMeetingMinutesFile.Comments}" headervalue="Content Type"/> 
                    <apex:column value="{!attachedMeetingMinutesFile.Attachment.ContentType}" headervalue="Content Type"/> 
                    <apex:column value="{!attachedMeetingMinutesFile.Attachment.LastModifiedDate}" headervalue="Last Modified Date"/>  
                    <apex:column value="{!attachedMeetingMinutesFile.Attachment.LastModifiedById}" headervalue="Last Modified By"/>
                </apex:pageBlockTable>
                </div>          
            </apex:outputPanel>
            <apex:outputPanel rendered="{!AttachedMeetingMinutesFiles.size == 0}">
                <apex:outputText value="No records to display"/><br/><br/>
            </apex:outputPanel> 
            
            <apex:outputPanel >
                <apex:inputText id="commentsMeetingMinutes" value="{!meetingMinutesAttachmentComments}"  maxlength="255" html-placeholder="Comments" styleclass="attachNewFile"/>
                <apex:inputText id="overrideMeetingMinutesName" value="{!overrideMeetingMinutesAttachmentName}"  maxlength="80" html-placeholder="Override File Name" styleclass="attachNewFile"/>
                <apex:commandButton id="cmdMeetingMinutesAttachment" value="Attach" action="{!saveMeetingMinutesAttachment}" styleclass="attachNewFile"/><br/>                              
           </apex:outputPanel>
           <br/>
            <apex:outputText value="Attachment"/><apex:inputFile id="meetingMinutesAttachment" value="{!meetingMinutesAttach.Body}" contentType="{!meetingMinutesAttach.ContentType}" fileName="{!meetingMinutesAttach.Name}" onchange="fileChosen2('{!$Component.cmdMeetingMinutesAttachment}', this, '{!$Component.overrideMeetingMinutesName}', '{!$Component.commentsMeetingMinutes}'); return false;"/>
        
        </apex:pageBlock>  
        
        <apex:pageBlock title="Program Notes" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top"><apex:commandButton value="New Note" action="{!createNewNote}"/></apex:pageBlockButtons>
            <apex:outputPanel rendered="{!notes.size > 0}">         
                <apex:pageBlockTable value="{!notes}" var="note">
                    <apex:column headervalue="Title" value="{!note.Title}"/>
                    <apex:column headervalue="Body" value="{!note.Body}"/>      
                </apex:pageBlockTable>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!notes.size == 0}">
                <apex:outputText value="No records to display"/><br/><br/>
            </apex:outputPanel> 
        </apex:pageBlock>       

        <apex:pageBlock title="Contract Reviews" rendered="{!mode == ''}">
        <apex:outputPanel rendered="{!contractReviews.size > 0}">
            <apex:pageBlockTable value="{!contractReviews}" var="contractReview">
    
                <apex:column headervalue="Contract Review Id">
                    <apex:commandlink action="{!URLFOR($Action.Contract_Review__c.view, contractReview.Id)}"><apex:outputField value="{!contractReview.Name}"/></apex:commandLink>
                </apex:column>          

                <apex:column headervalue="Review Status">
                    <apex:outputField value="{!contractReview.Status_Review__c}"/>
                </apex:column>    
                <apex:column headervalue="Review Request Type">
                    <apex:outputField value="{!contractReview.Review_Request_Type__c}"/>
                </apex:column>  
                <apex:column headervalue="Opportunity Name">
                    <apex:outputField value="{!contractReview.Opportunity_Name__c}"/>
                </apex:column>  
                <apex:column headervalue="Date Review is Required">
                    <apex:outputField value="{!contractReview.Date_Required__c}"/>
                </apex:column>                                  
                <apex:column headervalue="Client / Vendor">
                    <apex:outputField value="{!contractReview.Client_Vendor__c}"/>
                </apex:column>  
            </apex:pageBlockTable>

        </apex:outputPanel>
        <apex:outputPanel rendered="{!contractReviews.size == 0}">
            <apex:outputText value="No records to display"/>
        </apex:outputPanel> 
        </apex:pageBlock>         

        <apex:pageBlock title="DOA Conditions of Approval" rendered="{!mode == ''}">
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="New DOA Condition of Approval" action="{!URLFOR($Action.DOAConditions__c.new, null, ['Agreement__c'=agreement.Id, 'saveURL'='/apex/ECO_AgreementView?Id='&agreement.Id, 'retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}"/>
            </apex:pageBlockButtons>
            <apex:outputPanel rendered="{!dOAConditions != null && dOAConditions.size > 0}">
            <apex:pageBlockTable value="{!dOAConditions}" var="condition">
                <apex:column style="width:80px" headervalue="Action">
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.DOAConditions__c.edit, condition.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}">Edit</apex:commandLink><apex:outputText value=" | "/>
                    <apex:commandLink style="color:#015ba7;" action="{!URLFOR($Action.DOAConditions__c.delete, condition.Id, ['retURL'='/apex/ECO_AgreementView?Id='&agreement.Id])}" onclick="return window.confirm('Are you sure?');">Del</apex:commandLink>
                </apex:column>            
                <apex:column headervalue="Name"><apex:commandlink action="{!URLFOR($Action.DOAConditions__c.view, condition.Id)}"><apex:outputField value="{!condition.Name}"/></apex:commandLink></apex:column>                   
                <apex:column headervalue="Mitigation Plan"><apex:outputField value="{!condition.Mitigation_Plan__c}"/></apex:column>                   
 <!--               <apex:column headervalue="DOA Approval Request"><apex:outputField value="{!condition.DOAApprovalRequest__c}"/></apex:column>                   
                <apex:column headervalue="DOA Trigger Number"><apex:outputField value="{!condition.DoATriggerNo__c}"/></apex:column>                   
                <apex:column headervalue="DOA Register"><apex:outputField value="{!condition.DOARegister__c}"/></apex:column>                   
                <apex:column headervalue="Compliance Status"><apex:outputField value="{!condition.ComplianceStatus__c}"/></apex:column>                   
                <apex:column headervalue="Compliance Date"><apex:outputField value="{!condition.ComplianceDate__c}"/></apex:column>                   
                <apex:column headervalue="Completed"><apex:outputField value="{!condition.Completed__c}"/></apex:column>                   
                <apex:column headervalue="Level"><apex:outputField value="{!condition.Level__c}"/></apex:column>     -->              
                <apex:column headervalue="Trigger Description"><apex:outputField value="{!condition.TriggerDescription__c}"/></apex:column>                   
            </apex:pageBlockTable>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!dOAConditions == null || dOAConditions.size == 0}">
                <apex:outputText value="No records to display"/>
            </apex:outputPanel> 
        </apex:pageBlock>

    
        </apex:form>    

        <!--<apex:relatedList list="DOAConditions__r" rendered="{!mode==''}"/>-->
        <!--<apex:relatedList list="ContractReviews__r" rendered="{!mode==''}"/>-->
        <apex:relatedList list="OpenActivities" rendered="{!mode==''}"/> 
        
    </apex:outputPanel>
</apex:page>